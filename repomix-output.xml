This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
app/
  assets/
    javascript/
      client.js
  channels/
    application_cable/
      channel.rb
      connection.rb
  clockworks/
    workers/
      clock_mission.rb
      delete_user.rb
      find_and_destroy_company.rb
      find_and_destroy_reviews.rb
      handle_like_event.rb
    clock.rb
  consumers/
    application_consumer.rb
    example_consumer.rb
    like_event_consumer.rb
  controllers/
    api/
      v1/
        company_controller.rb
        favorite_controller.rb
        registrations_controller.rb
        reply_controller.rb
        review_controller.rb
        sessions_controller.rb
        user_controller.rb
    concerns/
      .keep
      auth_token_concern.rb
    interactors/
      kafka/
        consumers/
          like_event.rb
        producers/
          base.rb
          like_event.rb
        base.rb
        consumer.rb
        producer.rb
    application_controller.rb
    health_controller.rb
  deamons/
    likes/
      handle_like_event.rb
    base.rb
  helpers/
    response_helper.rb
  jobs/
    application_job.rb
  lib/
    auth_token.rb
  mailers/
    application_mailer.rb
  middleware/
    change_tenant.rb
  models/
    concerns/
      who_does_it/
        current_user_methods.rb
      .keep
      base_concern.rb
    application_record.rb
    area.rb
    company.rb
    favorite.rb
    like.rb
    reply.rb
    review.rb
    role.rb
    user.rb
  serializers/
    base_serializer.rb
    company_serializer.rb
    reply_serializer.rb
    review_serializer.rb
    role_serializer.rb
    user_serializer.rb
  socket/
    views/
      index.erb
    server.rb
  views/
    layouts/
      mailer.html.erb
      mailer.text.erb
bin/
  bundle
  kafka_consumer
  rails
  rake
  setup
  start_ngrok
config/
  environments/
    development.rb
    production.rb
    test.rb
  initializers/
    apartment.rb
    constants.rb
    cors.rb
    devise.rb
    filter_parameter_logging.rb
    inflections.rb
    kafka.rb
    redis.rb
    sidekiq.rb
  locales/
    devise.en.yml
    en.yml
  routes/
    api_routes.rb
  application.rb
  boot.rb
  cable.yml
  credentials.yml.enc
  database.yml
  environment.rb
  puma.rb
  routes.rb
  storage.yml
db/
  migrate/
    20231224034540_create_company.rb
    20231224034549_create_reviews.rb
    20231224050706_enable_uuid_extension.rb
    20231224091737_addisdeleted_to_comapny.rb
    20231224123050_devise_create_users.rb
    20231224125848_add_sessions_table.rb
    20231231083226_create_areas.rb
    20231231100955_create_reply_reviews.rb
    20231231101013_create_like_reviews.rb
    20240102073553_add_some_field_to_review.rb
    20240106074615_add_role_to_user.rb
    20240106074750_create_roles.rb
    20240214141045_add_is_deleted_to_user.rb
    20240215000000_create_favorites.rb
    20251219170216_remove_user_foreign_key_from_favorites.rb
    20251220033611_add_job_title_to_reviews.rb
    20251220041854_add_industry_and_hiring_to_companies.rb
  seeds/
    common/
      0_seed_area.rb
      1_company_seed.rb
      2_reviews_seed.rb
      3_seed_role.rb
  schema.rb
  seeds.rb
FE/
  bin/
    start_ngrok
  public/
    vite.svg
  src/
    assets/
      react.svg
    components/
      ConfirmModal.css
      ConfirmModal.jsx
      CreateCompanyForm.css
      CreateCompanyForm.jsx
      CreateReplyForm.css
      CreateReplyForm.jsx
      CreateReviewForm.css
      CreateReviewForm.jsx
      Footer.css
      Footer.jsx
      MainLayout.css
      MainLayout.jsx
      Navbar.css
      Navbar.jsx
      ProtectedRoute.jsx
      RecentReviews.css
      RecentReviews.jsx
      ReplyItem.css
      ReplyItem.jsx
      ReplyList.css
      ReplyList.jsx
      ReviewItem.css
      ReviewItem.jsx
      ReviewList.css
      ReviewList.jsx
      StarRating.css
      StarRating.jsx
    config/
      api.js
    contexts/
      AuthContext.jsx
    hooks/
      index.js
      useCompanies.js
      useCompany.js
      useCompanyMutations.js
      useFavoriteMutations.js
      useFavorites.js
      useRecentReviews.js
      useReplyMutations.js
      useReviewMutations.js
      useReviewMutationsExtended.js
      useReviews.js
      useUserActivity.js
    pages/
      About.css
      About.jsx
      AllCompanies.css
      AllCompanies.jsx
      CompanyDetail.css
      CompanyDetail.jsx
      FAQ.css
      FAQ.jsx
      Home.css
      Home.jsx
      Login.css
      Login.jsx
      Profile.css
      Profile.jsx
      Register.css
      Register.jsx
    services/
      api.js
      authService.js
      companyService.js
      favoriteService.js
      replyService.js
      reviewService.js
      userService.js
    App.css
    App.jsx
    index.css
    main.jsx
  .env.example
  .gitignore
  eslint.config.js
  index.html
  NODE_VERSION.md
  package.json
  README.md
  vite.config.js
lib/
  tasks/
    .keep
    create_area.rake
log/
  .keep
public/
  robots.txt
spec/
  models/
    area_spec.rb
    company_spec.rb
    role_spec.rb
    user_spec.rb
  requests/
    company_spec.rb
    health_spec.rb
    like_review_spec.rb
    reply_review_spec.rb
storage/
  .keep
test/
  channels/
    application_cable/
      connection_test.rb
  controllers/
    .keep
  fixtures/
    files/
      .keep
  integration/
    .keep
  mailers/
    .keep
  models/
    .keep
  test_helper.rb
.example.env
.gitattributes
.gitignore
.ruby-version
config.ru
docker-compose.yml
Dockerfile
Gemfile
karafka.rb
Rakefile
README.md
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="app/assets/javascript/client.js">
var socket;

function addMessage(msg) {
    $("#chat-log").append("<p>" + msg + "</p>");
}

function connect() {
    try {
        socket = new WebSocket("ws://localhost:3001");
        addMessage("Socket State: " + socket.readyState);
        socket.onopen = function() {
            addMessage("Socket Status: " + socket.readyState + " (open)");
        }
        socket.onclose = function() {
            addMessage("Socket Status: " + socket.readyState + " (closed)");
        }
        socket.onmessage = function(msg) {
            addMessage("Received: " + msg.data);
        }
    } catch(exception) {
        addMessage("Error: " + exception);
    }
}

function send() {
    var text = $("#message").val();
    if (text == '') {
        addMessage("Please Enter a Message");
        return;
    }
    try {
        socket.send(text);
        addMessage("Sent: " + text)
    } catch(exception) {
        addMessage("Failed To Send")
    }
    $("#message").val('');
}

$(function() {
    connect();
});

$('#message').keypress(function(event) {
    if (event.keyCode == '13') { send(); }
});

$("#disconnect").click(function() {
    socket.close()
});
</file>

<file path="app/channels/application_cable/channel.rb">
module ApplicationCable
  class Channel < ActionCable::Channel::Base
  end
end
</file>

<file path="app/channels/application_cable/connection.rb">
module ApplicationCable
  class Connection < ActionCable::Connection::Base
  end
end
</file>

<file path="app/clockworks/workers/clock_mission.rb">
class Workers::ClockMission
  include Sidekiq::Worker
  sidekiq_options queue: SidekiqQueue::CLOCK_MISSION, retry: false

  def initialize
    puts "new clock missionr"
  end

  def perform mission, action, *args
    puts "Clock mission #{mission} - #{action}"
    puts "Params: \t#{args.to_s}" unless args.empty?

    if action == "perform_async"
      mission.to_s.constantize.send(action, *args)
    else
      mission.to_s.constantize.new.send(action, *args)
    end
  end
end
</file>

<file path="app/clockworks/workers/delete_user.rb">
class Workers::DeleteUser
  include Sidekiq::Worker
  sidekiq_options queue: SidekiqQueue::DELETE_USER, retry: true

  def perform user_id
    return unless user = User.find_by(id: user_id)
    User.transaction do
      user.destroy!
    end
    puts "deleted user success #{user_id}"
  end

  def execute
    return if ENV.fetch("ALLOW_DELETE_USER", 0).zero?
    need_deletes = User.where(is_deleted: true).ids
    need_deletes.each_slice(50) do |user_ids|
      review_ids.each {|user_ids| Workers::DeleteUser.perform_async(review_id)}
    end
  end

end
</file>

<file path="app/consumers/application_consumer.rb">
# frozen_string_literal: true

# Application consumer from which all Karafka consumers should inherit
# You can rename it if it would conflict with your current code base (in case you're integrating
# Karafka with other frameworks)
class ApplicationConsumer < Karafka::BaseConsumer
end
</file>

<file path="app/consumers/example_consumer.rb">
# frozen_string_literal: true

# Example consumer that prints messages payloads
class ExampleConsumer < ApplicationConsumer
  def consume
    messages.each { |message| puts message.payload }
  end

  # Run anything upon partition being revoked
  # def revoked
  # end

  # Define here any teardown things you want when Karafka server stops
  # def shutdown
  # end
end
</file>

<file path="app/consumers/like_event_consumer.rb">
# frozen_string_literal: true

# Karafka consumer for like_event topic
class LikeEventConsumer < ApplicationConsumer
  def consume
    messages.each do |message|
      like_payload = JSON.parse(message.payload)
      
      # Log message
      Rails.logger.info "Received like event: #{like_payload.inspect}"
      
      # Send to Sidekiq worker
      Workers::HandleLikeEvent.perform_async(like_payload)
    end
  end
end
</file>

<file path="app/controllers/api/v1/sessions_controller.rb">
class Api::V1::SessionsController < Devise::SessionsController
  include ResponseHelper

  def create
    resource = warden.authenticate!(auth_options)
    sign_in(resource_name, resource)
    render json: json_with_success(data: resource.as_json.merge!(access_token: AuthToken.access_token({ user_id: resource.id })))
  end
end
</file>

<file path="app/controllers/concerns/.keep">

</file>

<file path="app/controllers/concerns/auth_token_concern.rb">
module AuthTokenConcern
  extend ActiveSupport::Concern

  def authenticate_user_from_token!
    return unless auth_token

    if (payload = AuthToken.decode_token(auth_token)) && AuthToken.valid_payload(payload)
      user_id = payload['user_id']
      @current_user ||= User.find_by(id: user_id)
    end
    return render json: { error: 'Invalid token' }, status: :unauthorized unless @current_user
  end

  def auth_token
    @auth_token ||= request.headers['Authorization']&.split(' ')&.last
  end

  def current_user
    @current_user ||= User.current_user
  end

end
</file>

<file path="app/controllers/interactors/kafka/producers/base.rb">
module Interactors::Kafka
  class Producers::Base
  end
end
</file>

<file path="app/controllers/interactors/kafka/producers/like_event.rb">
# frozen_string_literal: true
module Interactors::Kafka
  class Producers::LikeEvent < Producers::Base

    class << self
      def create data
        producer = Interactors::Kafka::Producer.new
        producer.produce data, KafkaTopics::LIKE_EVENT, data[:tenant]
      end
    end

  end
end
</file>

<file path="app/controllers/interactors/kafka/base.rb">
module Interactors::Kafka
  class Base
    def get_topic_name topic, prefix = nil
      prefix ||= ENV.fetch('APP_NAME', 'review-company').downcase
      "#{prefix.downcase}-#{topic}".dasherize
    end
  end
end
</file>

<file path="app/controllers/interactors/kafka/consumer.rb">
# frozen_string_literal: true
class Interactors::Kafka::Consumer < Interactors::Kafka::Base

  def initialize(group_id)
    group_name = get_topic_name group_id, "#{ENV.fetch('APP_NAME', 'review-company').downcase}"
    @consumer  = KAFKA.consumer(group_id: group_name.dasherize)
  end

  def each_event
    @consumer.each_message(max_wait_time: 0.5) do |message|
      yield message if message
    end
  end

  def stop_consumer
    @consumer.stop
  end

  def subscribe_topic(prefix, topic)
    topic = get_topic_name topic, prefix
    puts "Subscribing topic: #{topic}"
    @consumer.subscribe(topic)
  end

  def log(topic=nil, offset=nil, partition=nil)
    puts "Topic:     #{topic}" if topic
    puts "Offset:    #{offset}" if offset
    puts "Partition: #{partition}" if partition
  end

end
</file>

<file path="app/controllers/interactors/kafka/producer.rb">
class Interactors::Kafka::Producer < Interactors::Kafka::Base

  def produce(message, topic, partition_key, key = nil, add_topic_prefix = true, prefix: nil)
    topic = get_topic_name(topic, prefix) if add_topic_prefix
    key ||= message[:type]
    message = JSON.dump message
    PRODUCER_POOL.with do |producer|
      producer.produce(message, key: key, topic: topic, partition_key: partition_key)
      producer.deliver_messages
    end
  end

end
</file>

<file path="app/controllers/health_controller.rb">
class HealthController < ApplicationController
  def show
    render json: {server_time: (Time.zone.now.to_f * 1e3).to_i}
  end
end
</file>

<file path="app/deamons/likes/handle_like_event.rb">
# bundle exec rails r Likes::HandleLikeEvent.new.daemon => consume topic LIKE_EVENT from this group
class Likes::HandleLikeEvent < Base
  def initialize
    consumer = Interactors::Kafka::Consumers::LikeEvent.new(KafkaGroups::LIKE_EVENT)
    super(consumer)
  end
end
</file>

<file path="app/deamons/base.rb">
class Base
  def initialize(consumer)
    @consumer = consumer
  end

  def daemon
    trap("TERM") { @consumer.stop_consumer }
    @consumer.each_event do |event|
      @consumer.handle_event(event)
    rescue Exception => e
      raise e
    end
  end
end
</file>

<file path="app/jobs/application_job.rb">
class ApplicationJob < ActiveJob::Base
  # Automatically retry jobs that encountered a deadlock
  # retry_on ActiveRecord::Deadlocked

  # Most jobs are safe to ignore if the underlying records are no longer available
  # discard_on ActiveJob::DeserializationError
end
</file>

<file path="app/lib/auth_token.rb">
require 'jwt'

class AuthToken
  def self.access_token(payload)
    JWT.encode(payload, Rails.application.secrets.secret_key_base)
  end

  def self.valid_payload(payload)
    true
  end

  def self.decode_token(token)
    decoded = JWT.decode(token, Rails.application.secrets.secret_key_base)[0]
    HashWithIndifferentAccess.new(decoded)
  rescue JWT::DecodeError
    nil
  end
end
</file>

<file path="app/mailers/application_mailer.rb">
class ApplicationMailer < ActionMailer::Base
  default from: "from@example.com"
  layout "mailer"
end
</file>

<file path="app/models/concerns/who_does_it/current_user_methods.rb">
module WhoDoesIt::CurrentUserMethods
  extend ActiveSupport::Concern

  included do
    class << self
      def current_user
        Thread.current[:user]
      end

      def current_user=(user)
        Thread.current[:user] = user
      end

      def reset_current_user
        Thread.current[:user] = nil
      end
    end
  end

end
</file>

<file path="app/models/concerns/.keep">

</file>

<file path="app/models/concerns/base_concern.rb">
module BaseConcern
  extend ActiveSupport::Concern
  included do
    default_scope { where(is_deleted: false) }
  end
end
</file>

<file path="app/models/application_record.rb">
class ApplicationRecord < ActiveRecord::Base
  primary_abstract_class
end
</file>

<file path="app/models/area.rb">
class Area < ApplicationRecord
  enum status: {
    active: 1,
    inactive: 0
  }
  validates :name, presence: true
  validates :tenant_name, length: { minimum: 1, maximum: 100 }, uniqueness: true

  after_create :create_tenant
  after_destroy :drop_tenant

  def self.change_tenant! tenant_name
    Apartment::Tenant.switch! tenant_name
  end

  def self.current_tenant
    Apartment::Tenant.current
  end

  def change_tenant
    Apartment::Tenant.switch tenant_name do
      yield
    end
  end

  private

  def create_tenant
    Apartment::Tenant.create tenant_name
  end

  def drop_tenant
    Apartment::Tenant.drop tenant_name
  end
end
</file>

<file path="app/models/reply.rb">
class Reply < ApplicationRecord
  include BaseConcern

  validates :review_id, :user_id, :content, presence: true
  belongs_to :review
  belongs_to :user

  after_commit :update_total_reply_count, on: [:create, :destroy]
  after_commit :update_is_edited, on: :update, if: -> { saved_change_to_content?}

  private

  def update_total_reply_count
    if previous_changes.keys.include?("id") && previous_changes[:id].first.nil?
      review.increment!(:total_reply, 1)
    else
      review.decrement!(:total_reply, 1)
    end
  end

  def update_is_edited
    self.update_attribute(:is_edited, true)
  end

end
</file>

<file path="app/serializers/base_serializer.rb">
class BaseSerializer < ActiveModel::Serializer

  def created_at_timestamp
    object.created_at.to_i
  end

  def updated_at_timestamp
    object.updated_at.to_i
  end
end
</file>

<file path="app/serializers/reply_serializer.rb">
class ReplySerializer < BaseSerializer
  attributes :id, :content, :user_id, :is_deleted, :is_edited, :created_at, :updated_at, :created_at_timestamp, :updated_at_timestamp
  belongs_to :review, serializer: ReviewSerializer
end
</file>

<file path="app/serializers/role_serializer.rb">
class RoleSerializer < BaseSerializer
  attributes :id, :role, :allow_all_action, :status, :allow_create,
             :allow_read, :allow_update,
             :created_at, :updated_at, :created_at_timestamp, :updated_at_timestamp
end
</file>

<file path="app/socket/views/index.erb">
<!doctype html>
<html>
<head>
</head>
<body>
<div class="container">
  <h1>WebSockets Chat App</h1>
  <div id="chat-log"></div>
  <div id="form">
    <input type="text" id="message">
    <button id="disconnect">Disconnect</button>
  </div>
</div>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js">
</script>
<script type="text/javascript" src="app.js"></script>
</body>
</html>
</file>

<file path="app/socket/server.rb">
require 'thin'
require 'em-websocket'
require 'sinatra/base'

EM.run do
  class App < Sinatra::Base
    get '/' do
      erb :index
    end
  end

  @clients = []

  EM::WebSocket.start(host: '0.0.0.0', port: '3001') do |ws|
    ws.onopen do |handshake|
      @clients << ws
      ws.send "Connected to #{handshake.path}."
    end

    ws.onclose do
      ws.send "Closed."
      @clients.delete ws
    end

    ws.onmessage do |msg|
      puts "Received Message: #{msg}"
      @clients.each do |socket|
        socket.send msg
      end
    end
  end

  App.run! port: 3000
end
</file>

<file path="app/views/layouts/mailer.html.erb">
<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <style>
      /* Email styles need to be inline */
    </style>
  </head>

  <body>
    <%= yield %>
  </body>
</html>
</file>

<file path="app/views/layouts/mailer.text.erb">
<%= yield %>
</file>

<file path="bin/bundle">
#!/usr/bin/env ruby
# frozen_string_literal: true

#
# This file was generated by Bundler.
#
# The application 'bundle' is installed as part of a gem, and
# this file is here to facilitate running it.
#

require "rubygems"

m = Module.new do
  module_function

  def invoked_as_script?
    File.expand_path($0) == File.expand_path(__FILE__)
  end

  def env_var_version
    ENV["BUNDLER_VERSION"]
  end

  def cli_arg_version
    return unless invoked_as_script? # don't want to hijack other binstubs
    return unless "update".start_with?(ARGV.first || " ") # must be running `bundle update`
    bundler_version = nil
    update_index = nil
    ARGV.each_with_index do |a, i|
      if update_index && update_index.succ == i && a =~ Gem::Version::ANCHORED_VERSION_PATTERN
        bundler_version = a
      end
      next unless a =~ /\A--bundler(?:[= ](#{Gem::Version::VERSION_PATTERN}))?\z/
      bundler_version = $1
      update_index = i
    end
    bundler_version
  end

  def gemfile
    gemfile = ENV["BUNDLE_GEMFILE"]
    return gemfile if gemfile && !gemfile.empty?

    File.expand_path("../Gemfile", __dir__)
  end

  def lockfile
    lockfile =
      case File.basename(gemfile)
      when "gems.rb" then gemfile.sub(/\.rb$/, gemfile)
      else "#{gemfile}.lock"
      end
    File.expand_path(lockfile)
  end

  def lockfile_version
    return unless File.file?(lockfile)
    lockfile_contents = File.read(lockfile)
    return unless lockfile_contents =~ /\n\nBUNDLED WITH\n\s{2,}(#{Gem::Version::VERSION_PATTERN})\n/
    Regexp.last_match(1)
  end

  def bundler_requirement
    @bundler_requirement ||=
      env_var_version ||
      cli_arg_version ||
      bundler_requirement_for(lockfile_version)
  end

  def bundler_requirement_for(version)
    return "#{Gem::Requirement.default}.a" unless version

    bundler_gem_version = Gem::Version.new(version)

    bundler_gem_version.approximate_recommendation
  end

  def load_bundler!
    ENV["BUNDLE_GEMFILE"] ||= gemfile

    activate_bundler
  end

  def activate_bundler
    gem_error = activation_error_handling do
      gem "bundler", bundler_requirement
    end
    return if gem_error.nil?
    require_error = activation_error_handling do
      require "bundler/version"
    end
    return if require_error.nil? && Gem::Requirement.new(bundler_requirement).satisfied_by?(Gem::Version.new(Bundler::VERSION))
    warn "Activating bundler (#{bundler_requirement}) failed:\n#{gem_error.message}\n\nTo install the version of bundler this project requires, run `gem install bundler -v '#{bundler_requirement}'`"
    exit 42
  end

  def activation_error_handling
    yield
    nil
  rescue StandardError, LoadError => e
    e
  end
end

m.load_bundler!

if m.invoked_as_script?
  load Gem.bin_path("bundler", "bundle")
end
</file>

<file path="bin/kafka_consumer">
#!/usr/bin/env ruby
# This script runs the Kafka consumer daemon for like events
require_relative '../config/environment'

puts "Starting Kafka Consumer for Like Events..."
puts "Press Ctrl+C to stop"

begin
  Likes::HandleLikeEvent.new.daemon
rescue Interrupt
  puts "\nStopping Kafka Consumer..."
  exit 0
end
</file>

<file path="bin/rails">
#!/usr/bin/env ruby
APP_PATH = File.expand_path("../config/application", __dir__)
require_relative "../config/boot"
require "rails/commands"
</file>

<file path="bin/rake">
#!/usr/bin/env ruby
require_relative "../config/boot"
require "rake"
Rake.application.run
</file>

<file path="bin/setup">
#!/usr/bin/env ruby
require "fileutils"

# path to your application root.
APP_ROOT = File.expand_path("..", __dir__)

def system!(*args)
  system(*args) || abort("\n== Command #{args} failed ==")
end

FileUtils.chdir APP_ROOT do
  # This script is a way to set up or update your development environment automatically.
  # This script is idempotent, so that you can run it at any time and get an expectable outcome.
  # Add necessary setup steps to this file.

  puts "== Installing dependencies =="
  system! "gem install bundler --conservative"
  system("bundle check") || system!("bundle install")

  # puts "\n== Copying sample files =="
  # unless File.exist?("config/database.yml")
  #   FileUtils.cp "config/database.yml.sample", "config/database.yml"
  # end

  puts "\n== Preparing database =="
  system! "bin/rails db:prepare"

  puts "\n== Removing old logs and tempfiles =="
  system! "bin/rails log:clear tmp:clear"

  puts "\n== Restarting application server =="
  system! "bin/rails restart"
end
</file>

<file path="bin/start_ngrok">
#!/bin/bash

# Script to start ngrok tunnel for Rails API
# Usage: ./bin/start_ngrok

PORT=${1:-3000}
DOMAIN=${2:-"advanced-unified-midge.ngrok-free.app"}

echo "üöÄ Starting ngrok tunnel..."
echo "   Domain: $DOMAIN"
echo "   Port: $PORT"
echo ""
echo "‚ö†Ô∏è  Make sure Rails server is running on port $PORT"
echo "   Run: rails s"
echo ""

# Check if Rails is running on the port
if ! lsof -i :$PORT | grep -q ruby; then
  echo "‚ùå Rails server is not running on port $PORT"
  echo "   Please start Rails server first: rails s"
  exit 1
fi

# Start ngrok
ngrok http --domain=$DOMAIN $PORT
</file>

<file path="config/environments/production.rb">
require "active_support/core_ext/integer/time"

Rails.application.configure do
  # Settings specified here will take precedence over those in config/application.rb.

  # Code is not reloaded between requests.
  config.cache_classes = true

  # Eager load code on boot. This eager loads most of Rails and
  # your application in memory, allowing both threaded web servers
  # and those relying on copy on write to perform better.
  # Rake tasks automatically ignore this option for performance.
  config.eager_load = true

  # Full error reports are disabled and caching is turned on.
  config.consider_all_requests_local       = false

  # Ensures that a master key has been made available in either ENV["RAILS_MASTER_KEY"]
  # or in config/master.key. This key is used to decrypt credentials (and other encrypted files).
  # config.require_master_key = true

  # Disable serving static files from the `/public` folder by default since
  # Apache or NGINX already handles this.
  config.public_file_server.enabled = ENV["RAILS_SERVE_STATIC_FILES"].present?

  # Enable serving of images, stylesheets, and JavaScripts from an asset server.
  # config.asset_host = "http://assets.example.com"

  # Specifies the header that your server uses for sending files.
  # config.action_dispatch.x_sendfile_header = "X-Sendfile" # for Apache
  # config.action_dispatch.x_sendfile_header = "X-Accel-Redirect" # for NGINX

  # Store uploaded files on the local file system (see config/storage.yml for options).
  config.active_storage.service = :local

  # Mount Action Cable outside main process or domain.
  # config.action_cable.mount_path = nil
  # config.action_cable.url = "wss://example.com/cable"
  # config.action_cable.allowed_request_origins = [ "http://example.com", /http:\/\/example.*/ ]

  # Force all access to the app over SSL, use Strict-Transport-Security, and use secure cookies.
  # config.force_ssl = true

  # Include generic and useful information about system operation, but avoid logging too much
  # information to avoid inadvertent exposure of personally identifiable information (PII).
  config.log_level = :info

  # Prepend all log lines with the following tags.
  config.log_tags = [ :request_id ]

  # Use a different cache store in production.
  # config.cache_store = :mem_cache_store

  # Use a real queuing backend for Active Job (and separate queues per environment).
  # config.active_job.queue_adapter     = :resque
  # config.active_job.queue_name_prefix = "ReviewCompany_production"

  config.action_mailer.perform_caching = false

  # Ignore bad email addresses and do not raise email delivery errors.
  # Set this to true and configure the email server for immediate delivery to raise delivery errors.
  # config.action_mailer.raise_delivery_errors = false

  # Enable locale fallbacks for I18n (makes lookups for any locale fall back to
  # the I18n.default_locale when a translation cannot be found).
  config.i18n.fallbacks = true

  # Don't log any deprecations.
  config.active_support.report_deprecations = false

  # Use default logging formatter so that PID and timestamp are not suppressed.
  config.log_formatter = ::Logger::Formatter.new

  # Use a different logger for distributed setups.
  # require "syslog/logger"
  # config.logger = ActiveSupport::TaggedLogging.new(Syslog::Logger.new "app-name")

  if ENV["RAILS_LOG_TO_STDOUT"].present?
    logger           = ActiveSupport::Logger.new(STDOUT)
    logger.formatter = config.log_formatter
    config.logger    = ActiveSupport::TaggedLogging.new(logger)
  end

  # Do not dump schema after migrations.
  config.active_record.dump_schema_after_migration = false
end
</file>

<file path="config/environments/test.rb">
require "active_support/core_ext/integer/time"

# The test environment is used exclusively to run your application's
# test suite. You never need to work with it otherwise. Remember that
# your test database is "scratch space" for the test suite and is wiped
# and recreated between test runs. Don't rely on the data there!

Rails.application.configure do
  # Settings specified here will take precedence over those in config/application.rb.

  # Turn false under Spring and add config.action_view.cache_template_loading = true.
  config.cache_classes = true

  # Eager loading loads your whole application. When running a single test locally,
  # this probably isn't necessary. It's a good idea to do in a continuous integration
  # system, or in some way before deploying your code.
  config.eager_load = ENV["CI"].present?

  # Configure public file server for tests with Cache-Control for performance.
  config.public_file_server.enabled = true
  config.public_file_server.headers = {
    "Cache-Control" => "public, max-age=#{1.hour.to_i}"
  }

  # Show full error reports and disable caching.
  config.consider_all_requests_local       = true
  config.action_controller.perform_caching = false
  config.cache_store = :null_store

  # Raise exceptions instead of rendering exception templates.
  config.action_dispatch.show_exceptions = false

  # Disable request forgery protection in test environment.
  config.action_controller.allow_forgery_protection = false

  # Store uploaded files on the local file system in a temporary directory.
  config.active_storage.service = :test

  config.action_mailer.perform_caching = false

  # Tell Action Mailer not to deliver emails to the real world.
  # The :test delivery method accumulates sent emails in the
  # ActionMailer::Base.deliveries array.
  config.action_mailer.delivery_method = :test

  # Print deprecation notices to the stderr.
  config.active_support.deprecation = :stderr

  # Raise exceptions for disallowed deprecations.
  config.active_support.disallowed_deprecation = :raise

  # Tell Active Support which deprecation messages to disallow.
  config.active_support.disallowed_deprecation_warnings = []

  # Raises error for missing translations.
  # config.i18n.raise_on_missing_translations = true

  # Annotate rendered view with file names.
  # config.action_view.annotate_rendered_view_with_filenames = true
end
</file>

<file path="config/initializers/filter_parameter_logging.rb">
# Be sure to restart your server when you modify this file.

# Configure parameters to be filtered from the log file. Use this to limit dissemination of
# sensitive information. See the ActiveSupport::ParameterFilter documentation for supported
# notations and behaviors.
Rails.application.config.filter_parameters += [
  :passw, :secret, :token, :_key, :crypt, :salt, :certificate, :otp, :ssn
]
</file>

<file path="config/initializers/inflections.rb">
# Be sure to restart your server when you modify this file.

# Add new inflection rules using the following format. Inflections
# are locale specific, and you may define rules for as many different
# locales as you wish. All of these examples are active by default:
# ActiveSupport::Inflector.inflections(:en) do |inflect|
#   inflect.plural /^(ox)$/i, "\\1en"
#   inflect.singular /^(ox)en/i, "\\1"
#   inflect.irregular "person", "people"
#   inflect.uncountable %w( fish sheep )
# end

# These inflection rules are supported but not enabled by default:
# ActiveSupport::Inflector.inflections(:en) do |inflect|
#   inflect.acronym "RESTful"
# end
</file>

<file path="config/initializers/kafka.rb">
# frozen_string_literal: true
require 'kafka'

KAFKA_URL     = ENV.fetch('KAFKA_URL', 'localhost:29092').split(',').freeze

KAFKA         = Kafka.new(KAFKA_URL, client_id: ENV.fetch('APP_NAME', 'review-company').downcase).freeze
PRODUCER_POOL = ConnectionPool.new(size: ENV.fetch('PRODUCER_POOL_SIZE', 10).to_i, timeout: ENV.fetch('PRODUCER_POOL_TIMEOUT', 5).to_i) {
  KAFKA.producer(idempotent: true)
}

class KafkaTopics
  LIKE_EVENT        = 'like_event'.freeze
end

class KafkaGroups
  LIKE_EVENT        = 'like_event'.freeze
end
</file>

<file path="config/locales/devise.en.yml">
# Additional translations at https://github.com/heartcombo/devise/wiki/I18n

en:
  devise:
    confirmations:
      confirmed: "Your email address has been successfully confirmed."
      send_instructions: "You will receive an email with instructions for how to confirm your email address in a few minutes."
      send_paranoid_instructions: "If your email address exists in our database, you will receive an email with instructions for how to confirm your email address in a few minutes."
    failure:
      already_authenticated: "You are already signed in."
      inactive: "Your account is not activated yet."
      invalid: "Invalid %{authentication_keys} or password."
      locked: "Your account is locked."
      last_attempt: "You have one more attempt before your account is locked."
      not_found_in_database: "Invalid %{authentication_keys} or password."
      timeout: "Your session expired. Please sign in again to continue."
      unauthenticated: "You need to sign in or sign up before continuing."
      unconfirmed: "You have to confirm your email address before continuing."
    mailer:
      confirmation_instructions:
        subject: "Confirmation instructions"
      reset_password_instructions:
        subject: "Reset password instructions"
      unlock_instructions:
        subject: "Unlock instructions"
      email_changed:
        subject: "Email Changed"
      password_change:
        subject: "Password Changed"
    omniauth_callbacks:
      failure: "Could not authenticate you from %{kind} because \"%{reason}\"."
      success: "Successfully authenticated from %{kind} account."
    passwords:
      no_token: "You can't access this page without coming from a password reset email. If you do come from a password reset email, please make sure you used the full URL provided."
      send_instructions: "You will receive an email with instructions on how to reset your password in a few minutes."
      send_paranoid_instructions: "If your email address exists in our database, you will receive a password recovery link at your email address in a few minutes."
      updated: "Your password has been changed successfully. You are now signed in."
      updated_not_active: "Your password has been changed successfully."
    registrations:
      destroyed: "Bye! Your account has been successfully cancelled. We hope to see you again soon."
      signed_up: "Welcome! You have signed up successfully."
      signed_up_but_inactive: "You have signed up successfully. However, we could not sign you in because your account is not yet activated."
      signed_up_but_locked: "You have signed up successfully. However, we could not sign you in because your account is locked."
      signed_up_but_unconfirmed: "A message with a confirmation link has been sent to your email address. Please follow the link to activate your account."
      update_needs_confirmation: "You updated your account successfully, but we need to verify your new email address. Please check your email and follow the confirmation link to confirm your new email address."
      updated: "Your account has been updated successfully."
      updated_but_not_signed_in: "Your account has been updated successfully, but since your password was changed, you need to sign in again."
    sessions:
      signed_in: "Signed in successfully."
      signed_out: "Signed out successfully."
      already_signed_out: "Signed out successfully."
    unlocks:
      send_instructions: "You will receive an email with instructions for how to unlock your account in a few minutes."
      send_paranoid_instructions: "If your account exists, you will receive an email with instructions for how to unlock it in a few minutes."
      unlocked: "Your account has been unlocked successfully. Please sign in to continue."
  errors:
    messages:
      already_confirmed: "was already confirmed, please try signing in"
      confirmation_period_expired: "needs to be confirmed within %{period}, please request a new one"
      expired: "has expired, please request a new one"
      not_found: "not found"
      not_locked: "was not locked"
      not_saved:
        one: "1 error prohibited this %{resource} from being saved:"
        other: "%{count} errors prohibited this %{resource} from being saved:"
</file>

<file path="config/boot.rb">
ENV["BUNDLE_GEMFILE"] ||= File.expand_path("../Gemfile", __dir__)

require "bundler/setup" # Set up gems listed in the Gemfile.
require "bootsnap/setup" # Speed up boot time by caching expensive operations.
</file>

<file path="config/cable.yml">
development:
  adapter: async

test:
  adapter: test

production:
  adapter: redis
  url: <%= ENV.fetch("REDIS_URL") { "redis://localhost:6379/1" } %>
  channel_prefix: ReviewCompany_production
</file>

<file path="config/credentials.yml.enc">
TNQE3M1F4AwvehN8bHMNYPPhhWYIwH6CZ4gn/DFu9MwJVPv0YJt3eMwBDo52twuWVGb5+rzfEiFmwu4AsHfQqyKLuUqRe2xgxXHETBfIb8S++b/jIPUSSRhE1XdIi3AlXyifxm5BBXPEnvz7X0mv2h6yJHySkK69nGUWHGqtsCW3RKy0N3eKzHX5Wc38CG86QSl06h2whpQZfOG1+inl3FkMFwgOn1PF98KNj4CVTLIQdvxJnSl2yjOxKrdsTQOKGnwIHQ1lLV5uglhRFSaWuMfuOVfrsZO97aUW5H7Ox7MrZg3qhm5OM9DSKb5LU79rm/FffgNdmtMHmgkA0/2gN38YYEKc7DWkcfMZi1aQliGrmt+GMl8MqdnVurr6L3Cizs+tKN9mNJKfkk9mpuJ/GEnSdxX0D5t/f0MV--ekUD+zZdaJ9HmC/h--Rzk5e2kZzv3hXRgiMnDkcg==
</file>

<file path="config/database.yml">
# PostgreSQL. Versions 9.3 and up are supported.
#
# Install the pg driver:
#   gem install pg
# On macOS with Homebrew:
#   gem install pg -- --with-pg-config=/usr/local/bin/pg_config
# On macOS with MacPorts:
#   gem install pg -- --with-pg-config=/opt/local/lib/postgresql84/bin/pg_config
# On Windows:
#   gem install pg
#       Choose the win32 build.
#       Install PostgreSQL and put its /bin directory on your path.
#
# Configure Using Gemfile
# gem "pg"
#
default: &default
  adapter: postgresql
  encoding: unicode
  pool: <%= ENV.fetch("RAILS_MAX_THREADS") { 5 } %>
  timeout: <%= ENV.fetch("RAILS_DB_TIMEOUT") { 5000 } %>
  host: <%= ENV.fetch("RAILS_DB_HOST") { "localhost" } %>
  port: <%= ENV.fetch("RAILS_DB_PORT") { "5432" } %>
  username: <%= ENV.fetch("RAILS_DB_USER_NAME") { "postgres" } %>
  password: <%= ENV.fetch("RAILS_DB_PASSWORD") { "postgres" } %>
  schema_search_path: "public, shared_extensions"

development:
  <<: *default
  database: <%= ENV.fetch("RAILS_DB_NAME") { "compayny-review" } %>

test:
  <<: *default
  database: <%= ENV.fetch("RAILS_DB_NAME") { "compayny-review-test" } %>

#production:
#  <<: *default
#  database: ReviewCompany_prod
#  username: ReviewCompany
#  password: <%#= ENV["REVIEWCOMPANY_DATABASE_PASSWORD"] %>
</file>

<file path="config/environment.rb">
# Load the Rails application.
require_relative "application"

# Initialize the Rails application.
Rails.application.initialize!
</file>

<file path="config/puma.rb">
# Puma can serve each request in a thread from an internal thread pool.
# The `threads` method setting takes two numbers: a minimum and maximum.
# Any libraries that use thread pools should be configured to match
# the maximum value specified for Puma. Default is set to 5 threads for minimum
# and maximum; this matches the default thread size of Active Record.
#
max_threads_count = ENV.fetch("RAILS_MAX_THREADS") { 5 }
min_threads_count = ENV.fetch("RAILS_MIN_THREADS") { max_threads_count }
threads min_threads_count, max_threads_count

# Specifies the `worker_timeout` threshold that Puma will use to wait before
# terminating a worker in development environments.
#
worker_timeout 3600 if ENV.fetch("RAILS_ENV", "development") == "development"

# Specifies the `port` that Puma will listen on to receive requests; default is 3000.
#
port ENV.fetch("PORT") { 3000 }

# Specifies the `environment` that Puma will run in.
#
environment ENV.fetch("RAILS_ENV") { "development" }

# Specifies the `pidfile` that Puma will use.
pidfile ENV.fetch("PIDFILE") { "tmp/pids/server.pid" }

# Specifies the number of `workers` to boot in clustered mode.
# Workers are forked web server processes. If using threads and workers together
# the concurrency of the application would be max `threads` * `workers`.
# Workers do not work on JRuby or Windows (both of which do not support
# processes).
#
# workers ENV.fetch("WEB_CONCURRENCY") { 2 }

# Use the `preload_app!` method when specifying a `workers` number.
# This directive tells Puma to first boot the application and load code
# before forking the application. This takes advantage of Copy On Write
# process behavior so workers use less memory.
#
# preload_app!

# Allow puma to be restarted by `bin/rails restart` command.
plugin :tmp_restart
</file>

<file path="config/storage.yml">
test:
  service: Disk
  root: <%= Rails.root.join("tmp/storage") %>

local:
  service: Disk
  root: <%= Rails.root.join("storage") %>

# Use bin/rails credentials:edit to set the AWS secrets (as aws:access_key_id|secret_access_key)
# amazon:
#   service: S3
#   access_key_id: <%= Rails.application.credentials.dig(:aws, :access_key_id) %>
#   secret_access_key: <%= Rails.application.credentials.dig(:aws, :secret_access_key) %>
#   region: us-east-1
#   bucket: your_own_bucket-<%= Rails.env %>

# Remember not to checkin your GCS keyfile to a repository
# google:
#   service: GCS
#   project: your_project
#   credentials: <%= Rails.root.join("path/to/gcs.keyfile") %>
#   bucket: your_own_bucket-<%= Rails.env %>

# Use bin/rails credentials:edit to set the Azure Storage secret (as azure_storage:storage_access_key)
# microsoft:
#   service: AzureStorage
#   storage_account_name: your_account_name
#   storage_access_key: <%= Rails.application.credentials.dig(:azure_storage, :storage_access_key) %>
#   container: your_container_name-<%= Rails.env %>

# mirror:
#   service: Mirror
#   primary: local
#   mirrors: [ amazon, google, microsoft ]
</file>

<file path="db/migrate/20231224050706_enable_uuid_extension.rb">
class EnableUuidExtension < ActiveRecord::Migration[7.0]
  def change
    enable_extension 'pgcrypto'
  end
end
</file>

<file path="db/migrate/20231224123050_devise_create_users.rb">
# frozen_string_literal: true

class DeviseCreateUsers < ActiveRecord::Migration[7.0]
  def change
    create_table :users, id: :uuid do |t|
      ## Database authenticatable
      t.string :email,              null: false, default: ""
      t.string :encrypted_password, null: false, default: ""
      t.integer :gender, default: 0, null: false
      t.string :first_name, limit: 30, null: false
      t.string :last_name, limit: 30, null: false
      t.integer :total_reviews, default: 0, null: false
      t.string :phone_number, limit: 30
      ## Recoverable
      t.string   :reset_password_token
      t.datetime :reset_password_sent_at

      ## Rememberable
      t.datetime :remember_created_at

      ## Trackable
      # t.integer  :sign_in_count, default: 0, null: false
      # t.datetime :current_sign_in_at
      # t.datetime :last_sign_in_at
      # t.string   :current_sign_in_ip
      # t.string   :last_sign_in_ip

      ## Confirmable
      # t.string   :confirmation_token
      # t.datetime :confirmed_at
      # t.datetime :confirmation_sent_at
      # t.string   :unconfirmed_email # Only if using reconfirmable

      ## Lockable
      # t.integer  :failed_attempts, default: 0, null: false # Only if lock strategy is :failed_attempts
      # t.string   :unlock_token # Only if unlock strategy is :email or :both
      # t.datetime :locked_at


      t.timestamps null: false
    end

    add_index :users, :email,                unique: true
    add_index :users, :reset_password_token, unique: true
    # add_index :users, :confirmation_token,   unique: true
    # add_index :users, :unlock_token,         unique: true
  end
end
</file>

<file path="db/migrate/20231224125848_add_sessions_table.rb">
class AddSessionsTable < ActiveRecord::Migration[7.0]
  def change
    create_table :sessions do |t|
      t.string :session_id, :null => false
      t.text :data
      t.timestamps
    end

    add_index :sessions, :session_id, :unique => true
    add_index :sessions, :updated_at
  end
end
</file>

<file path="db/migrate/20231231083226_create_areas.rb">
class CreateAreas < ActiveRecord::Migration[7.0]
  def change
    create_table :areas, id: :uuid do |t|
      t.string :name, null: false, limit: 255
      t.string :tenant_name, null: false, limit: 255
      t.integer :status, default: 1, null: false

      t.timestamps
    end
  end
end
</file>

<file path="db/migrate/20240102073553_add_some_field_to_review.rb">
class AddSomeFieldToReview < ActiveRecord::Migration[7.0]
  def change
    add_column :reviews, :total_like, :integer, default: 0
    add_column :reviews, :total_dislike, :integer, default: 0
    add_column :reviews, :total_reply, :integer, default: 0
  end
end
</file>

<file path="db/migrate/20240106074615_add_role_to_user.rb">
class AddRoleToUser < ActiveRecord::Migration[7.0]
  def change
    add_column :users, :role_id, :uuid, null: true
  end
end
</file>

<file path="db/migrate/20240106074750_create_roles.rb">
class CreateRoles < ActiveRecord::Migration[7.0]
  def change
    create_table :roles, id: :uuid do |t|

      t.integer :role, null: false, default: 0
      t.integer :status, default: 1
      t.boolean :allow_all_action, default: false
      t.boolean :allow_create, default: false
      t.boolean :allow_read, default: true
      t.boolean :allow_update, default: false
      t.timestamps
    end
  end
end
</file>

<file path="db/migrate/20240214141045_add_is_deleted_to_user.rb">
class AddIsDeletedToUser < ActiveRecord::Migration[7.0]
  def change
    add_column :users, :is_deleted, :boolean, default: false
  end
end
</file>

<file path="db/migrate/20251219170216_remove_user_foreign_key_from_favorites.rb">
class RemoveUserForeignKeyFromFavorites < ActiveRecord::Migration[7.0]
  def change
    # Remove foreign key constraint for user_id
    # User is in public schema (excluded_models), so we can't have foreign key from tenant schema
    # Check if foreign key exists before removing
    if foreign_key_exists?(:favorites, :users)
      remove_foreign_key :favorites, :users
    end
  end
end
</file>

<file path="db/migrate/20251220033611_add_job_title_to_reviews.rb">
class AddJobTitleToReviews < ActiveRecord::Migration[7.0]
  def change
    add_column :reviews, :job_title, :string
  end
end
</file>

<file path="db/migrate/20251220041854_add_industry_and_hiring_to_companies.rb">
class AddIndustryAndHiringToCompanies < ActiveRecord::Migration[7.0]
  def change
    add_column :companies, :industry, :string
    add_column :companies, :employee_count_min, :integer, default: 0
    add_column :companies, :employee_count_max, :integer, default: 0
    add_column :companies, :is_hiring, :boolean, default: false
  end
end
</file>

<file path="db/seeds/common/0_seed_area.rb">
# Create default Areas (tenants) before seeding other data
list_tenant_name = [Tenant::ASIA_SCHEMA, Tenant::EUROPE_SCHEMA, Tenant::AMERICA_SCHEMA]

list_tenant_name.each do |tenant_name|
  unless Area.exists?(tenant_name: tenant_name)
    Area.create(name: tenant_name.capitalize, tenant_name: tenant_name, status: :active)
    puts "Area: #{tenant_name} created"
  else
    # Ensure existing areas are active
    area = Area.find_by(tenant_name: tenant_name)
    area.update(status: :active) unless area.active?
    puts "Area: #{tenant_name} already exists and is active"
  end
end
puts 'Areas created/verified'
</file>

<file path="FE/bin/start_ngrok">
#!/bin/bash

# Script to start ngrok tunnel for Frontend (Vite dev server)
# Usage: ./bin/start_ngrok [port] [domain]
# Default: port 5173

PORT=${1:-5173}
DOMAIN=${2:-""}

echo "üöÄ Starting ngrok tunnel for Frontend..."
echo "   Port: $PORT"
if [ -n "$DOMAIN" ]; then
  echo "   Domain: $DOMAIN"
  ngrok http --domain=$DOMAIN $PORT
else
  echo "   Using random ngrok URL"
  ngrok http $PORT
fi
</file>

<file path="FE/public/vite.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="31.88" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 257"><defs><linearGradient id="IconifyId1813088fe1fbc01fb466" x1="-.828%" x2="57.636%" y1="7.652%" y2="78.411%"><stop offset="0%" stop-color="#41D1FF"></stop><stop offset="100%" stop-color="#BD34FE"></stop></linearGradient><linearGradient id="IconifyId1813088fe1fbc01fb467" x1="43.376%" x2="50.316%" y1="2.242%" y2="89.03%"><stop offset="0%" stop-color="#FFEA83"></stop><stop offset="8.333%" stop-color="#FFDD35"></stop><stop offset="100%" stop-color="#FFA800"></stop></linearGradient></defs><path fill="url(#IconifyId1813088fe1fbc01fb466)" d="M255.153 37.938L134.897 252.976c-2.483 4.44-8.862 4.466-11.382.048L.875 37.958c-2.746-4.814 1.371-10.646 6.827-9.67l120.385 21.517a6.537 6.537 0 0 0 2.322-.004l117.867-21.483c5.438-.991 9.574 4.796 6.877 9.62Z"></path><path fill="url(#IconifyId1813088fe1fbc01fb467)" d="M185.432.063L96.44 17.501a3.268 3.268 0 0 0-2.634 3.014l-5.474 92.456a3.268 3.268 0 0 0 3.997 3.378l24.777-5.718c2.318-.535 4.413 1.507 3.936 3.838l-7.361 36.047c-.495 2.426 1.782 4.5 4.151 3.78l15.304-4.649c2.372-.72 4.652 1.36 4.15 3.788l-11.698 56.621c-.732 3.542 3.979 5.473 5.943 2.437l1.313-2.028l72.516-144.72c1.215-2.423-.88-5.186-3.54-4.672l-25.505 4.922c-2.396.462-4.435-1.77-3.759-4.114l16.646-57.705c.677-2.35-1.37-4.583-3.769-4.113Z"></path></svg>
</file>

<file path="FE/src/assets/react.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="35.93" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 228"><path fill="#00D8FF" d="M210.483 73.824a171.49 171.49 0 0 0-8.24-2.597c.465-1.9.893-3.777 1.273-5.621c6.238-30.281 2.16-54.676-11.769-62.708c-13.355-7.7-35.196.329-57.254 19.526a171.23 171.23 0 0 0-6.375 5.848a155.866 155.866 0 0 0-4.241-3.917C100.759 3.829 77.587-4.822 63.673 3.233C50.33 10.957 46.379 33.89 51.995 62.588a170.974 170.974 0 0 0 1.892 8.48c-3.28.932-6.445 1.924-9.474 2.98C17.309 83.498 0 98.307 0 113.668c0 15.865 18.582 31.778 46.812 41.427a145.52 145.52 0 0 0 6.921 2.165a167.467 167.467 0 0 0-2.01 9.138c-5.354 28.2-1.173 50.591 12.134 58.266c13.744 7.926 36.812-.22 59.273-19.855a145.567 145.567 0 0 0 5.342-4.923a168.064 168.064 0 0 0 6.92 6.314c21.758 18.722 43.246 26.282 56.54 18.586c13.731-7.949 18.194-32.003 12.4-61.268a145.016 145.016 0 0 0-1.535-6.842c1.62-.48 3.21-.974 4.76-1.488c29.348-9.723 48.443-25.443 48.443-41.52c0-15.417-17.868-30.326-45.517-39.844Zm-6.365 70.984c-1.4.463-2.836.91-4.3 1.345c-3.24-10.257-7.612-21.163-12.963-32.432c5.106-11 9.31-21.767 12.459-31.957c2.619.758 5.16 1.557 7.61 2.4c23.69 8.156 38.14 20.213 38.14 29.504c0 9.896-15.606 22.743-40.946 31.14Zm-10.514 20.834c2.562 12.94 2.927 24.64 1.23 33.787c-1.524 8.219-4.59 13.698-8.382 15.893c-8.067 4.67-25.32-1.4-43.927-17.412a156.726 156.726 0 0 1-6.437-5.87c7.214-7.889 14.423-17.06 21.459-27.246c12.376-1.098 24.068-2.894 34.671-5.345a134.17 134.17 0 0 1 1.386 6.193ZM87.276 214.515c-7.882 2.783-14.16 2.863-17.955.675c-8.075-4.657-11.432-22.636-6.853-46.752a156.923 156.923 0 0 1 1.869-8.499c10.486 2.32 22.093 3.988 34.498 4.994c7.084 9.967 14.501 19.128 21.976 27.15a134.668 134.668 0 0 1-4.877 4.492c-9.933 8.682-19.886 14.842-28.658 17.94ZM50.35 144.747c-12.483-4.267-22.792-9.812-29.858-15.863c-6.35-5.437-9.555-10.836-9.555-15.216c0-9.322 13.897-21.212 37.076-29.293c2.813-.98 5.757-1.905 8.812-2.773c3.204 10.42 7.406 21.315 12.477 32.332c-5.137 11.18-9.399 22.249-12.634 32.792a134.718 134.718 0 0 1-6.318-1.979Zm12.378-84.26c-4.811-24.587-1.616-43.134 6.425-47.789c8.564-4.958 27.502 2.111 47.463 19.835a144.318 144.318 0 0 1 3.841 3.545c-7.438 7.987-14.787 17.08-21.808 26.988c-12.04 1.116-23.565 2.908-34.161 5.309a160.342 160.342 0 0 1-1.76-7.887Zm110.427 27.268a347.8 347.8 0 0 0-7.785-12.803c8.168 1.033 15.994 2.404 23.343 4.08c-2.206 7.072-4.956 14.465-8.193 22.045a381.151 381.151 0 0 0-7.365-13.322Zm-45.032-43.861c5.044 5.465 10.096 11.566 15.065 18.186a322.04 322.04 0 0 0-30.257-.006c4.974-6.559 10.069-12.652 15.192-18.18ZM82.802 87.83a323.167 323.167 0 0 0-7.227 13.238c-3.184-7.553-5.909-14.98-8.134-22.152c7.304-1.634 15.093-2.97 23.209-3.984a321.524 321.524 0 0 0-7.848 12.897Zm8.081 65.352c-8.385-.936-16.291-2.203-23.593-3.793c2.26-7.3 5.045-14.885 8.298-22.6a321.187 321.187 0 0 0 7.257 13.246c2.594 4.48 5.28 8.868 8.038 13.147Zm37.542 31.03c-5.184-5.592-10.354-11.779-15.403-18.433c4.902.192 9.899.29 14.978.29c5.218 0 10.376-.117 15.453-.343c-4.985 6.774-10.018 12.97-15.028 18.486Zm52.198-57.817c3.422 7.8 6.306 15.345 8.596 22.52c-7.422 1.694-15.436 3.058-23.88 4.071a382.417 382.417 0 0 0 7.859-13.026a347.403 347.403 0 0 0 7.425-13.565Zm-16.898 8.101a358.557 358.557 0 0 1-12.281 19.815a329.4 329.4 0 0 1-23.444.823c-7.967 0-15.716-.248-23.178-.732a310.202 310.202 0 0 1-12.513-19.846h.001a307.41 307.41 0 0 1-10.923-20.627a310.278 310.278 0 0 1 10.89-20.637l-.001.001a307.318 307.318 0 0 1 12.413-19.761c7.613-.576 15.42-.876 23.31-.876H128c7.926 0 15.743.303 23.354.883a329.357 329.357 0 0 1 12.335 19.695a358.489 358.489 0 0 1 11.036 20.54a329.472 329.472 0 0 1-11 20.722Zm22.56-122.124c8.572 4.944 11.906 24.881 6.52 51.026c-.344 1.668-.73 3.367-1.15 5.09c-10.622-2.452-22.155-4.275-34.23-5.408c-7.034-10.017-14.323-19.124-21.64-27.008a160.789 160.789 0 0 1 5.888-5.4c18.9-16.447 36.564-22.941 44.612-18.3ZM128 90.808c12.625 0 22.86 10.235 22.86 22.86s-10.235 22.86-22.86 22.86s-22.86-10.235-22.86-22.86s10.235-22.86 22.86-22.86Z"></path></svg>
</file>

<file path="FE/src/components/ConfirmModal.css">
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 10000;
  animation: fadeIn 0.2s ease;
}

@keyframes fadeIn {
  from {
    opacity: 0;
  }
  to {
    opacity: 1;
  }
}

.modal-content {
  background: var(--glassdoor-white);
  border-radius: 12px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
  max-width: 500px;
  width: 90%;
  max-height: 90vh;
  overflow: hidden;
  display: flex;
  flex-direction: column;
  animation: slideUp 0.3s ease;
}

@keyframes slideUp {
  from {
    transform: translateY(20px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 24px;
  border-bottom: 1px solid var(--glassdoor-border);
}

.modal-title {
  margin: 0;
  font-size: 20px;
  font-weight: 600;
  color: var(--glassdoor-gray);
}

.modal-close {
  background: none;
  border: none;
  font-size: 28px;
  color: var(--glassdoor-gray-light);
  cursor: pointer;
  padding: 0;
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 6px;
  transition: all 0.2s ease;
}

.modal-close:hover {
  background-color: var(--glassdoor-gray-bg);
  color: var(--glassdoor-gray);
}

.modal-body {
  padding: 24px;
  color: var(--glassdoor-gray);
  line-height: 1.6;
  font-size: 16px;
}

.modal-body p {
  margin: 0;
}

.modal-footer {
  display: flex;
  gap: 12px;
  justify-content: flex-end;
  padding: 24px;
  border-top: 1px solid var(--glassdoor-border);
  background-color: var(--glassdoor-gray-bg);
}

.modal-footer .btn-secondary {
  min-width: 100px;
}

.modal-footer .btn-primary {
  min-width: 100px;
}

.modal-footer .btn-danger {
  background-color: #dc3545;
  border-color: #dc3545;
}

.modal-footer .btn-danger:hover:not(:disabled) {
  background-color: #c82333;
  border-color: #bd2130;
}

/* Responsive - Mobile */
@media (max-width: 768px) {
  .modal-content {
    width: 95%;
    max-width: none;
  }

  .modal-header,
  .modal-body,
  .modal-footer {
    padding: 20px;
  }

  .modal-title {
    font-size: 18px;
  }

  .modal-footer {
    flex-direction: column-reverse;
  }

  .modal-footer .btn-secondary,
  .modal-footer .btn-primary {
    width: 100%;
  }
}
</file>

<file path="FE/src/components/ConfirmModal.jsx">
import './ConfirmModal.css';

const ConfirmModal = ({ isOpen, onClose, onConfirm, title, message, confirmText = 'X√°c nh·∫≠n', cancelText = 'H·ªßy', type = 'danger' }) => {
  if (!isOpen) return null;

  return (
    <div className="modal-overlay" onClick={onClose}>
      <div className="modal-content" onClick={(e) => e.stopPropagation()}>
        <div className="modal-header">
          <h3 className="modal-title">{title || 'X√°c nh·∫≠n'}</h3>
          <button className="modal-close" onClick={onClose}>√ó</button>
        </div>
        <div className="modal-body">
          <p>{message}</p>
        </div>
        <div className="modal-footer">
          <button className="btn-secondary" onClick={onClose}>
            {cancelText}
          </button>
          <button 
            className={`btn-primary ${type === 'danger' ? 'btn-danger' : ''}`}
            onClick={() => {
              onConfirm();
              onClose();
            }}
          >
            {confirmText}
          </button>
        </div>
      </div>
    </div>
  );
};

export default ConfirmModal;
</file>

<file path="FE/src/components/MainLayout.css">
.main-layout {
  min-height: 100vh;
  height: 100%;
  display: flex;
  flex-direction: column;
  background-color: var(--glassdoor-gray-bg);
  position: relative;
  overflow-x: hidden;
}

.main-content-wrapper {
  flex: 1 1 auto;
  display: flex;
  flex-direction: column;
  width: 100%;
  max-width: 1200px;
  margin: 0 auto;
  padding: 0;
  background: var(--glassdoor-gray-bg);
  height: 100%;
  overflow-x: hidden;
  position: relative;
}

/* Responsive - Mobile */
@media (max-width: 768px) {
  .main-content-wrapper {
    padding: 0;
  }
}
</file>

<file path="FE/src/components/MainLayout.jsx">
import { memo } from 'react';
import Navbar from './Navbar';
import Footer from './Footer';
import './MainLayout.css';

const MainLayout = memo(({ children }) => {
  return (
    <div className="main-layout">
      <Navbar />
      <main className="main-content-wrapper">
        {children}
      </main>
      <Footer />
    </div>
  );
});

MainLayout.displayName = 'MainLayout';

export default MainLayout;
</file>

<file path="FE/src/components/ProtectedRoute.jsx">
import { Navigate } from 'react-router-dom';
import { useAuth } from '../contexts/AuthContext';

const ProtectedRoute = ({ children }) => {
  const { isAuthenticated, loading } = useAuth();

  if (loading) {
    return <div>Loading...</div>;
  }

  if (!isAuthenticated) {
    return <Navigate to="/login" replace />;
  }

  return children;
};

export default ProtectedRoute;
</file>

<file path="FE/src/components/RecentReviews.css">
.recent-reviews-sidebar {
  background: var(--glassdoor-white);
  border-radius: 12px;
  padding: 24px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
  border: 1px solid var(--glassdoor-border);
}

.recent-reviews-sidebar h3 {
  font-size: 20px;
  font-weight: 700;
  color: var(--glassdoor-gray);
  margin: 0 0 20px 0;
  padding-bottom: 16px;
  border-bottom: 2px solid var(--glassdoor-border);
}

.recent-reviews-list {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.recent-review-item {
  padding: 16px;
  background: var(--glassdoor-gray-bg);
  border-radius: 8px;
  border: 1px solid var(--glassdoor-border);
  transition: all 0.2s ease;
}

.recent-review-item:hover {
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  border-color: var(--glassdoor-green);
}

.recent-review-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 8px;
  font-size: 12px;
}

.review-role {
  font-weight: 600;
  color: var(--glassdoor-gray);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.review-time {
  color: var(--glassdoor-gray-light);
  font-size: 11px;
}

.recent-review-company {
  margin-bottom: 8px;
}

.recent-review-company a {
  font-size: 15px;
  font-weight: 600;
  color: var(--glassdoor-green);
  text-decoration: none;
  transition: color 0.2s;
}

.recent-review-company a:hover {
  color: var(--glassdoor-green-dark);
  text-decoration: underline;
}

.recent-review-content {
  margin-bottom: 12px;
}

.recent-review-content p {
  font-size: 14px;
  font-weight: 600;
  color: var(--glassdoor-gray);
  margin: 0 0 6px 0;
  line-height: 1.4;
}

.review-excerpt {
  font-size: 13px;
  color: var(--glassdoor-gray-light);
  line-height: 1.5;
}

.recent-review-footer {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding-top: 8px;
  border-top: 1px solid var(--glassdoor-border);
  font-size: 12px;
}

.review-score {
  color: var(--glassdoor-green);
  font-weight: 600;
}

.review-author {
  color: var(--glassdoor-gray-light);
}

.empty-reviews {
  text-align: center;
  padding: 40px 20px;
  color: var(--glassdoor-gray-light);
  font-size: 14px;
}
</file>

<file path="FE/src/components/RecentReviews.jsx">
import { Link } from 'react-router-dom';
import { useRecentReviews } from '../hooks/useRecentReviews';
import './RecentReviews.css';

const RecentReviews = ({ limit = 10 }) => {
  const { data: response, isLoading } = useRecentReviews(limit);

  const reviews = response?.data || [];

  const formatTimeAgo = (dateString) => {
    if (!dateString) return '';
    const date = new Date(dateString);
    const now = new Date();
    const diffInSeconds = Math.floor((now - date) / 1000);
    
    if (diffInSeconds < 60) return 'V·ª´a xong';
    if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)} ph√∫t tr∆∞·ªõc`;
    if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)} gi·ªù tr∆∞·ªõc`;
    if (diffInSeconds < 604800) return `${Math.floor(diffInSeconds / 86400)} ng√†y tr∆∞·ªõc`;
    return date.toLocaleDateString('vi-VN', { day: 'numeric', month: 'numeric' });
  };

  if (isLoading) {
    return (
      <div className="recent-reviews-sidebar">
        <h3>C√°c review g·∫ßn ƒë√¢y</h3>
        <div className="loading">ƒêang t·∫£i...</div>
      </div>
    );
  }

  if (reviews.length === 0) {
    return (
      <div className="recent-reviews-sidebar">
        <h3>C√°c review g·∫ßn ƒë√¢y</h3>
        <div className="empty-reviews">Ch∆∞a c√≥ review n√†o</div>
      </div>
    );
  }

  return (
    <div className="recent-reviews-sidebar">
      <h3>C√°c review g·∫ßn ƒë√¢y</h3>
      <div className="recent-reviews-list">
        {reviews.map((review) => (
          <div key={review.id} className="recent-review-item">
            <div className="recent-review-header">
              <span className="review-role">
                {review.job_title || 'Nh√¢n vi√™n'}
              </span>
              <span className="review-time">{formatTimeAgo(review.created_at)}</span>
            </div>
            <div className="recent-review-company">
              <Link to={`/companies/${review.company_id}`}>
                {review.company?.name || 'C√¥ng ty'}
              </Link>
            </div>
            <div className="recent-review-content">
              <p>{review.title}</p>
              <div className="review-excerpt">
                {review.reviews_content?.substring(0, 100)}
                {review.reviews_content?.length > 100 && '...'}
              </div>
            </div>
            <div className="recent-review-footer">
              <span className="review-score">‚≠ê {review.score}/10</span>
              {review.is_anonymous ? (
                <span className="review-author">·∫®n danh</span>
              ) : (
                <span className="review-author">{review.user_name || 'Ng∆∞·ªùi d√πng'}</span>
              )}
            </div>
          </div>
        ))}
      </div>
    </div>
  );
};

export default RecentReviews;
</file>

<file path="FE/src/components/ReplyItem.jsx">
import './ReplyItem.css';

const ReplyItem = ({ reply, onUpdate }) => {
  return (
    <div className="reply-item">
      <div className="reply-content">
        <p>{reply.content}</p>
        {reply.is_edited && <span className="edited-badge">(ƒë√£ ch·ªânh s·ª≠a)</span>}
      </div>
      <div className="reply-meta">
        <span>Ng∆∞·ªùi d√πng</span>
        <span>{new Date(reply.created_at).toLocaleDateString('vi-VN')}</span>
      </div>
    </div>
  );
};

export default ReplyItem;
</file>

<file path="FE/src/components/StarRating.css">
.star-rating {
  display: flex;
  align-items: center;
  gap: 4px;
  flex-wrap: wrap;
}

.star {
  font-size: 24px;
  cursor: pointer;
  transition: all 0.2s ease;
  color: #ddd;
  user-select: none;
  line-height: 1;
  position: relative;
}

.star.filled {
  color: #ffc107;
  filter: drop-shadow(0 0 3px rgba(255, 193, 7, 0.6));
  text-shadow: 0 0 4px rgba(255, 193, 7, 0.4);
}

.star:not(.filled) {
  color: #e0e0e0;
  opacity: 0.5;
}

.star:not(.disabled):hover {
  transform: scale(1.15);
}

.star.filled:not(.disabled):hover {
  filter: drop-shadow(0 0 5px rgba(255, 193, 7, 0.8));
  transform: scale(1.15);
}

.star.disabled {
  cursor: default;
}

.star-value {
  margin-left: 8px;
  font-size: 14px;
  font-weight: 600;
  color: var(--glassdoor-gray);
}

@media (max-width: 768px) {
  .star {
    font-size: 20px;
  }
  
  .star-value {
    font-size: 12px;
  }
}
</file>

<file path="FE/src/components/StarRating.jsx">
import { useState } from 'react';
import './StarRating.css';

const StarRating = ({ value = 0, onChange, disabled = false }) => {
  const [hoveredStar, setHoveredStar] = useState(0);

  const handleStarClick = (starValue) => {
    if (!disabled && onChange) {
      onChange(starValue);
    }
  };

  const handleStarHover = (starValue) => {
    if (!disabled) {
      setHoveredStar(starValue);
    }
  };

  const handleMouseLeave = () => {
    if (!disabled) {
      setHoveredStar(0);
    }
  };

  const displayValue = hoveredStar || value;

  return (
    <div className="star-rating" onMouseLeave={handleMouseLeave}>
      {[1, 2, 3, 4, 5, 6, 7, 8, 9, 10].map((star) => (
        <span
          key={star}
          className={`star ${star <= displayValue ? 'filled' : ''} ${disabled ? 'disabled' : ''}`}
          onClick={() => handleStarClick(star)}
          onMouseEnter={() => handleStarHover(star)}
        >
          ‚≠ê
        </span>
      ))}
      {value > 0 && <span className="star-value">{value}/10</span>}
    </div>
  );
};

export default StarRating;
</file>

<file path="FE/src/hooks/useCompanies.js">
import { useQuery } from '@tanstack/react-query';
import { companyService } from '../services/companyService';

export const useCompanies = (options = {}) => {
  const { searchQuery, page, perPage, enabled = true } = options;

  return useQuery({
    queryKey: ['companies', searchQuery, page, perPage],
    queryFn: () => companyService.getCompanies(searchQuery, { page, perPage }),
    enabled,
    staleTime: 30000,
    gcTime: 5 * 60 * 1000,
  });
};

export const useTopRatedCompanies = (enabled = true) => {
  return useQuery({
    queryKey: ['companies', 'top-rated'],
    queryFn: () => companyService.getTopRatedCompanies(),
    enabled,
    staleTime: 60000,
    gcTime: 10 * 60 * 1000,
  });
};

export const useRemainingCompanies = (excludeIds = [], limit = 20, enabled = true) => {
  return useQuery({
    queryKey: ['companies', 'remaining', excludeIds.join(','), limit],
    queryFn: () => companyService.getRemainingCompanies(excludeIds, { limit }),
    enabled: enabled && excludeIds.length > 0,
    staleTime: 30000,
    gcTime: 5 * 60 * 1000,
  });
};
</file>

<file path="FE/src/hooks/useCompany.js">
import { useQuery } from '@tanstack/react-query';
import { companyService } from '../services/companyService';

export const useCompany = (companyId, enabled = true) => {
  return useQuery({
    queryKey: ['company', companyId],
    queryFn: () => companyService.getCompanyOverview(companyId),
    enabled: enabled && !!companyId,
    staleTime: 60000,
    gcTime: 10 * 60 * 1000,
  });
};
</file>

<file path="FE/src/hooks/useCompanyMutations.js">
import { useMutation, useQueryClient } from '@tanstack/react-query';
import { companyService } from '../services/companyService';

export const useCompanyMutations = () => {
  const queryClient = useQueryClient();

  const createMutation = useMutation({
    mutationFn: (companyData) => companyService.createCompany(companyData),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['companies'] });
      queryClient.invalidateQueries({ queryKey: ['companies', 'top-rated'] });
      queryClient.invalidateQueries({ queryKey: ['companies', 'remaining'] });
    },
  });

  const updateMutation = useMutation({
    mutationFn: ({ companyId, companyData }) => 
      companyService.updateCompany(companyId, companyData),
    onSuccess: (data, variables) => {
      queryClient.invalidateQueries({ queryKey: ['company', variables.companyId] });
      queryClient.invalidateQueries({ queryKey: ['companies'] });
    },
  });

  const deleteMutation = useMutation({
    mutationFn: (companyId) => companyService.deleteCompany(companyId),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['companies'] });
      queryClient.invalidateQueries({ queryKey: ['companies', 'top-rated'] });
      queryClient.invalidateQueries({ queryKey: ['companies', 'remaining'] });
    },
  });

  return {
    createCompany: createMutation.mutate,
    updateCompany: updateMutation.mutate,
    deleteCompany: deleteMutation.mutate,
    isCreating: createMutation.isPending,
    isUpdating: updateMutation.isPending,
    isDeleting: deleteMutation.isPending,
    createCompanyAsync: createMutation.mutateAsync,
    updateCompanyAsync: updateMutation.mutateAsync,
    deleteCompanyAsync: deleteMutation.mutateAsync,
  };
};
</file>

<file path="FE/src/hooks/useFavoriteMutations.js">
import { useMutation, useQueryClient } from '@tanstack/react-query';
import { favoriteService } from '../services/favoriteService';

export const useFavoriteMutations = () => {
  const queryClient = useQueryClient();

  const addFavoriteMutation = useMutation({
    mutationFn: (companyId) => favoriteService.addFavorite(companyId),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['favorites'] });
      queryClient.invalidateQueries({ queryKey: ['favorite-status'] });
    },
  });

  const removeFavoriteMutation = useMutation({
    mutationFn: (companyId) => favoriteService.removeFavorite(companyId),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['favorites'] });
      queryClient.invalidateQueries({ queryKey: ['favorite-status'] });
    },
  });

  return {
    addFavorite: addFavoriteMutation.mutate,
    removeFavorite: removeFavoriteMutation.mutate,
    isAdding: addFavoriteMutation.isPending,
    isRemoving: removeFavoriteMutation.isPending,
    addFavoriteAsync: addFavoriteMutation.mutateAsync,
    removeFavoriteAsync: removeFavoriteMutation.mutateAsync,
  };
};
</file>

<file path="FE/src/hooks/useFavorites.js">
import { useQuery } from '@tanstack/react-query';
import { favoriteService } from '../services/favoriteService';

export const useFavorites = (enabled = true) => {
  return useQuery({
    queryKey: ['favorites'],
    queryFn: () => favoriteService.getFavorites(),
    enabled,
    staleTime: 30000,
    gcTime: 5 * 60 * 1000,
  });
};

export const useFavoriteStatus = (companyId, enabled = true) => {
  return useQuery({
    queryKey: ['favorite-status', companyId],
    queryFn: () => favoriteService.checkFavorite(companyId),
    enabled: enabled && !!companyId,
    staleTime: 30000,
    gcTime: 5 * 60 * 1000,
  });
};
</file>

<file path="FE/src/hooks/useRecentReviews.js">
import { useQuery } from '@tanstack/react-query';
import { reviewService } from '../services/reviewService';

export const useRecentReviews = (limit = 10, enabled = true) => {
  return useQuery({
    queryKey: ['recent-reviews', limit],
    queryFn: () => reviewService.getRecentReviews(limit),
    enabled: enabled,
    staleTime: 30000,
    gcTime: 5 * 60 * 1000,
  });
};
</file>

<file path="FE/src/hooks/useReplyMutations.js">
import { useMutation, useQueryClient } from '@tanstack/react-query';
import { replyService } from '../services/replyService';
import { useAuth } from '../contexts/AuthContext';

export const useReplyMutations = (reviewId) => {
  const queryClient = useQueryClient();
  const { user } = useAuth();

  const createMutation = useMutation({
    mutationFn: (content) => replyService.createReply(reviewId, content),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['replies', reviewId] });
      if (user?.id) {
        queryClient.invalidateQueries({ queryKey: ['user-activity-stats'] });
        queryClient.invalidateQueries({ queryKey: ['user-recent-comments'] });
      }
    },
  });

  const updateMutation = useMutation({
    mutationFn: ({ replyId, content }) => replyService.updateReply(replyId, content),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['replies'] });
      if (user?.id) {
        queryClient.invalidateQueries({ queryKey: ['user-recent-comments'] });
      }
    },
  });

  const deleteMutation = useMutation({
    mutationFn: (replyId) => replyService.deleteReply(replyId),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['replies'] });
      if (user?.id) {
        queryClient.invalidateQueries({ queryKey: ['user-activity-stats'] });
        queryClient.invalidateQueries({ queryKey: ['user-recent-comments'] });
      }
    },
  });

  return {
    createReply: createMutation.mutate,
    updateReply: updateMutation.mutate,
    deleteReply: deleteMutation.mutate,
    isCreating: createMutation.isPending,
    isUpdating: updateMutation.isPending,
    isDeleting: deleteMutation.isPending,
    createReplyAsync: createMutation.mutateAsync,
    updateReplyAsync: updateMutation.mutateAsync,
    deleteReplyAsync: deleteMutation.mutateAsync,
  };
};
</file>

<file path="FE/src/hooks/useUserActivity.js">
import { useQuery } from '@tanstack/react-query';
import { userService } from '../services/userService';
import { useAuth } from '../contexts/AuthContext';

export const useUserActivityStats = (enabled = true) => {
  const { isAuthenticated } = useAuth();
  
  return useQuery({
    queryKey: ['user-activity-stats'],
    queryFn: () => userService.getActivityStats(),
    enabled: enabled && isAuthenticated,
    staleTime: 30000,
    gcTime: 5 * 60 * 1000,
  });
};

export const useUserRecentComments = (limit = 10, enabled = true) => {
  const { isAuthenticated } = useAuth();
  
  return useQuery({
    queryKey: ['user-recent-comments', limit],
    queryFn: () => userService.getRecentComments(limit),
    enabled: enabled && isAuthenticated,
    staleTime: 30000,
    gcTime: 5 * 60 * 1000,
  });
};
</file>

<file path="FE/src/pages/About.css">
.about-container {
  padding: 0;
  background: var(--glassdoor-gray-bg);
  min-height: calc(100vh - 64px - 200px);
}

.about-header {
  background: var(--glassdoor-white);
  padding: 48px 24px;
  border-bottom: 1px solid var(--glassdoor-border);
  text-align: center;
}

.back-link {
  display: inline-flex;
  align-items: center;
  margin-bottom: 24px;
  color: var(--glassdoor-green);
  text-decoration: none;
  font-size: 16px;
  font-weight: 500;
  transition: all 0.2s ease;
  padding: 8px 12px;
  border-radius: 6px;
}

.back-link:hover {
  background-color: var(--glassdoor-green-light);
  color: var(--glassdoor-green-dark);
}

.about-header h1 {
  font-size: 42px;
  font-weight: 700;
  color: var(--glassdoor-gray);
  margin: 0 0 16px 0;
  letter-spacing: -0.5px;
}

.about-subtitle {
  font-size: 20px;
  color: var(--glassdoor-gray-light);
  margin: 0;
}

.about-content {
  max-width: 1000px;
  margin: 0 auto;
  padding: 48px 24px;
}

.about-section {
  margin-bottom: 48px;
  background: var(--glassdoor-white);
  padding: 40px;
  border-radius: 12px;
  box-shadow: 0 2px 8px var(--glassdoor-shadow);
  border: 1px solid var(--glassdoor-border);
}

.about-section h2 {
  font-size: 28px;
  font-weight: 700;
  color: var(--glassdoor-gray);
  margin: 0 0 24px 0;
}

.about-section p {
  font-size: 16px;
  line-height: 1.8;
  color: var(--glassdoor-gray);
  margin-bottom: 16px;
}

.mission-list {
  list-style: none;
  padding: 0;
  margin: 24px 0;
}

.mission-list li {
  padding: 12px 0 12px 32px;
  position: relative;
  font-size: 16px;
  line-height: 1.6;
  color: var(--glassdoor-gray);
}

.mission-list li::before {
  content: '‚úì';
  position: absolute;
  left: 0;
  color: var(--glassdoor-green);
  font-weight: 700;
  font-size: 20px;
}

.features-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 24px;
  margin-top: 32px;
}

.feature-card {
  background: var(--glassdoor-gray-bg);
  padding: 32px 24px;
  border-radius: 12px;
  text-align: center;
  border: 1px solid var(--glassdoor-border);
  transition: all 0.3s ease;
}

.feature-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 16px var(--glassdoor-shadow);
  border-color: var(--glassdoor-green-light);
}

.feature-icon {
  font-size: 48px;
  margin-bottom: 16px;
}

.feature-card h3 {
  font-size: 20px;
  font-weight: 600;
  color: var(--glassdoor-gray);
  margin: 0 0 12px 0;
}

.feature-card p {
  font-size: 14px;
  line-height: 1.6;
  color: var(--glassdoor-gray-light);
  margin: 0;
}

.contact-info {
  margin-top: 24px;
}

.contact-info p {
  font-size: 16px;
  line-height: 1.8;
  margin-bottom: 12px;
}

.contact-info a {
  color: var(--glassdoor-green);
  text-decoration: none;
  font-weight: 500;
  transition: color 0.2s;
}

.contact-info a:hover {
  color: var(--glassdoor-green-dark);
  text-decoration: underline;
}

/* Responsive - Mobile */
@media (max-width: 768px) {
  .about-header {
    padding: 32px 16px;
  }

  .about-header h1 {
    font-size: 32px;
  }

  .about-subtitle {
    font-size: 16px;
  }

  .about-content {
    padding: 24px 16px;
  }

  .about-section {
    padding: 24px;
    margin-bottom: 24px;
  }

  .about-section h2 {
    font-size: 24px;
  }

  .features-grid {
    grid-template-columns: 1fr;
    gap: 16px;
  }
}
</file>

<file path="FE/src/pages/About.jsx">
import { Link } from 'react-router-dom';
import './About.css';

const About = () => {
  return (
    <div className="about-container">
      <div className="about-header">
        <Link to="/" className="back-link">‚Üê Quay l·∫°i trang ch·ªß</Link>
        <h1>V·ªÅ ReviewCompany</h1>
        <p className="about-subtitle">N·ªÅn t·∫£ng ƒë√°nh gi√° c√¥ng ty uy t√≠n v√† minh b·∫°ch</p>
      </div>

      <div className="about-content">
        <section className="about-section">
          <h2>Ch√∫ng t√¥i l√† ai?</h2>
          <p>
            ReviewCompany l√† n·ªÅn t·∫£ng ƒë√°nh gi√° c√¥ng ty h√†ng ƒë·∫ßu, gi√∫p ng∆∞·ªùi t√¨m vi·ªác v√† nh√¢n vi√™n 
            chia s·∫ª tr·∫£i nghi·ªám th·ª±c t·∫ø v·ªÅ m√¥i tr∆∞·ªùng l√†m vi·ªác, vƒÉn h√≥a c√¥ng ty, v√† c√°c kh√≠a c·∫°nh 
            kh√°c c·ªßa c√¥ng vi·ªác.
          </p>
          <p>
            M·ª•c ti√™u c·ªßa ch√∫ng t√¥i l√† t·∫°o ra m·ªôt c·ªông ƒë·ªìng minh b·∫°ch, n∆°i m·ªçi ng∆∞·ªùi c√≥ th·ªÉ ƒë∆∞a ra 
            quy·∫øt ƒë·ªãnh ngh·ªÅ nghi·ªáp s√°ng su·ªët d·ª±a tr√™n th√¥ng tin th·ª±c t·∫ø t·ª´ nh·ªØng ng∆∞·ªùi ƒë√£ t·ª´ng 
            l√†m vi·ªác t·∫°i c√°c c√¥ng ty.
          </p>
        </section>

        <section className="about-section">
          <h2>S·ª© m·ªánh c·ªßa ch√∫ng t√¥i</h2>
          <p>
            Ch√∫ng t√¥i tin r·∫±ng m·ªçi ng∆∞·ªùi ƒë·ªÅu x·ª©ng ƒë√°ng c√≥ th√¥ng tin ƒë·∫ßy ƒë·ªß v·ªÅ n∆°i h·ªç s·∫Ω l√†m vi·ªác. 
            B·∫±ng c√°ch k·∫øt n·ªëi ng∆∞·ªùi t√¨m vi·ªác v·ªõi nh·ªØng tr·∫£i nghi·ªám th·ª±c t·∫ø, ch√∫ng t√¥i gi√∫p:
          </p>
          <ul className="mission-list">
            <li>Ng∆∞·ªùi t√¨m vi·ªác ƒë∆∞a ra quy·∫øt ƒë·ªãnh ngh·ªÅ nghi·ªáp s√°ng su·ªët</li>
            <li>C√¥ng ty c·∫£i thi·ªán m√¥i tr∆∞·ªùng l√†m vi·ªác d·ª±a tr√™n ph·∫£n h·ªìi th·ª±c t·∫ø</li>
            <li>T·∫°o ra m·ªôt th·ªã tr∆∞·ªùng lao ƒë·ªông minh b·∫°ch v√† c√¥ng b·∫±ng h∆°n</li>
          </ul>
        </section>

        <section className="about-section">
          <h2>T√≠nh nƒÉng ch√≠nh</h2>
          <div className="features-grid">
            <div className="feature-card">
              <div className="feature-icon">‚≠ê</div>
              <h3>ƒê√°nh gi√° c√¥ng ty</h3>
              <p>Xem v√† ƒë√°nh gi√° c√°c c√¥ng ty d·ª±a tr√™n nhi·ªÅu ti√™u ch√≠ kh√°c nhau</p>
            </div>
            <div className="feature-card">
              <div className="feature-icon">üí¨</div>
              <h3>B√¨nh lu·∫≠n v√† ph·∫£n h·ªìi</h3>
              <p>Th·∫£o lu·∫≠n v√† chia s·∫ª kinh nghi·ªám v·ªõi c·ªông ƒë·ªìng</p>
            </div>
            <div className="feature-card">
              <div className="feature-icon">üîç</div>
              <h3>T√¨m ki·∫øm th√¥ng minh</h3>
              <p>T√¨m ki·∫øm c√¥ng ty theo t√™n, ƒë·ªãa ƒëi·ªÉm, ho·∫∑c t·ª´ kh√≥a</p>
            </div>
            <div className="feature-card">
              <div className="feature-icon">üèÜ</div>
              <h3>X·∫øp h·∫°ng c√¥ng ty</h3>
              <p>Xem top c√°c c√¥ng ty ƒë∆∞·ª£c ƒë√°nh gi√° cao nh·∫•t</p>
            </div>
          </div>
        </section>

        <section className="about-section">
          <h2>Li√™n h·ªá v·ªõi ch√∫ng t√¥i</h2>
          <div className="contact-info">
            <p>
              <strong>Email:</strong>{' '}
              <a href="mailto:contact@reviewcompany.com">contact@reviewcompany.com</a>
            </p>
            <p>
              <strong>ƒêi·ªán tho·∫°i:</strong>{' '}
              <a href="tel:+84123456789">+84 123 456 789</a>
            </p>
            <p>
              <strong>ƒê·ªãa ch·ªâ:</strong> 123 ƒê∆∞·ªùng ABC, Qu·∫≠n XYZ, TP. H·ªì Ch√≠ Minh, Vi·ªát Nam
            </p>
          </div>
        </section>
      </div>
    </div>
  );
};

export default About;
</file>

<file path="FE/src/pages/FAQ.css">
.faq-container {
  padding: 0;
  background: var(--glassdoor-gray-bg);
  min-height: calc(100vh - 64px - 200px);
}

.faq-header {
  background: var(--glassdoor-white);
  padding: 48px 24px;
  border-bottom: 1px solid var(--glassdoor-border);
  text-align: center;
}

.back-link {
  display: inline-flex;
  align-items: center;
  margin-bottom: 24px;
  color: var(--glassdoor-green);
  text-decoration: none;
  font-size: 16px;
  font-weight: 500;
  transition: all 0.2s ease;
  padding: 8px 12px;
  border-radius: 6px;
}

.back-link:hover {
  background-color: var(--glassdoor-green-light);
  color: var(--glassdoor-green-dark);
}

.faq-header h1 {
  font-size: 42px;
  font-weight: 700;
  color: var(--glassdoor-gray);
  margin: 0 0 16px 0;
  letter-spacing: -0.5px;
}

.faq-subtitle {
  font-size: 20px;
  color: var(--glassdoor-gray-light);
  margin: 0;
}

.faq-content {
  max-width: 800px;
  margin: 0 auto;
  padding: 48px 24px;
}

.faq-list {
  margin-bottom: 48px;
}

.faq-item {
  background: var(--glassdoor-white);
  border: 1px solid var(--glassdoor-border);
  border-radius: 12px;
  margin-bottom: 16px;
  overflow: hidden;
  transition: all 0.3s ease;
}

.faq-item:hover {
  box-shadow: 0 4px 12px var(--glassdoor-shadow);
}

.faq-item.open {
  border-color: var(--glassdoor-green-light);
}

.faq-question {
  width: 100%;
  padding: 24px;
  background: none;
  border: none;
  text-align: left;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 18px;
  font-weight: 600;
  color: var(--glassdoor-gray);
  transition: all 0.2s ease;
}

.faq-question:hover {
  color: var(--glassdoor-green);
}

.faq-question-text {
  flex: 1;
  padding-right: 16px;
}

.faq-icon {
  font-size: 24px;
  font-weight: 300;
  color: var(--glassdoor-green);
  min-width: 24px;
  transition: transform 0.3s ease;
}

.faq-item.open .faq-icon {
  transform: rotate(180deg);
}

.faq-answer {
  padding: 0 24px 24px 24px;
  animation: slideDown 0.3s ease;
}

.faq-answer p {
  font-size: 16px;
  line-height: 1.8;
  color: var(--glassdoor-gray);
  margin: 0;
}

@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.faq-contact {
  background: var(--glassdoor-white);
  padding: 40px;
  border-radius: 12px;
  box-shadow: 0 2px 8px var(--glassdoor-shadow);
  border: 1px solid var(--glassdoor-border);
  text-align: center;
}

.faq-contact h2 {
  font-size: 24px;
  font-weight: 700;
  color: var(--glassdoor-gray);
  margin: 0 0 16px 0;
}

.faq-contact p {
  font-size: 16px;
  color: var(--glassdoor-gray-light);
  margin: 0 0 24px 0;
}

.contact-buttons {
  display: flex;
  gap: 16px;
  justify-content: center;
  flex-wrap: wrap;
}

.contact-btn {
  padding: 12px 24px;
  background: var(--glassdoor-green);
  color: white;
  text-decoration: none;
  border-radius: 8px;
  font-size: 16px;
  font-weight: 600;
  transition: all 0.2s ease;
  display: inline-block;
}

.contact-btn:hover {
  background: var(--glassdoor-green-dark);
  transform: translateY(-2px);
  box-shadow: 0 4px 8px var(--glassdoor-shadow);
}

/* Responsive - Mobile */
@media (max-width: 768px) {
  .faq-header {
    padding: 32px 16px;
  }

  .faq-header h1 {
    font-size: 32px;
  }

  .faq-subtitle {
    font-size: 16px;
  }

  .faq-content {
    padding: 24px 16px;
  }

  .faq-question {
    padding: 20px;
    font-size: 16px;
  }

  .faq-answer {
    padding: 0 20px 20px 20px;
  }

  .faq-contact {
    padding: 24px;
  }

  .contact-buttons {
    flex-direction: column;
  }

  .contact-btn {
    width: 100%;
  }
}
</file>

<file path="FE/src/pages/FAQ.jsx">
import { useState } from 'react';
import { Link } from 'react-router-dom';
import './FAQ.css';

const FAQ = () => {
  const [openIndex, setOpenIndex] = useState(null);

  const faqs = [
    {
      question: 'ReviewCompany l√† g√¨?',
      answer: 'ReviewCompany l√† n·ªÅn t·∫£ng cho ph√©p ng∆∞·ªùi d√πng ƒë√°nh gi√° v√† chia s·∫ª tr·∫£i nghi·ªám v·ªÅ c√°c c√¥ng ty. Ch√∫ng t√¥i gi√∫p ng∆∞·ªùi t√¨m vi·ªác c√≥ th√¥ng tin ƒë·∫ßy ƒë·ªß v·ªÅ m√¥i tr∆∞·ªùng l√†m vi·ªác tr∆∞·ªõc khi ·ª©ng tuy·ªÉn.'
    },
    {
      question: 'L√†m th·∫ø n√†o ƒë·ªÉ ƒë√°nh gi√° m·ªôt c√¥ng ty?',
      answer: 'ƒê·ªÉ ƒë√°nh gi√° c√¥ng ty, b·∫°n c·∫ßn ƒëƒÉng nh·∫≠p v√†o t√†i kho·∫£n. Sau ƒë√≥, t√¨m c√¥ng ty b·∫°n mu·ªën ƒë√°nh gi√° v√† nh·∫•p v√†o n√∫t "Vi·∫øt ƒë√°nh gi√°". B·∫°n c√≥ th·ªÉ ƒë√°nh gi√° theo thang ƒëi·ªÉm t·ª´ 1-10 v√† vi·∫øt nh·∫≠n x√©t chi ti·∫øt.'
    },
    {
      question: 'T√¥i c√≥ th·ªÉ ƒë√°nh gi√° ·∫©n danh kh√¥ng?',
      answer: 'C√≥, b·∫°n c√≥ th·ªÉ ch·ªçn ƒë√°nh gi√° ·∫©n danh khi t·∫°o ƒë√°nh gi√°. Tuy nhi√™n, ch√∫ng t√¥i khuy·∫øn kh√≠ch b·∫°n ƒë√°nh gi√° c√¥ng khai ƒë·ªÉ tƒÉng t√≠nh minh b·∫°ch v√† uy t√≠n c·ªßa ƒë√°nh gi√°.'
    },
    {
      question: 'L√†m th·∫ø n√†o ƒë·ªÉ t√¨m ki·∫øm c√¥ng ty?',
      answer: 'B·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng thanh t√¨m ki·∫øm ·ªü trang ch·ªß ƒë·ªÉ t√¨m c√¥ng ty theo t√™n, ƒë·ªãa ƒëi·ªÉm, ho·∫∑c t·ª´ kh√≥a. N·∫øu kh√¥ng t√¨m th·∫•y c√¥ng ty b·∫°n mu·ªën, b·∫°n c√≥ th·ªÉ t·∫°o c√¥ng ty m·ªõi (c·∫ßn ƒëƒÉng nh·∫≠p).'
    },
    {
      question: 'ƒêi·ªÉm ƒë√°nh gi√° ƒë∆∞·ª£c t√≠nh nh∆∞ th·∫ø n√†o?',
      answer: 'ƒêi·ªÉm ƒë√°nh gi√° trung b√¨nh c·ªßa c√¥ng ty ƒë∆∞·ª£c t√≠nh d·ª±a tr√™n t·∫•t c·∫£ c√°c ƒë√°nh gi√° m√† c√¥ng ty nh·∫≠n ƒë∆∞·ª£c. ƒêi·ªÉm ƒë∆∞·ª£c l√†m tr√≤n ƒë·∫øn 1 ch·ªØ s·ªë th·∫≠p ph√¢n.'
    },
    {
      question: 'T√¥i c√≥ th·ªÉ ch·ªânh s·ª≠a ho·∫∑c x√≥a ƒë√°nh gi√° c·ªßa m√¨nh kh√¥ng?',
      answer: 'Hi·ªán t·∫°i, b·∫°n c√≥ th·ªÉ ch·ªânh s·ª≠a ƒë√°nh gi√° c·ªßa m√¨nh. T√≠nh nƒÉng x√≥a ƒë√°nh gi√° ƒëang ƒë∆∞·ª£c ph√°t tri·ªÉn v√† s·∫Ω s·ªõm c√≥ m·∫∑t.'
    },
    {
      question: 'L√†m th·∫ø n√†o ƒë·ªÉ b√°o c√°o ƒë√°nh gi√° kh√¥ng ph√π h·ª£p?',
      answer: 'N·∫øu b·∫°n ph√°t hi·ªán ƒë√°nh gi√° vi ph·∫°m quy t·∫Øc c·ªông ƒë·ªìng, vui l√≤ng li√™n h·ªá v·ªõi ch√∫ng t√¥i qua email contact@reviewcompany.com v·ªõi th√¥ng tin chi ti·∫øt v·ªÅ ƒë√°nh gi√° ƒë√≥.'
    },
    {
      question: 'T√¥i c√≥ th·ªÉ t·∫°o nhi·ªÅu c√¥ng ty kh√¥ng?',
      answer: 'C√≥, b·∫°n c√≥ th·ªÉ t·∫°o nhi·ªÅu c√¥ng ty. Tuy nhi√™n, ch√∫ng t√¥i khuy·∫øn kh√≠ch b·∫°n ki·ªÉm tra xem c√¥ng ty ƒë√£ t·ªìn t·∫°i ch∆∞a tr∆∞·ªõc khi t·∫°o m·ªõi ƒë·ªÉ tr√°nh tr√πng l·∫∑p.'
    }
  ];

  const toggleFAQ = (index) => {
    setOpenIndex(openIndex === index ? null : index);
  };

  return (
    <div className="faq-container">
      <div className="faq-header">
        <Link to="/" className="back-link">‚Üê Quay l·∫°i trang ch·ªß</Link>
        <h1>C√¢u h·ªèi th∆∞·ªùng g·∫∑p</h1>
        <p className="faq-subtitle">T√¨m c√¢u tr·∫£ l·ªùi cho c√°c c√¢u h·ªèi ph·ªï bi·∫øn</p>
      </div>

      <div className="faq-content">
        <div className="faq-list">
          {faqs.map((faq, index) => (
            <div key={index} className={`faq-item ${openIndex === index ? 'open' : ''}`}>
              <button
                className="faq-question"
                onClick={() => toggleFAQ(index)}
                aria-expanded={openIndex === index}
              >
                <span className="faq-question-text">{faq.question}</span>
                <span className="faq-icon">{openIndex === index ? '‚àí' : '+'}</span>
              </button>
              {openIndex === index && (
                <div className="faq-answer">
                  <p>{faq.answer}</p>
                </div>
              )}
            </div>
          ))}
        </div>

        <div className="faq-contact">
          <h2>Kh√¥ng t√¨m th·∫•y c√¢u tr·∫£ l·ªùi?</h2>
          <p>N·∫øu b·∫°n c√≥ c√¢u h·ªèi kh√°c, vui l√≤ng li√™n h·ªá v·ªõi ch√∫ng t√¥i:</p>
          <div className="contact-buttons">
            <a href="mailto:contact@reviewcompany.com" className="contact-btn">
              üìß G·ª≠i email
            </a>
            <Link to="/contact" className="contact-btn">
              üìù Li√™n h·ªá
            </Link>
          </div>
        </div>
      </div>
    </div>
  );
};

export default FAQ;
</file>

<file path="FE/src/pages/Login.jsx">
import { useState } from 'react';
import { useNavigate, Link } from 'react-router-dom';
import { useAuth } from '../contexts/AuthContext';
import { API_BASE_URL } from '../config/api';
import './Login.css';

const Login = () => {
  const [email, setEmail] = useState('');
  const [password, setPassword] = useState('');
  const [error, setError] = useState('');
  const [loading, setLoading] = useState(false);
  const { login } = useAuth();
  const navigate = useNavigate();

  const handleSubmit = async (e) => {
    e.preventDefault();
    setError('');
    setLoading(true);

    const result = await login(email, password);
    
    if (result.success) {
      navigate('/');
    } else {
      setError(result.error || 'Login failed');
    }
    
    setLoading(false);
  };

  return (
    <div className="login-container">
      <div className="login-card">
        <h2>ƒêƒÉng nh·∫≠p</h2>
        {error && (
          <div className="error-message">
            <p style={{ whiteSpace: 'pre-line', marginBottom: '10px' }}>{error}</p>
            {(error.includes('Network Error') || error.includes('k·∫øt n·ªëi ƒë·∫øn server')) && (
              <div style={{ marginTop: '10px', fontSize: '12px', color: '#721c24', background: '#f8d7da', padding: '10px', borderRadius: '5px' }}>
                <p style={{ marginBottom: '5px' }}><strong>URL hi·ªán t·∫°i:</strong> <code>{API_BASE_URL}</code></p>
                <p style={{ marginTop: '5px', marginBottom: '0' }}>üí° C·∫≠p nh·∫≠t file <code>FE/.env</code> v·ªõi ngrok URL v√† restart Vite server</p>
              </div>
            )}
            {(error.includes('404') || error.includes('kh√¥ng t√¨m th·∫•y')) && (
              <div style={{ marginTop: '10px', fontSize: '12px', color: '#721c24', background: '#f8d7da', padding: '10px', borderRadius: '5px' }}>
                <p style={{ marginBottom: '5px' }}><strong>URL ƒëang g·ªçi:</strong> <code style={{ fontSize: '10px', wordBreak: 'break-all' }}>{API_BASE_URL}/auth/sign_in</code></p>
                <p style={{ marginTop: '10px', marginBottom: '5px' }}>üí° Ki·ªÉm tra:</p>
                <ul style={{ marginLeft: '20px', marginTop: '5px', marginBottom: '0' }}>
                  <li>Ngrok tunnel ƒëang ch·∫°y: <code>ngrok http 3000</code></li>
                  <li>Rails server ƒëang ch·∫°y: <code>rails s</code></li>
                  <li>URL trong <code>.env</code> ƒë√∫ng: <code>https://your-ngrok-url.ngrok-free.app/api/v1</code></li>
                  <li>Restart Vite server sau khi thay ƒë·ªïi <code>.env</code></li>
                </ul>
              </div>
            )}
          </div>
        )}
        <form onSubmit={handleSubmit}>
          <div className="form-group">
            <label>Email</label>
            <input
              type="email"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              required
              placeholder="your@email.com"
            />
          </div>
          <div className="form-group">
            <label>M·∫≠t kh·∫©u</label>
            <input
              type="password"
              value={password}
              onChange={(e) => setPassword(e.target.value)}
              required
              placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
            />
          </div>
          <button type="submit" disabled={loading} className="btn-primary">
            {loading ? 'ƒêang ƒëƒÉng nh·∫≠p...' : 'ƒêƒÉng nh·∫≠p'}
          </button>
        </form>
        <p className="register-link">
          Ch∆∞a c√≥ t√†i kho·∫£n? <Link to="/register">ƒêƒÉng k√Ω ngay</Link>
        </p>
      </div>
    </div>
  );
};

export default Login;
</file>

<file path="FE/src/pages/Register.jsx">
import { useState } from 'react';
import { useNavigate, Link } from 'react-router-dom';
import { useAuth } from '../contexts/AuthContext';
import './Register.css';

const Register = () => {
  const [formData, setFormData] = useState({
    email: '',
    password: '',
    password_confirmation: '',
    first_name: '',
    last_name: '',
    phone_number: '',
  });
  const [error, setError] = useState('');
  const [loading, setLoading] = useState(false);
  const { register } = useAuth();
  const navigate = useNavigate();

  const handleChange = (e) => {
    setFormData({
      ...formData,
      [e.target.name]: e.target.value,
    });
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setError('');

    if (formData.password !== formData.password_confirmation) {
      setError('M·∫≠t kh·∫©u kh√¥ng kh·ªõp');
      return;
    }

    setLoading(true);
    const result = await register(formData);
    
    if (result.success) {
      navigate('/');
    } else {
      setError(result.error || 'ƒêƒÉng k√Ω th·∫•t b·∫°i');
    }
    
    setLoading(false);
  };

  return (
    <div className="register-container">
      <div className="register-card">
        <h2>ƒêƒÉng k√Ω</h2>
        {error && <div className="error-message">{error}</div>}
        <form onSubmit={handleSubmit}>
          <div className="form-row">
            <div className="form-group">
              <label>H·ªç</label>
              <input
                type="text"
                name="last_name"
                value={formData.last_name}
                onChange={handleChange}
                required
                placeholder="Nguy·ªÖn"
              />
            </div>
            <div className="form-group">
              <label>T√™n</label>
              <input
                type="text"
                name="first_name"
                value={formData.first_name}
                onChange={handleChange}
                required
                placeholder="VƒÉn A"
              />
            </div>
          </div>
          <div className="form-group">
            <label>Email</label>
            <input
              type="email"
              name="email"
              value={formData.email}
              onChange={handleChange}
              required
              placeholder="your@email.com"
            />
          </div>
          <div className="form-group">
            <label>S·ªë ƒëi·ªán tho·∫°i</label>
            <input
              type="tel"
              name="phone_number"
              value={formData.phone_number}
              onChange={handleChange}
              placeholder="+84123456789"
            />
          </div>
          <div className="form-group">
            <label>M·∫≠t kh·∫©u</label>
            <input
              type="password"
              name="password"
              value={formData.password}
              onChange={handleChange}
              required
              placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
            />
          </div>
          <div className="form-group">
            <label>X√°c nh·∫≠n m·∫≠t kh·∫©u</label>
            <input
              type="password"
              name="password_confirmation"
              value={formData.password_confirmation}
              onChange={handleChange}
              required
              placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
            />
          </div>
          <button type="submit" disabled={loading} className="btn-primary">
            {loading ? 'ƒêang ƒëƒÉng k√Ω...' : 'ƒêƒÉng k√Ω'}
          </button>
        </form>
        <p className="login-link">
          ƒê√£ c√≥ t√†i kho·∫£n? <Link to="/login">ƒêƒÉng nh·∫≠p ngay</Link>
        </p>
      </div>
    </div>
  );
};

export default Register;
</file>

<file path="FE/src/services/authService.js">
import apiClient from './api';

// Authentication Services
export const authService = {
  // Sign Up
  signUp: async (userData) => {
    return await apiClient.post('/auth/sign_up', { user: userData });
  },

  // Sign In
  signIn: async (email, password) => {
    return await apiClient.post('/auth/sign_in', {
      user: { email, password }
    });
  },

  // Sign Out (clear local storage)
  signOut: () => {
    localStorage.removeItem('access_token');
    localStorage.removeItem('user');
    localStorage.removeItem('tenant');
  },

  // Get current user from localStorage
  getCurrentUser: () => {
    const userStr = localStorage.getItem('user');
    return userStr ? JSON.parse(userStr) : null;
  },

  // Check if user is authenticated
  isAuthenticated: () => {
    return !!localStorage.getItem('access_token');
  },
};
</file>

<file path="FE/src/services/favoriteService.js">
import apiClient from './api';

// Favorite Services
export const favoriteService = {
  // Get all favorite companies for current user
  getFavorites: async () => {
    return await apiClient.get('/favorite');
  },

  // Add company to favorites
  addFavorite: async (companyId) => {
    return await apiClient.post('/favorite', { favorite: { company_id: companyId } });
  },

  // Remove company from favorites
  removeFavorite: async (companyId) => {
    return await apiClient.delete(`/favorite/${companyId}`);
  },

  // Check if company is favorited
  checkFavorite: async (companyId) => {
    return await apiClient.get(`/favorite/check/${companyId}`);
  },
};
</file>

<file path="FE/src/services/replyService.js">
import apiClient from './api';

// Reply Services
export const replyService = {
  // Get replies for a review
  getReplies: async (reviewId) => {
    return await apiClient.get(`/reply?review_id=${reviewId}`);
  },

  // Create reply
  createReply: async (reviewId, content) => {
    return await apiClient.post(`/reply?review_id=${reviewId}`, { content });
  },

  // Update reply
  updateReply: async (replyId, content) => {
    return await apiClient.put(`/reply/${replyId}`, { content });
  },

  // Delete reply
  deleteReply: async (replyId) => {
    return await apiClient.delete(`/reply/${replyId}`);
  },
};
</file>

<file path="FE/src/main.jsx">
import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import './index.css'
import App from './App.jsx'

createRoot(document.getElementById('root')).render(
  <StrictMode>
    <App />
  </StrictMode>,
)
</file>

<file path="FE/.env.example">
VITE_API_BASE_URL=http://localhost:3000/api/v1
VITE_DEFAULT_TENANT=asia
</file>

<file path="FE/.gitignore">
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?

# Environment variables
.env
.env.local
.env.production
</file>

<file path="FE/eslint.config.js">
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{js,jsx}'],
    extends: [
      js.configs.recommended,
      reactHooks.configs.flat.recommended,
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
      parserOptions: {
        ecmaVersion: 'latest',
        ecmaFeatures: { jsx: true },
        sourceType: 'module',
      },
    },
    rules: {
      'no-unused-vars': ['error', { varsIgnorePattern: '^[A-Z_]' }],
    },
  },
])
</file>

<file path="FE/index.html">
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes" />
    <title>Review Company</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
</file>

<file path="FE/NODE_VERSION.md">
# Node.js Version Requirements

## Current Setup

Project hi·ªán t·∫°i ƒë√£ ƒë∆∞·ª£c downgrade ƒë·ªÉ t∆∞∆°ng th√≠ch v·ªõi **Node.js 18.20.4**.

## Recommended: Upgrade Node.js

ƒê·ªÉ s·ª≠ d·ª•ng c√°c t√≠nh nƒÉng m·ªõi nh·∫•t v√† t·ªët h∆°n, khuy·∫øn ngh·ªã n√¢ng c·∫•p Node.js l√™n **20.19+** ho·∫∑c **22.12+**.

### C√°ch n√¢ng c·∫•p Node.js

#### Option 1: S·ª≠ d·ª•ng nvm (Node Version Manager) - Recommended

```bash
# C√†i ƒë·∫∑t nvm (n·∫øu ch∆∞a c√≥)
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash

# Reload shell
source ~/.zshrc  # ho·∫∑c source ~/.bashrc

# C√†i ƒë·∫∑t Node.js 20 LTS
nvm install 20

# S·ª≠ d·ª•ng Node.js 20
nvm use 20

# Set l√†m default
nvm alias default 20

# Verify
node --version  # Should show v20.x.x
```

#### Option 2: S·ª≠ d·ª•ng Homebrew (macOS)

```bash
# C√†i ƒë·∫∑t Node.js 20
brew install node@20

# Link
brew link node@20

# Verify
node --version
```

#### Option 3: Download t·ª´ nodejs.org

T·∫£i v√† c√†i ƒë·∫∑t t·ª´: https://nodejs.org/

## Sau khi n√¢ng c·∫•p Node.js

N·∫øu ƒë√£ n√¢ng c·∫•p Node.js l√™n 20+, b·∫°n c√≥ th·ªÉ upgrade l·∫°i dependencies:

```bash
# Upgrade Vite v√† React
npm install vite@latest @vitejs/plugin-react@latest react@latest react-dom@latest react-router-dom@latest

# Ho·∫∑c ch·ªânh s·ª≠a package.json v√† ch·∫°y npm install
```

## Ki·ªÉm tra version

```bash
node --version
npm --version
```
</file>

<file path="FE/README.md">
# ReviewCompany Frontend

React frontend application cho ReviewCompany project.

## C√¥ng ngh·ªá s·ª≠ d·ª•ng

- **React 19** - UI library
- **Vite** - Build tool v√† dev server
- **React Router DOM** - Routing
- **Axios** - HTTP client
- **CSS3** - Styling

## C√†i ƒë·∫∑t

```bash
# C√†i ƒë·∫∑t dependencies
npm install

# Ch·∫°y development server
npm run dev

# Build cho production
npm run build

# Preview production build
npm run preview
```

## C·∫•u tr√∫c project

```
src/
‚îú‚îÄ‚îÄ components/          # Reusable components
‚îÇ   ‚îú‚îÄ‚îÄ Navbar.jsx
‚îÇ   ‚îú‚îÄ‚îÄ ProtectedRoute.jsx
‚îÇ   ‚îú‚îÄ‚îÄ ReviewList.jsx
‚îÇ   ‚îú‚îÄ‚îÄ ReviewItem.jsx
‚îÇ   ‚îú‚îÄ‚îÄ CreateReviewForm.jsx
‚îÇ   ‚îú‚îÄ‚îÄ ReplyList.jsx
‚îÇ   ‚îú‚îÄ‚îÄ ReplyItem.jsx
‚îÇ   ‚îî‚îÄ‚îÄ CreateReplyForm.jsx
‚îú‚îÄ‚îÄ pages/              # Page components
‚îÇ   ‚îú‚îÄ‚îÄ Home.jsx
‚îÇ   ‚îú‚îÄ‚îÄ Login.jsx
‚îÇ   ‚îú‚îÄ‚îÄ Register.jsx
‚îÇ   ‚îî‚îÄ‚îÄ CompanyDetail.jsx
‚îú‚îÄ‚îÄ services/           # API services
‚îÇ   ‚îú‚îÄ‚îÄ api.js
‚îÇ   ‚îú‚îÄ‚îÄ authService.js
‚îÇ   ‚îú‚îÄ‚îÄ companyService.js
‚îÇ   ‚îú‚îÄ‚îÄ reviewService.js
‚îÇ   ‚îú‚îÄ‚îÄ replyService.js
‚îÇ   ‚îî‚îÄ‚îÄ userService.js
‚îú‚îÄ‚îÄ contexts/           # React contexts
‚îÇ   ‚îî‚îÄ‚îÄ AuthContext.jsx
‚îú‚îÄ‚îÄ config/             # Configuration
‚îÇ   ‚îî‚îÄ‚îÄ api.js
‚îú‚îÄ‚îÄ App.jsx             # Main app component
‚îî‚îÄ‚îÄ main.jsx            # Entry point
```

## Environment Variables

T·∫°o file `.env` t·ª´ `.env.example`:

```bash
cp .env.example .env
```

C·∫•u h√¨nh:

```
VITE_API_BASE_URL=http://localhost:3000/api/v1
VITE_DEFAULT_TENANT=asia
```

## Features

### Authentication
- ƒêƒÉng k√Ω t√†i kho·∫£n
- ƒêƒÉng nh·∫≠p/ƒêƒÉng xu·∫•t
- JWT token management
- Protected routes

### Company
- Xem danh s√°ch c√¥ng ty
- Xem chi ti·∫øt c√¥ng ty
- T·∫°o/C·∫≠p nh·∫≠t/X√≥a c√¥ng ty (Admin/Owner)

### Review
- Xem danh s√°ch reviews
- T·∫°o review m·ªõi
- C·∫≠p nh·∫≠t/X√≥a review
- Like/Dislike review

### Reply
- Xem replies c·ªßa review
- T·∫°o reply m·ªõi
- C·∫≠p nh·∫≠t/X√≥a reply

## API Integration

Frontend s·ª≠ d·ª•ng API t·ª´ backend Rails. Xem [API Documentation](../docs/API_DOCUMENTATION.md) ƒë·ªÉ bi·∫øt chi ti·∫øt.

### Base URL

M·∫∑c ƒë·ªãnh: `http://localhost:3000/api/v1`

C√≥ th·ªÉ thay ƒë·ªïi qua environment variable `VITE_API_BASE_URL`.

### Authentication

Token ƒë∆∞·ª£c l∆∞u trong `localStorage` v·ªõi key `access_token` v√† t·ª± ƒë·ªông ƒë∆∞·ª£c th√™m v√†o headers c·ªßa m·ªói request.

### Multi-tenant

Tenant ƒë∆∞·ª£c l∆∞u trong `localStorage` v·ªõi key `tenant` v√† t·ª± ƒë·ªông ƒë∆∞·ª£c th√™m v√†o header `X-API-TENANT`.

## Development

```bash
# Start dev server (port 5173)
npm run dev

# Lint code
npm run lint
```

## Production Build

```bash
# Build
npm run build

# Output s·∫Ω ·ªü trong folder dist/
```

## Troubleshooting

### CORS Issues

N·∫øu g·∫∑p CORS errors, ƒë·∫£m b·∫£o backend ƒë√£ c·∫•u h√¨nh CORS ƒë√∫ng. Xem `config/initializers/cors.rb` trong backend.

### API Connection

Ki·ªÉm tra:
1. Backend ƒëang ch·∫°y tr√™n port 3000
2. `VITE_API_BASE_URL` ƒë√∫ng trong `.env`
3. Network tab trong browser DevTools

### Authentication

N·∫øu kh√¥ng ƒëƒÉng nh·∫≠p ƒë∆∞·ª£c:
1. Ki·ªÉm tra API response trong Network tab
2. Ki·ªÉm tra token c√≥ ƒë∆∞·ª£c l∆∞u trong localStorage
3. Ki·ªÉm tra headers trong requests

## License

[Th√™m license n·∫øu c√≥]
</file>

<file path="FE/vite.config.js">
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

// https://vite.dev/config/
export default defineConfig({
  plugins: [react()],
  server: {
    host: true,
    port: 5173,
    allowedHosts: [
      'advanced-unified-midge.ngrok-free.app',
      '.ngrok-free.app',
      '.ngrok.io',
      'localhost',
    ],
  },
  build: {
    outDir: 'dist',
    assetsDir: 'assets',
    // Ensure proper paths for production
    rollupOptions: {
      output: {
        manualChunks: undefined,
      },
    },
  },
})
</file>

<file path="lib/tasks/.keep">

</file>

<file path="lib/tasks/create_area.rake">
namespace :create_area do
  desc "Create area"
  task :create_default_area => :environment do
    list_tenant_name = [Tenant::ASIA_SCHEMA, Tenant::EUROPE_SCHEMA, Tenant::AMERICA_SCHEMA]
    list_tenant_name.each do |tenant_name|
      unless Area.exists?(name: tenant_name, tenant_name: tenant_name)
        Area.create(name: tenant_name, tenant_name: tenant_name, status: 1)
        puts "Area: #{tenant_name} created"
      end
    end
    puts 'Area created'
  end
end
</file>

<file path="log/.keep">

</file>

<file path="public/robots.txt">
# See https://www.robotstxt.org/robotstxt.html for documentation on how to use the robots.txt file
</file>

<file path="spec/models/area_spec.rb">
require 'rails_helper'

RSpec.describe Area, type: :model do
  pending "add some examples to (or delete) #{__FILE__}"
end
</file>

<file path="spec/models/company_spec.rb">
require 'rails_helper'

RSpec.describe Company, type: :model do
  pending "add some examples to (or delete) #{__FILE__}"
end
</file>

<file path="spec/models/role_spec.rb">
require 'rails_helper'

RSpec.describe Role, type: :model do
  pending "add some examples to (or delete) #{__FILE__}"
end
</file>

<file path="spec/models/user_spec.rb">
require 'rails_helper'

RSpec.describe User, type: :model do
  pending "add some examples to (or delete) #{__FILE__}"
end
</file>

<file path="spec/requests/company_spec.rb">
require 'rails_helper'

RSpec.describe "Companies", type: :request do
  describe "GET /index" do
    pending "add some examples (or delete) #{__FILE__}"
  end
end
</file>

<file path="spec/requests/health_spec.rb">
require 'rails_helper'

RSpec.describe "Healths", type: :request do
  describe "GET /index" do
    pending "add some examples (or delete) #{__FILE__}"
  end
end
</file>

<file path="spec/requests/like_review_spec.rb">
require 'rails_helper'

RSpec.describe "LikeReviews", type: :request do
  describe "GET /index" do
    pending "add some examples (or delete) #{__FILE__}"
  end
end
</file>

<file path="spec/requests/reply_review_spec.rb">
require 'rails_helper'

RSpec.describe "ReplyReviews", type: :request do
  describe "GET /index" do
    pending "add some examples (or delete) #{__FILE__}"
  end
end
</file>

<file path="storage/.keep">

</file>

<file path="test/channels/application_cable/connection_test.rb">
require "test_helper"

class ApplicationCable::ConnectionTest < ActionCable::Connection::TestCase
  # test "connects with cookies" do
  #   cookies.signed[:user_id] = 42
  #
  #   connect
  #
  #   assert_equal connection.user_id, "42"
  # end
end
</file>

<file path="test/controllers/.keep">

</file>

<file path="test/fixtures/files/.keep">

</file>

<file path="test/integration/.keep">

</file>

<file path="test/mailers/.keep">

</file>

<file path="test/models/.keep">

</file>

<file path="test/test_helper.rb">
ENV["RAILS_ENV"] ||= "test"
require_relative "../config/environment"
require "rails/test_help"

class ActiveSupport::TestCase
  # Run tests in parallel with specified workers
  parallelize(workers: :number_of_processors)

  # Setup all fixtures in test/fixtures/*.yml for all tests in alphabetical order.
  fixtures :all

  # Add more helper methods to be used by all tests here...
end
</file>

<file path=".example.env">
APP_NAME=REVIEW-COMPANY

RAILS_DB_HOST=localhost
RAILS_DB_PORT=5432
RAILS_DB_USER_NAME=postgres
RAILS_DB_PASSWORD=postgres
RAILS_DB_NAME=compayny-review

ATTACHED_API=1
ATTACHED_SIDEKIQ=1

REDIS_URL=redis://localhost:6379
</file>

<file path=".gitattributes">
# See https://git-scm.com/docs/gitattributes for more about git attribute files.

# Mark the database schema as having been generated.
db/schema.rb linguist-generated

# Mark any vendored files as having been vendored.
vendor/* linguist-vendored
</file>

<file path=".ruby-version">
3.1.2
</file>

<file path="config.ru">
# This file is used by Rack-based servers to start the application.

require_relative "config/environment"

run Rails.application
Rails.application.load_server
</file>

<file path="Dockerfile">
FROM ruby:3.1.2

ENV RAILS_ENV production
ENV INSTALL_PATH /var/www/html/review-company

# Run rails with puma
CMD rails s
EXPOSE 3000
WORKDIR $INSTALL_PATH


RUN apt-get update -qq && \
    apt-get install -y build-essential software-properties-common libpq-dev nodejs telnet vim && \
    curl -fsSL https://www.postgresql.org/media/keys/ACCC4CF8.asc | apt-key add - && \
    echo "deb [arch=amd64] http://apt.postgresql.org/pub/repos/apt/ $(lsb_release -cs)-pgdg main" >> /etc/apt/sources.list.d/pgdg.list && \
    apt-get update -qq && \
    apt-get install -y postgresql-client && \
    rm -rf /var/lib/apt/lists/*

COPY Gemfile .
COPY Gemfile.lock .
RUN gem install bundler:2.2.4
RUN bundle config set without 'development'
RUN bundle install --jobs=3 --retry=3 && mkdir -p log
COPY . .
</file>

<file path="Rakefile">
# Add your own tasks in files placed in lib/tasks ending in .rake,
# for example lib/tasks/capistrano.rake, and they will automatically be available to Rake.

require_relative "config/application"

Rails.application.load_tasks
</file>

<file path="README.md">
# README

This README would normally document whatever steps are necessary to get the
application up and running.

Things you may want to cover:

* Ruby version

* System dependencies

* Configuration

* Database creation

* Database initialization

* How to run the test suite

* Services (job queues, cache servers, search engines, etc.)

* Deployment instructions

* ...
</file>

<file path="app/clockworks/workers/find_and_destroy_company.rb">
class Workers::FindAndDestroyCompany
  include Sidekiq::Worker
  sidekiq_options queue: SidekiqQueue::FIND_AND_DESTROY_COMPANY, retry: false

  def perform company_id
    company = Company.find_by(id: company_id)
    return unless company
    Company.transaction do
      company.destroy
    end
    puts "deleted company #{company_id}"
  end

  def execute
    need_deletes = Company.where(is_deleted: true).ids
    need_deletes.each do |company_id|
      Workers::FindAndDestroyCompany.perform_async company_id
    end
  end

end
</file>

<file path="app/clockworks/workers/find_and_destroy_reviews.rb">
class Workers::FindAndDestroyReviews
  include Sidekiq::Worker
  sidekiq_options queue: SidekiqQueue::FIND_AND_DESTROY_REVIEWS, retry: false

  def perform review_id
    review = Review.find_by(id: review_id)
    return unless review
    Review.transaction do
      review.destroy!
    end
    puts "deleted review #{review_id}"
  end

  def execute
    need_deletes = Review.where(is_deleted: true).ids
    need_deletes.each_slice(50) do |review_ids|
      review_ids.each {|review_id| Workers::FindAndDestroyReviews.perform_async(review_id)}
    end
  end

end
</file>

<file path="app/clockworks/workers/handle_like_event.rb">
class Workers::HandleLikeEvent
  include Sidekiq::Worker
  sidekiq_options queue: SidekiqQueue::HANDLE_LIKE_EVENT, retry: false

  def initialize
    puts "init Workers::HandleLikeEvent"
  end

  def perform payload
    Apartment::Tenant.switch payload.delete("tenant") do
      action = payload.delete("action")
      like_id = payload.delete("like_id")
      Like.create(payload) if action == LikeEventAction::CREATE
      Like.find_by(id: like_id)&.update!(status: payload["status"]) if action == LikeEventAction::UPDATE
    end
    puts "event handle done!"
  end

end
</file>

<file path="app/clockworks/clock.rb">
require 'clockwork'
require './config/environment'

module Clockwork

  handler do |job, time|
    puts "Running #{job} at #{time}"
  end

  default_time                           = ENV.fetch('DEFAULT_CRONJOB_EXECUTE_TIME', '01:00')
  cronjob_time_to_destroy_company        = ENV.fetch('CRONJOB_TIME_TO_DESTROY_COMPANY', 1)
  cronjob_time_to_destroy_reivews        = ENV.fetch('CRONJOB_TIME_TO_DESTROY_REIVEWS', 60)
  cronjob_time_delete_user               = ENV.fetch('CRONJOB_TIME_TO_DELETEE_USER', 3)

  clock_mission = -> (mission, action, *args) { Workers::ClockMission.perform_async(mission, action, *args) }

  if ENV['ENABLE_DELETE_USER'].to_i.positive?
    log_msg = 'running delete user job'
    test_time = ENV.fetch('TEST_DELETE_USER_TIME', 1)

    unless test_time.to_i.zero?
      every cronjob_time_delete_user.to_i.minutes, log_msg do
        clock_mission.call(Workers::DeleteUser, "execute")
      end
    else
      every test_time.to_i.days, log_msg do
        clock_mission.call(Workers::DeleteUser, "execute")
      end
    end
  end

  if ENV['ENABLE_FIND_AND_DESTROY_COMPANY'].to_i.positive?
    log_msg = 'running find and destroy company job'
    test_time = ENV.fetch('TEST_FIND_AND_DESTROY_COMPANY_TIME', 1)

    unless test_time.to_i.zero?
      every cronjob_time_to_destroy_company.to_i.day, log_msg do
        clock_mission.call(Workers::FindAndDestroyCompany, "execute")
      end
    else
      every test_time.to_i.minutes, log_msg do
        clock_mission.call(Workers::FindAndDestroyCompany, "execute")
      end
    end
  end

  if ENV['ENABLE_FIND_AND_DESTROY_REVIEW'].to_i.positive?
    log_msg = 'running find and destroy reviews job'
    test_time = ENV.fetch('TEST_FIND_AND_DESTROY_REVIEWS_TIME', 1)

    unless test_time.to_i.zero?
      every cronjob_time_to_destroy_reivews.to_i.minutes, log_msg do
        clock_mission.call(Workers::FindAndDestroyReviews, "execute")
      end
    else
      every test_time.to_i.minutes, log_msg do
        clock_mission.call(Workers::FindAndDestroyReviews, "execute")
      end
    end
  end

end
</file>

<file path="app/controllers/api/v1/favorite_controller.rb">
class Api::V1::FavoriteController < ApplicationController
  before_action :authenticate_user!

  def create
    company_id = params[:company_id] || params.dig(:favorite, :company_id)
    company = Company.find(company_id)
    
    # Query favorite directly in current tenant schema (not through user association)
    favorite = Favorite.find_or_initialize_by(user_id: current_user.id, company_id: company.id)
    
    if favorite.persisted?
      render json: json_with_error(message: "C√¥ng ty ƒë√£ ƒë∆∞·ª£c y√™u th√≠ch")
    else
      favorite.save!
      render json: json_with_success(data: favorite, message: "ƒê√£ th√™m v√†o danh s√°ch y√™u th√≠ch")
    end
  rescue ActiveRecord::RecordNotFound
    render json: json_with_error(message: "Kh√¥ng t√¨m th·∫•y c√¥ng ty")
  rescue => e
    render json: json_with_error(message: e.message)
  end

  def destroy
    company_id = params[:id] || params[:company_id]
    company = Company.find(company_id)
    
    # Query favorite directly in current tenant schema
    favorite = Favorite.find_by(user_id: current_user.id, company_id: company.id)
    
    if favorite
      favorite.destroy
      render json: json_with_empty_success(message: "ƒê√£ x√≥a kh·ªèi danh s√°ch y√™u th√≠ch")
    else
      render json: json_with_error(message: "C√¥ng ty ch∆∞a ƒë∆∞·ª£c y√™u th√≠ch")
    end
  rescue ActiveRecord::RecordNotFound
    render json: json_with_error(message: "Kh√¥ng t√¨m th·∫•y c√¥ng ty")
  end

  def index
    # Query favorites directly in current tenant schema
    favorites = Favorite.where(user_id: current_user.id).includes(:company)
    companies = favorites.map(&:company).compact.select { |c| !c.is_deleted }
    render json: json_with_success(data: companies, default_serializer: CompanySerializer)
  end

  def check
    company = Company.find(params[:company_id])
    # Query favorite directly in current tenant schema
    is_favorited = Favorite.exists?(user_id: current_user.id, company_id: company.id)
    render json: json_with_success(data: { is_favorited: is_favorited })
  rescue ActiveRecord::RecordNotFound
    render json: json_with_error(message: "Kh√¥ng t√¨m th·∫•y c√¥ng ty")
  end
end
</file>

<file path="app/controllers/api/v1/registrations_controller.rb">
class Api::V1::RegistrationsController < Devise::RegistrationsController
  include ResponseHelper
  before_action :configure_permitted_parameters, if: :devise_controller?
  before_action :set_role_id, only: [:create]

  def create
    build_resource(sign_up_params)
    if resource.save
      sign_up(resource_name, resource)
      render json: json_with_success(data: resource, default_serializer: UserSerializer), status: :created
    else
      render json: json_with_error(errors: resource.errors)
    end
  end

  private

  def sign_up_params
    params.require(:user).permit(:email, :password, :password_confirmation, :first_name, :last_name, :phone_number, :role_id)
  end

  def set_role_id
    params[:user][:role_id] = Role.find_by(role: 'user', status: :active).id
  end

  def configure_permitted_parameters
    added_attrs = %i[email password password_confirmation first_name last_name phone_number role_id]
    devise_parameter_sanitizer.permit :sign_up, keys: added_attrs
    devise_parameter_sanitizer.permit :account_update, keys: added_attrs
  end

end
</file>

<file path="app/controllers/api/v1/user_controller.rb">
class Api::V1::UserController < ApplicationController
  around_action :with_transaction, except: %i[update_profile delete_user activity_stats recent_comments]
  before_action :get_user, only: [:update_profile, :delete_user, :index]
  before_action :authenticate_user!, only: [:activity_stats, :recent_comments]
  before_action :validate_permission, only: [:update_profile, :delete_user]

  def index
    render json: json_with_success(data: @user, default_serializer: UserSerializer)
  end

  def update_profile
    @user.update!(update_profile_params)
    render json: json_with_success(data: @user, default_serializer: UserSerializer)
  end

  def delete_user
    @user.update_attribute(:is_deleted, true)
    render json: json_with_empty_success
  end

  def activity_stats
    reviews_count = Review.where(user_id: current_user.id, is_deleted: false).count
    replies_count = Reply.where(user_id: current_user.id, is_deleted: false).count
    likes_count = Like.where(user_id: current_user.id).where.not(status: :default).count
    
    render json: json_with_success(data: {
      reviews_count: reviews_count,
      replies_count: replies_count,
      likes_count: likes_count
    })
  end

  def recent_comments
    limit = params[:limit]&.to_i || 10
    replies = Reply.where(user_id: current_user.id, is_deleted: false)
                   .order(created_at: :desc)
                   .limit(limit)
                   .includes(:review)
    
    render json: json_with_success(data: replies, default_serializer: ReplySerializer)
  end

  private

  def update_profile_params
    params.permit(:gender, :first_name, :last_name, :email)
  end

  def validate_permission
    return render json: json_with_error(message: "can't do action for this user") \
      unless @user.id == User.current_user.id
  end

  def get_user
    @user = User.find(params[:id])
  end

end
</file>

<file path="app/controllers/interactors/kafka/consumers/like_event.rb">
# frozen_string_literal: true
module Interactors::Kafka
  class Consumers::LikeEvent < Consumer
    def initialize group_id
      super group_id
      topics = Array(KafkaTopics::LIKE_EVENT)
      topics.each { |topic| subscribe_topic(nil, topic) }
    end

    def handle_event(event)
      like_payload = OpenStruct.new(JSON.parse(event.value))
      log(event.topic,
          event.offset,
          event.partition)
      return unless like_payload

      Workers::HandleLikeEvent.perform_async(like_payload.to_h)
    end
  end
end
</file>

<file path="app/helpers/response_helper.rb">
# frozen_string_literal: true

module ResponseHelper
  SUCCESS_STATUS  = :ok
  ERROR_STATUS    = :fail
  SUCCESS_MESSAGE = 'Success'

  def json_with_success(message: SUCCESS_MESSAGE, data: nil, default_serializer: false, options: {})
    response = {
      status: SUCCESS_STATUS,
      message: message
    }
    unless default_serializer
      response[:data] = data
      return response
    end
    instance_options = options[:serialize] ? options[:serialize] : {}
    serializer_options = { include: '**' }
    serializer_options[:scope] = options[:scope] if options[:scope]
    response[:data] = ActiveModelSerializers::SerializableResource.new(data, instance_options.merge(serializer_options)).as_json
    response
  end

  def json_with_empty_success(message: SUCCESS_MESSAGE)
    {
      status:  SUCCESS_STATUS,
      message: message,
      data:    nil
    }
  end

  def json_with_error(message: :fail, errors: nil, code: nil)
    {
      status: ERROR_STATUS,
      message: message,
      errors: errors,
      error_code: code
    }
  end

end
</file>

<file path="app/middleware/change_tenant.rb">
require 'apartment/elevators/generic'
class ChangeTenant < Apartment::Elevators::Generic

  def call(env)
    super
  rescue Apartment::TenantNotFound
    return [
      400,
      content_type_json,
      response_error(I18n.t("errors.invalid_tenant"))
    ]
  end

  # @return {String} - The tenant to switch to
  def parse_tenant_name(request)
    # request is an instance of Rack::Request
    request.env['HTTP_X_API_TENANT'] || request.env['X_API_TENANT'] || Tenant::DEFAULT_SCHEMA
  end

  def content_type_json
    {"Content-Type" => "application/json"}
  end

  def response_error message
    [{
       status: "fail",
       message: message,
       errors: [],
       error_code: nil
     }.to_json]
  end
end
</file>

<file path="app/models/favorite.rb">
class Favorite < ApplicationRecord
  # User is in public schema (excluded_models), so we can't use belongs_to with foreign key
  # We'll just store user_id as a reference
  belongs_to :company

  validates :user_id, presence: true
  validates :user_id, uniqueness: { scope: :company_id }
  
  # Custom method to get user from public schema
  def user
    Apartment::Tenant.switch('public') do
      User.find_by(id: user_id)
    end
  end
end
</file>

<file path="app/models/like.rb">
class Like < ApplicationRecord

  enum status: {
    default: 0,
    like: 1,
    dislike: 2
  }
  validates :status, :user_id, :review_id, presence: true
  validates :user_id, uniqueness: { scope: :review_id }, on: :create

  belongs_to :user
  belongs_to :review

  scope :get_like_review_by_user_id, -> (review_id, user_id) {
    where(user_id: user_id, review_id: review_id)
  }

  after_commit :update_total_like_dislike, on: %i[create update]

  private

  def update_total_like_dislike
    return unless saved_change_to_status?
    
    old_status = previous_changes[:status] ? previous_changes[:status][0] : nil
    new_status = status.to_sym
    
    review.with_lock do
      # Decrement old status
      case old_status&.to_sym
      when :like
        review.decrement!(:total_like, 1) if review.total_like > 0
      when :dislike
        review.decrement!(:total_dislike, 1) if review.total_dislike > 0
      end
      
      # Increment new status
      case new_status
      when :like
        review.increment!(:total_like, 1)
      when :dislike
        review.increment!(:total_dislike, 1)
      end
    end
  end
end
</file>

<file path="app/models/role.rb">
class Role < ApplicationRecord
  enum role: {
    user: 1,
    admin: 2,
    owner: 3,
    anonymous: 4,
  }

  enum status: {
    active: 1,
    inactive: 2,
    deleted: 3,
  }

  has_many :users
end
</file>

<file path="app/serializers/company_serializer.rb">
class CompanySerializer < BaseSerializer
  attributes :id, :name, :owner, :logo, :website, :phone,
             :main_office, :created_at, :updated_at,
             :total_reviews, :avg_score, :company_size, :company_type,
             :created_at_timestamp, :updated_at_timestamp, :is_active, :logo,
             :avg_score, :is_good_company, :is_deleted, :industry,
             :employee_count_min, :employee_count_max, :is_hiring, :employee_count_range

  def employee_count_range
    return nil unless object.employee_count_min || object.employee_count_max
    
    min = object.employee_count_min || 0
    max = object.employee_count_max || 0
    
    return nil if min == 0 && max == 0
    
    if min > 0 && max > 0 && min != max
      "#{min} - #{max} nh√¢n vi√™n"
    elsif max > 0
      if max < 25
        "D∆∞·ªõi 25 nh√¢n vi√™n"
      elsif max < 100
        "25 - 100 nh√¢n vi√™n"
      elsif max < 200
        "100 - 200 nh√¢n vi√™n"
      elsif max < 500
        "200 - 500 nh√¢n vi√™n"
      elsif max < 1000
        "500 - 1.000 nh√¢n vi√™n"
      elsif max < 5000
        "1.000 - 5.000 nh√¢n vi√™n"
      else
        "Tr√™n 5.000 nh√¢n vi√™n"
      end
    elsif min > 0
      if min < 25
        "D∆∞·ªõi 25 nh√¢n vi√™n"
      elsif min < 100
        "25 - 100 nh√¢n vi√™n"
      elsif min < 200
        "100 - 200 nh√¢n vi√™n"
      elsif min < 500
        "200 - 500 nh√¢n vi√™n"
      elsif min < 1000
        "500 - 1.000 nh√¢n vi√™n"
      elsif min < 5000
        "1.000 - 5.000 nh√¢n vi√™n"
      else
        "Tr√™n 5.000 nh√¢n vi√™n"
      end
    else
      nil
    end
  end
end
</file>

<file path="app/serializers/user_serializer.rb">
class UserSerializer < BaseSerializer
  attributes :id, :email, :created_at, :updated_at, :first_name, :last_name,
             :created_at_timestamp, :updated_at_timestamp
  belongs_to :role
end
</file>

<file path="config/initializers/devise.rb">
# frozen_string_literal: true

# Assuming you have not yet modified this file, each configuration option below
# is set to its default value. Note that some are commented out while others
# are not: uncommented lines are intended to protect your configuration from
# breaking changes in upgrades (i.e., in the event that future versions of
# Devise change the default values for those options).
#
# Use this hook to configure devise mailer, warden hooks and so forth.
# Many of these configuration options can be set straight in your model.
Devise.setup do |config|
  # The secret key used by Devise. Devise uses this key to generate
  # random tokens. Changing this key will render invalid all existing
  # confirmation, reset password and unlock tokens in the database.
  # Devise will use the `secret_key_base` as its `secret_key`
  # by default. You can change it below and use your own secret key.
  # config.secret_key = 'c2c84eee14c51dc97bd399d10c473072ddede3f8e5e3d038076365e83fc623a63ba9737bf42617328e0e3e140caae44d9f6db6334d65a9ab5203e613e9a59820'

  # ==> Controller configuration
  # Configure the parent class to the devise controllers.
  # config.parent_controller = 'DeviseController'

  # ==> Mailer Configuration
  # Configure the e-mail address which will be shown in Devise::Mailer,
  # note that it will be overwritten if you use your own mailer class
  # with default "from" parameter.
  config.mailer_sender = 'please-change-me-at-config-initializers-devise@example.com'

  # Configure the class responsible to send e-mails.
  # config.mailer = 'Devise::Mailer'

  # Configure the parent class responsible to send e-mails.
  # config.parent_mailer = 'ActionMailer::Base'

  # ==> ORM configuration
  # Load and configure the ORM. Supports :active_record (default) and
  # :mongoid (bson_ext recommended) by default. Other ORMs may be
  # available as additional gems.
  require 'devise/orm/active_record'

  # ==> Configuration for any authentication mechanism
  # Configure which keys are used when authenticating a user. The default is
  # just :email. You can configure it to use [:username, :subdomain], so for
  # authenticating a user, both parameters are required. Remember that those
  # parameters are used only when authenticating and not when retrieving from
  # session. If you need permissions, you should implement that in a before filter.
  # You can also supply a hash where the value is a boolean determining whether
  # or not authentication should be aborted when the value is not present.
  # config.authentication_keys = [:email]

  # Configure parameters from the request object used for authentication. Each entry
  # given should be a request method and it will automatically be passed to the
  # find_for_authentication method and considered in your model lookup. For instance,
  # if you set :request_keys to [:subdomain], :subdomain will be used on authentication.
  # The same considerations mentioned for authentication_keys also apply to request_keys.
  # config.request_keys = []

  # Configure which authentication keys should be case-insensitive.
  # These keys will be downcased upon creating or modifying a user and when used
  # to authenticate or find a user. Default is :email.
  config.case_insensitive_keys = [:email]

  # Configure which authentication keys should have whitespace stripped.
  # These keys will have whitespace before and after removed upon creating or
  # modifying a user and when used to authenticate or find a user. Default is :email.
  config.strip_whitespace_keys = [:email]

  # Tell if authentication through request.params is enabled. True by default.
  # It can be set to an array that will enable params authentication only for the
  # given strategies, for example, `config.params_authenticatable = [:database]` will
  # enable it only for database (email + password) authentication.
  # config.params_authenticatable = true

  # Tell if authentication through HTTP Auth is enabled. False by default.
  # It can be set to an array that will enable http authentication only for the
  # given strategies, for example, `config.http_authenticatable = [:database]` will
  # enable it only for database authentication.
  # For API-only applications to support authentication "out-of-the-box", you will likely want to
  # enable this with :database unless you are using a custom strategy.
  # The supported strategies are:
  # :database      = Support basic authentication with authentication key + password
  # config.http_authenticatable = false

  # If 401 status code should be returned for AJAX requests. True by default.
  # config.http_authenticatable_on_xhr = true

  # The realm used in Http Basic Authentication. 'Application' by default.
  # config.http_authentication_realm = 'Application'

  # It will change confirmation, password recovery and other workflows
  # to behave the same regardless if the e-mail provided was right or wrong.
  # Does not affect registerable.
  # config.paranoid = true

  # By default Devise will store the user in session. You can skip storage for
  # particular strategies by setting this option.
  # Notice that if you are skipping storage for all authentication paths, you
  # may want to disable generating routes to Devise's sessions controller by
  # passing skip: :sessions to `devise_for` in your config/routes.rb
  config.skip_session_storage = %i[http_auth params_auth]

  # By default, Devise cleans up the CSRF token on authentication to
  # avoid CSRF token fixation attacks. This means that, when using AJAX
  # requests for sign in and sign up, you need to get a new CSRF token
  # from the server. You can disable this option at your own risk.
  # config.clean_up_csrf_token_on_authentication = true

  # When false, Devise will not attempt to reload routes on eager load.
  # This can reduce the time taken to boot the app but if your application
  # requires the Devise mappings to be loaded during boot time the application
  # won't boot properly.
  # config.reload_routes = true

  # ==> Configuration for :database_authenticatable
  # For bcrypt, this is the cost for hashing the password and defaults to 12. If
  # using other algorithms, it sets how many times you want the password to be hashed.
  # The number of stretches used for generating the hashed password are stored
  # with the hashed password. This allows you to change the stretches without
  # invalidating existing passwords.
  #
  # Limiting the stretches to just one in testing will increase the performance of
  # your test suite dramatically. However, it is STRONGLY RECOMMENDED to not use
  # a value less than 10 in other environments. Note that, for bcrypt (the default
  # algorithm), the cost increases exponentially with the number of stretches (e.g.
  # a value of 20 is already extremely slow: approx. 60 seconds for 1 calculation).
  config.stretches = Rails.env.test? ? 1 : 12

  # Set up a pepper to generate the hashed password.
  # config.pepper = '3178c11f33893fbc7955a874f1d3dfe790f278f7f95ae4ec02f50f60266b3ff70111083b0261ac38b66d8838d1197f35b2e809871ce21006b9947153f86640ed'

  # Send a notification to the original email when the user's email is changed.
  # config.send_email_changed_notification = false

  # Send a notification email when the user's password is changed.
  # config.send_password_change_notification = false

  # ==> Configuration for :confirmable
  # A period that the user is allowed to access the website even without
  # confirming their account. For instance, if set to 2.days, the user will be
  # able to access the website for two days without confirming their account,
  # access will be blocked just in the third day.
  # You can also set it to nil, which will allow the user to access the website
  # without confirming their account.
  # Default is 0.days, meaning the user cannot access the website without
  # confirming their account.
  # config.allow_unconfirmed_access_for = 2.days

  # A period that the user is allowed to confirm their account before their
  # token becomes invalid. For example, if set to 3.days, the user can confirm
  # their account within 3 days after the mail was sent, but on the fourth day
  # their account can't be confirmed with the token any more.
  # Default is nil, meaning there is no restriction on how long a user can take
  # before confirming their account.
  # config.confirm_within = 3.days

  # If true, requires any email changes to be confirmed (exactly the same way as
  # initial account confirmation) to be applied. Requires additional unconfirmed_email
  # db field (see migrations). Until confirmed, new email is stored in
  # unconfirmed_email column, and copied to email column on successful confirmation.
  config.reconfirmable = true

  # Defines which key will be used when confirming an account
  # config.confirmation_keys = [:email]

  # ==> Configuration for :rememberable
  # The time the user will be remembered without asking for credentials again.
  # config.remember_for = 2.weeks

  # Invalidates all the remember me tokens when the user signs out.
  config.expire_all_remember_me_on_sign_out = true

  # If true, extends the user's remember period when remembered via cookie.
  # config.extend_remember_period = false

  # Options to be passed to the created cookie. For instance, you can set
  # secure: true in order to force SSL only cookies.
  # config.rememberable_options = {}

  # ==> Configuration for :validatable
  # Range for password length.

  # Email regex used to validate email formats. It simply asserts that
  # one (and only one) @ exists in the given string. This is mainly
  # to give user feedback and not to assert the e-mail validity.
  config.email_regexp = /\A[^@\s]+@[^@\s]+\z/

  # ==> Configuration for :timeoutable
  # The time you want to timeout the user session without activity. After this
  # time the user will be asked for credentials again. Default is 30 minutes.
  # config.timeout_in = 30.minutes

  # ==> Configuration for :lockable
  # Defines which strategy will be used to lock an account.
  # :failed_attempts = Locks an account after a number of failed attempts to sign in.
  # :none            = No lock strategy. You should handle locking by yourself.
  # config.lock_strategy = :failed_attempts

  # Defines which key will be used when locking and unlocking an account
  # config.unlock_keys = [:email]

  # Defines which strategy will be used to unlock an account.
  # :email = Sends an unlock link to the user email
  # :time  = Re-enables login after a certain amount of time (see :unlock_in below)
  # :both  = Enables both strategies
  # :none  = No unlock strategy. You should handle unlocking by yourself.
  # config.unlock_strategy = :both

  # Number of authentication tries before locking an account if lock_strategy
  # is failed attempts.
  # config.maximum_attempts = 20

  # Time interval to unlock the account if :time is enabled as unlock_strategy.
  # config.unlock_in = 1.hour

  # Warn on the last attempt before the account is locked.
  # config.last_attempt_warning = true

  # ==> Configuration for :recoverable
  #
  # Defines which key will be used when recovering the password for an account
  # config.reset_password_keys = [:email]

  # Time interval you can reset your password with a reset password key.
  # Don't put a too small interval or your users won't have the time to
  # change their passwords.
  config.reset_password_within = 6.hours

  # When set to false, does not sign a user in automatically after their password is
  # reset. Defaults to true, so a user is signed in automatically after a reset.
  # config.sign_in_after_reset_password = true

  # ==> Configuration for :encryptable
  # Allow you to use another hashing or encryption algorithm besides bcrypt (default).
  # You can use :sha1, :sha512 or algorithms from others authentication tools as
  # :clearance_sha1, :authlogic_sha512 (then you should set stretches above to 20
  # for default behavior) and :restful_authentication_sha1 (then you should set
  # stretches to 10, and copy REST_AUTH_SITE_KEY to pepper).
  #
  # Require the `devise-encryptable` gem when using anything other than bcrypt
  # config.encryptor = :sha512

  # ==> Scopes configuration
  # Turn scoped views on. Before rendering "sessions/new", it will first check for
  # "users/sessions/new". It's turned off by default because it's slower if you
  # are using only default views.
  # config.scoped_views = false

  # Configure the default scope given to Warden. By default it's the first
  # devise role declared in your routes (usually :user).
  # config.default_scope = :user

  # Set this configuration to false if you want /users/sign_out to sign out
  # only the current scope. By default, Devise signs out all scopes.
  # config.sign_out_all_scopes = true

  # ==> Navigation configuration
  # Lists the formats that should be treated as navigational. Formats like
  # :html should redirect to the sign in page when the user does not have
  # access, but formats like :xml or :json, should return 401.
  #
  # If you have any extra navigational formats, like :iphone or :mobile, you
  # should add them to the navigational formats lists.
  #
  # The "*/*" below is required to match Internet Explorer requests.
  config.navigational_formats = ['*/*', :json]

  # The default HTTP method used to sign out a resource. Default is :delete.
  config.sign_out_via = :delete

  # ==> OmniAuth
  # Add a new OmniAuth provider. Check the wiki for more information on setting
  # up on your models and hooks.
  # config.omniauth :github, 'APP_ID', 'APP_SECRET', scope: 'user,public_repo'

  # ==> Warden configuration
  # If you want to use other strategies, that are not supported by Devise, or
  # change the failure app, you can configure them inside the config.warden block.
  #
  # config.warden do |manager|
  #   manager.intercept_401 = false
  #   manager.default_strategies(scope: :user).unshift :some_external_strategy
  # end

  # ==> Mountable engine configurations
  # When using Devise inside an engine, let's call it `MyEngine`, and this engine
  # is mountable, there are some extra configurations to be taken into account.
  # The following options are available, assuming the engine is mounted as:
  #
  #     mount MyEngine, at: '/my_engine'
  #
  # The router that invoked `devise_for`, in the example above, would be:
  # config.router_name = :my_engine
  #
  # When using OmniAuth, Devise cannot automatically set OmniAuth path,
  # so you need to do it manually. For the users scope, it would be:
  # config.omniauth_path_prefix = '/my_engine/users/auth'

  # ==> Hotwire/Turbo configuration
  # When using Devise with Hotwire/Turbo, the http status for error responses
  # and some redirects must match the following. The default in Devise for existing
  # apps is `200 OK` and `302 Found` respectively, but new apps are generated with
  # these new defaults that match Hotwire/Turbo behavior.
  # Note: These might become the new default in future versions of Devise.
  config.warden do |warden|
    warden.scope_defaults :user, store: false
  end

  config.responder.error_status = :unprocessable_entity
  config.responder.redirect_status = :see_other
  config.password_length = 8..30
  config.jwt do |jwt|
    jwt.secret = ENV['DEVISE_JWT_SECRET_KEY']
    jwt.dispatch_requests = [
      ['POST', %r{^/api/v1/auth/sign_in$}]
    ]
    jwt.revocation_requests = [
      ['DELETE', %r{^/api/v1/auth/logout$}]
    ]
    jwt.expiration_time = 1.day.to_i
  end
  # ==> Configuration for :registerable

  # When set to false, does not sign a user in automatically after their password is
  # changed. Defaults to true, so a user is signed in automatically after changing a password.
  # config.sign_in_after_change_password = true
end
</file>

<file path="config/initializers/redis.rb">
require 'redis'
class RedisInitializer
  class << self
    def get_redis(url)
      Redis.new(url: url, timeout: 10)
    end
  end
end
REDIS_URL = ENV['REDIS_URL'] || 'redis://localhost:6379'
# Redis.current is deprecated, use Redis.new directly when needed
# For backward compatibility, we'll create a connection but not assign to Redis.current
REDIS_CONNECTION = RedisInitializer.get_redis(REDIS_URL)
</file>

<file path="config/initializers/sidekiq.rb">
# frozen_string_literal: true

sidekiq_config = { url: REDIS_URL }

Sidekiq.configure_server do |config|
  config.redis = sidekiq_config
end

Sidekiq.configure_client do |config|
  config.redis = sidekiq_config
end

# Sidekiq::Extensions.enable_delay! is deprecated and will be removed in Sidekiq 7.0
# Use Sidekiq::Worker.perform_async instead of .delay methods
# Sidekiq::Extensions.enable_delay!
</file>

<file path="db/migrate/20231224034549_create_reviews.rb">
class CreateReviews < ActiveRecord::Migration[7.0]
  def change
    create_table :reviews, id: :uuid do |t|
      t.uuid :user_id, foreign_key: true
      t.uuid :company_id, foreign_key: true
      t.integer :score, default: 1, null: false
      t.string :title, limit: 100
      t.text   :reviews_content
      t.boolean :vote_for_quit, default: false, null: false
      t.boolean :vote_for_work, default: true, null: false
      t.boolean :is_anonymous, defualt: false, null: false

      t.timestamps
    end
  end
end
</file>

<file path="db/migrate/20231224091737_addisdeleted_to_comapny.rb">
class AddisdeletedToComapny < ActiveRecord::Migration[7.0]
  def change
    add_column :companies, :is_deleted, :boolean, default: false
    add_column :reviews, :is_deleted, :boolean, default: false
  end
end
</file>

<file path="db/migrate/20240215000000_create_favorites.rb">
class CreateFavorites < ActiveRecord::Migration[7.0]
  def change
    unless table_exists?(:favorites)
      create_table :favorites, id: :uuid do |t|
        t.uuid :user_id, null: false
        t.uuid :company_id, null: false

        t.timestamps
      end
      
      # Only add foreign key for company (company is in tenant schema)
      # User is in public schema (excluded_models), so we can't add foreign key constraint
      add_foreign_key :favorites, :companies, column: :company_id
      
      # Add indexes (only if they don't exist)
      add_index :favorites, :user_id, name: 'index_favorites_on_user_id' unless index_exists?(:favorites, :user_id)
      add_index :favorites, :company_id, name: 'index_favorites_on_company_id' unless index_exists?(:favorites, :company_id)
      add_index :favorites, [:user_id, :company_id], unique: true, name: 'index_favorites_on_user_id_and_company_id' unless index_exists?(:favorites, [:user_id, :company_id])
    end
  end
end
</file>

<file path="db/seeds/common/1_company_seed.rb">
list_company = []
10.times do
  list_company.push(
    {
      name: Faker::Company.name,
      owner: Faker::Name.name,
      main_office: Faker::Address.city,
      phone: Faker::PhoneNumber.phone_number,
      avg_score: 1,
      website: Faker::Internet.url,
      company_type: "unknown",
      company_size: Faker::Number.between(from: 1, to: 1000),
    }
  )
end
Area.where(status: :active).each do |tenant|
  tenant.change_tenant do
    list_company.each do |com|
      unless Company.exists?(name: com[:name], company_type: com[:company_type])
        Company.create(com)
        puts "config: #{com[:name]} created"
      end
    end
    puts 'Company created'
  end
end
</file>

<file path="db/seeds/common/2_reviews_seed.rb">
list_review = []
10.times do
  list_review.push(
    {
      score: Faker::Number.between(from: 1, to: 10),
      title: Faker::Lorem.sentence,
      reviews_content: Faker::Lorem.paragraph,
      vote_for_quit: [true, false].sample,
      is_anonymous: [true, false].sample,
    }
  )
end
Area.where(status: :active).each do |tenant|
  tenant.change_tenant do
    puts "current_tenant is #{tenant.name}"
    list_review.each do |review|
      company = Company.order("RANDOM()").limit(1).first
      if company
        review[:company_id] = company.id
        Review.create(review)
        puts "review: #{review[:title]} created"
      else
        puts "Warning: No companies found for tenant #{tenant.name}, skipping review creation"
      end
    end
    puts 'reviews created'
  end
end
</file>

<file path="db/seeds/common/3_seed_role.rb">
[
  {
    role: "user",
    allow_all_action: false,
    allow_create: true,
    allow_update: false,
    allow_read: true,
    status: 1
  },
  {
    role: "admin",
    allow_all_action: false,
    allow_create: true,
    allow_update: true,
    allow_read: true,
    status: 1
  },
  {
    role: "owner",
    allow_all_action: true,
    allow_create: true,
    allow_update: true,
    allow_read: true,
    status: 1
  },
  {
    role: "anonymous",
    allow_all_action: false,
    allow_create: false,
    allow_update: false,
    allow_read: false,
    status: 1
  },
].each do |role|
  Role.create!(role) unless Role.exists?(role: role[:role])
end
</file>

<file path="db/seeds.rb">
# Load common seeds
Dir[File.join(Rails.root, 'db', "seeds/common", '*.rb')].sort.each do |seed|
  load seed
end
</file>

<file path="FE/src/components/CreateReplyForm.css">
.create-reply-form {
  margin-top: 16px;
  padding: 20px;
  background: var(--glassdoor-gray-bg);
  border-radius: 8px;
  border: 1px solid var(--glassdoor-border);
}

.create-reply-form textarea {
  width: 100%;
  padding: 12px;
  border: 1px solid var(--glassdoor-border);
  border-radius: 8px;
  font-size: 14px;
  font-family: inherit;
  resize: vertical;
  margin-bottom: 12px;
  background-color: var(--glassdoor-white);
  color: var(--glassdoor-gray);
  transition: all 0.2s ease;
}

.create-reply-form textarea:focus {
  outline: none;
  border-color: var(--glassdoor-green);
  box-shadow: 0 0 0 3px var(--glassdoor-green-light);
}

/* Responsive - Mobile */
@media (max-width: 768px) {
  .create-reply-form {
    padding: 12px;
  }

  .form-actions {
    flex-direction: column;
  }

  .form-actions button {
    width: 100%;
  }
}
</file>

<file path="FE/src/components/Footer.css">
.footer {
  background: var(--glassdoor-gray);
  color: var(--glassdoor-white);
  flex-shrink: 0;
  flex-grow: 0;
  border-top: 1px solid var(--glassdoor-border);
  position: relative;
  z-index: 1;
}

.footer-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0;
}

.footer-content {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 40px;
  padding: 48px 24px;
}

.footer-section {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.footer-logo {
  font-size: 24px;
  font-weight: 700;
  color: var(--glassdoor-green);
  margin: 0 0 12px 0;
}

.footer-description {
  font-size: 14px;
  line-height: 1.6;
  color: rgba(255, 255, 255, 0.8);
  margin: 0;
}

.footer-contact {
  display: flex;
  flex-direction: column;
  gap: 12px;
  margin-top: 8px;
}

.footer-contact p {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 14px;
  color: rgba(255, 255, 255, 0.9);
  margin: 0;
}

.footer-contact .icon {
  font-size: 16px;
  opacity: 0.8;
}

.footer-contact a {
  color: var(--glassdoor-green-light);
  text-decoration: none;
  transition: color 0.2s;
}

.footer-contact a:hover {
  color: var(--glassdoor-green);
  text-decoration: underline;
}

.footer-title {
  font-size: 18px;
  font-weight: 600;
  color: var(--glassdoor-white);
  margin: 0 0 16px 0;
}

.footer-links {
  list-style: none;
  padding: 0;
  margin: 0;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

.footer-links li {
  margin: 0;
}

.footer-links a {
  color: rgba(255, 255, 255, 0.8);
  text-decoration: none;
  font-size: 14px;
  transition: all 0.2s ease;
  display: inline-block;
}

.footer-links a:hover {
  color: var(--glassdoor-green);
  padding-left: 4px;
}

.social-links {
  display: flex;
  gap: 12px;
  margin-bottom: 24px;
}

.social-link {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
  background: rgba(255, 255, 255, 0.1);
  color: var(--glassdoor-white);
  text-decoration: none;
  transition: all 0.3s ease;
}

.social-link:hover {
  background: var(--glassdoor-green);
  transform: translateY(-2px);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

.social-link svg {
  width: 20px;
  height: 20px;
}

.footer-newsletter {
  margin-top: 8px;
}

.newsletter-title {
  font-size: 14px;
  font-weight: 600;
  color: var(--glassdoor-white);
  margin: 0 0 12px 0;
}

.newsletter-form {
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

.newsletter-input {
  flex: 1;
  min-width: 200px;
  padding: 10px 14px;
  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 6px;
  background: rgba(255, 255, 255, 0.1);
  color: var(--glassdoor-white);
  font-size: 14px;
  transition: all 0.2s ease;
}

.newsletter-input::placeholder {
  color: rgba(255, 255, 255, 0.5);
}

.newsletter-input:focus {
  outline: none;
  border-color: var(--glassdoor-green);
  background: rgba(255, 255, 255, 0.15);
}

.newsletter-btn {
  padding: 10px 20px;
  background: var(--glassdoor-green);
  color: white;
  border: none;
  border-radius: 6px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
  white-space: nowrap;
}

.newsletter-btn:hover {
  background: var(--glassdoor-green-dark);
  transform: translateY(-1px);
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

.footer-bottom {
  border-top: 1px solid rgba(255, 255, 255, 0.1);
  padding: 24px;
  background: rgba(0, 0, 0, 0.2);
}

.footer-bottom-content {
  max-width: 1200px;
  margin: 0 auto;
  display: flex;
  justify-content: space-between;
  align-items: center;
  flex-wrap: wrap;
  gap: 16px;
}

.copyright {
  font-size: 14px;
  color: rgba(255, 255, 255, 0.7);
  margin: 0;
}

.footer-bottom-links {
  display: flex;
  align-items: center;
  gap: 12px;
  flex-wrap: wrap;
}

.footer-bottom-links a {
  color: rgba(255, 255, 255, 0.7);
  text-decoration: none;
  font-size: 14px;
  transition: color 0.2s;
}

.footer-bottom-links a:hover {
  color: var(--glassdoor-green);
}

.separator {
  color: rgba(255, 255, 255, 0.3);
  font-size: 14px;
}

/* Responsive - Mobile */
@media (max-width: 768px) {
  .footer-content {
    grid-template-columns: 1fr;
    gap: 32px;
    padding: 32px 16px;
  }

  .footer-section {
    gap: 12px;
  }

  .footer-logo {
    font-size: 20px;
  }

  .footer-title {
    font-size: 16px;
  }

  .social-links {
    justify-content: center;
  }

  .newsletter-form {
    flex-direction: column;
  }

  .newsletter-input {
    width: 100%;
    min-width: auto;
  }

  .newsletter-btn {
    width: 100%;
  }

  .footer-bottom {
    padding: 20px 16px;
  }

  .footer-bottom-content {
    flex-direction: column;
    text-align: center;
    gap: 12px;
  }

  .footer-bottom-links {
    justify-content: center;
  }
}
</file>

<file path="FE/src/components/Footer.jsx">
import { memo } from 'react';
import { Link } from 'react-router-dom';
import './Footer.css';

const Footer = memo(() => {
  return (
    <footer className="footer">
      <div className="footer-container">
        <div className="footer-content">
          {/* Company Info Section */}
          <div className="footer-section">
            <h3 className="footer-logo">üè¢ ReviewCompany</h3>
            <p className="footer-description">
              N·ªÅn t·∫£ng ƒë√°nh gi√° c√¥ng ty uy t√≠n, gi√∫p b·∫°n t√¨m hi·ªÉu v·ªÅ m√¥i tr∆∞·ªùng l√†m vi·ªác tr∆∞·ªõc khi ·ª©ng tuy·ªÉn.
            </p>
            <div className="footer-contact">
              <p>
                <span className="icon">üìç</span>
                <span>123 ƒê∆∞·ªùng ABC, Qu·∫≠n XYZ, TP. H·ªì Ch√≠ Minh, Vi·ªát Nam</span>
              </p>
              <p>
                <span className="icon">üìß</span>
                <a href="mailto:contact@reviewcompany.com">contact@reviewcompany.com</a>
              </p>
              <p>
                <span className="icon">üìû</span>
                <a href="tel:+84123456789">+84 123 456 789</a>
              </p>
            </div>
          </div>

          {/* Quick Links Section */}
          <div className="footer-section">
            <h4 className="footer-title">Li√™n k·∫øt nhanh</h4>
            <ul className="footer-links">
              <li>
                <Link to="/">Trang ch·ªß</Link>
              </li>
              <li>
                <Link to="/about">V·ªÅ ch√∫ng t√¥i</Link>
              </li>
              <li>
                <Link to="/companies">T·∫•t c·∫£ c√¥ng ty</Link>
              </li>
              <li>
                <Link to="/companies">Danh s√°ch ƒë·∫ßy ƒë·ªß</Link>
              </li>
              <li>
                <Link to="/faq">C√¢u h·ªèi th∆∞·ªùng g·∫∑p</Link>
              </li>
            </ul>
          </div>

          {/* Legal Section */}
          <div className="footer-section">
            <h4 className="footer-title">Ph√°p l√Ω</h4>
            <ul className="footer-links">
              <li>
                <Link to="/terms">ƒêi·ªÅu kho·∫£n s·ª≠ d·ª•ng</Link>
              </li>
              <li>
                <Link to="/privacy">Ch√≠nh s√°ch b·∫£o m·∫≠t</Link>
              </li>
              <li>
                <Link to="/guidelines">H∆∞·ªõng d·∫´n ƒë√°nh gi√°</Link>
              </li>
              <li>
                <Link to="/contact">Li√™n h·ªá</Link>
              </li>
            </ul>
          </div>

          {/* Social Media Section */}
          <div className="footer-section">
            <h4 className="footer-title">K·∫øt n·ªëi v·ªõi ch√∫ng t√¥i</h4>
            <div className="social-links">
              <a 
                href="https://facebook.com" 
                target="_blank" 
                rel="noopener noreferrer"
                className="social-link facebook"
                aria-label="Facebook"
              >
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                </svg>
              </a>
              <a 
                href="https://twitter.com" 
                target="_blank" 
                rel="noopener noreferrer"
                className="social-link twitter"
                aria-label="Twitter"
              >
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/>
                </svg>
              </a>
              <a 
                href="https://linkedin.com" 
                target="_blank" 
                rel="noopener noreferrer"
                className="social-link linkedin"
                aria-label="LinkedIn"
              >
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                </svg>
              </a>
              <a 
                href="https://youtube.com" 
                target="_blank" 
                rel="noopener noreferrer"
                className="social-link youtube"
                aria-label="YouTube"
              >
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
                </svg>
              </a>
            </div>
            <div className="footer-newsletter">
              <p className="newsletter-title">ƒêƒÉng k√Ω nh·∫≠n tin</p>
              <form className="newsletter-form">
                <input 
                  type="email" 
                  placeholder="Email c·ªßa b·∫°n" 
                  className="newsletter-input"
                />
                <button type="submit" className="newsletter-btn">ƒêƒÉng k√Ω</button>
              </form>
            </div>
          </div>
        </div>

        {/* Bottom Bar */}
        <div className="footer-bottom">
          <div className="footer-bottom-content">
            <p className="copyright">
              ¬© {new Date().getFullYear()} ReviewCompany. T·∫•t c·∫£ quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u.
            </p>
            <div className="footer-bottom-links">
              <Link to="/terms">ƒêi·ªÅu kho·∫£n</Link>
              <span className="separator">|</span>
              <Link to="/privacy">B·∫£o m·∫≠t</Link>
              <span className="separator">|</span>
              <Link to="/sitemap">Sitemap</Link>
            </div>
          </div>
        </div>
      </div>
    </footer>
  );
});

Footer.displayName = 'Footer';

export default Footer;
</file>

<file path="FE/src/components/Navbar.jsx">
import { useState } from 'react';
import { Link, useNavigate } from 'react-router-dom';
import { useAuth } from '../contexts/AuthContext';
import './Navbar.css';

const Navbar = () => {
  const { isAuthenticated, user, logout } = useAuth();
  const navigate = useNavigate();
  const [showMenu, setShowMenu] = useState(false);
  const [showUserMenu, setShowUserMenu] = useState(false);

  const handleLogout = () => {
    logout();
    navigate('/login');
    setShowUserMenu(false);
  };

  return (
    <nav className="navbar">
      <div className="navbar-container">
        <Link to="/" className="navbar-brand">
          Review Company
        </Link>
        
        {/* Desktop Menu */}
        <div className="navbar-menu desktop-menu">
          <Link to="/companies" className="navbar-link">
            T·∫•t c·∫£ c√¥ng ty
          </Link>
          <Link to="/about" className="navbar-link">
            V·ªÅ ch√∫ng t√¥i
          </Link>
          <Link to="/faq" className="navbar-link">
            FAQ
          </Link>
          {isAuthenticated ? (
            <div className="user-menu-wrapper">
              <button
                className="user-menu-trigger"
                onClick={() => setShowUserMenu(!showUserMenu)}
              >
                <span className="user-avatar">
                  {user?.first_name?.[0]?.toUpperCase() || 'U'}
                </span>
                <span className="user-name">
                  {user?.first_name} {user?.last_name}
                </span>
                <span className="dropdown-icon">‚ñº</span>
              </button>
              {showUserMenu && (
                <div className="user-menu-dropdown">
                  <Link
                    to="/profile"
                    className="user-menu-item"
                    onClick={() => setShowUserMenu(false)}
                  >
                    üë§ H·ªì s∆° c·ªßa t√¥i
                  </Link>
                  <button
                    className="user-menu-item"
                    onClick={handleLogout}
                  >
                    üö™ ƒêƒÉng xu·∫•t
                  </button>
                </div>
              )}
            </div>
          ) : (
            <>
              <Link to="/login" className="navbar-link">
                ƒêƒÉng nh·∫≠p
              </Link>
              <Link to="/register" className="navbar-link btn-primary">
                ƒêƒÉng k√Ω
              </Link>
            </>
          )}
        </div>

        {/* Mobile Menu Button */}
        <button
          className="mobile-menu-btn"
          onClick={() => setShowMenu(!showMenu)}
          aria-label="Toggle menu"
        >
          {showMenu ? '‚úï' : '‚ò∞'}
        </button>
      </div>

      {/* Mobile Menu */}
      {showMenu && (
        <div className="mobile-menu">
          <Link
            to="/companies"
            className="mobile-menu-item"
            onClick={() => setShowMenu(false)}
          >
            T·∫•t c·∫£ c√¥ng ty
          </Link>
          <Link
            to="/about"
            className="mobile-menu-item"
            onClick={() => setShowMenu(false)}
          >
            V·ªÅ ch√∫ng t√¥i
          </Link>
          <Link
            to="/faq"
            className="mobile-menu-item"
            onClick={() => setShowMenu(false)}
          >
            FAQ
          </Link>
          {isAuthenticated ? (
            <>
              <Link
                to="/profile"
                className="mobile-menu-item"
                onClick={() => setShowMenu(false)}
              >
                H·ªì s∆° c·ªßa t√¥i
              </Link>
              <button
                className="mobile-menu-item"
                onClick={handleLogout}
              >
                ƒêƒÉng xu·∫•t
              </button>
            </>
          ) : (
            <>
              <Link
                to="/login"
                className="mobile-menu-item"
                onClick={() => setShowMenu(false)}
              >
                ƒêƒÉng nh·∫≠p
              </Link>
              <Link
                to="/register"
                className="mobile-menu-item btn-primary"
                onClick={() => setShowMenu(false)}
              >
                ƒêƒÉng k√Ω
              </Link>
            </>
          )}
        </div>
      )}
    </nav>
  );
};

export default Navbar;
</file>

<file path="FE/src/components/ReplyItem.css">
.reply-item {
  background: var(--glassdoor-white);
  padding: 16px;
  border-radius: 8px;
  margin-bottom: 12px;
  border: 1px solid var(--glassdoor-border);
  transition: all 0.2s ease;
}

.reply-item:hover {
  box-shadow: 0 2px 8px var(--glassdoor-shadow);
}

.reply-content {
  margin-bottom: 12px;
}

.reply-content p {
  margin: 0;
  color: var(--glassdoor-gray);
  line-height: 1.6;
  font-size: 14px;
}

.edited-badge {
  font-size: 12px;
  color: var(--glassdoor-gray-light);
  font-style: italic;
  margin-left: 10px;
}

.reply-meta {
  display: flex;
  gap: 16px;
  font-size: 12px;
  color: var(--glassdoor-gray-light);
  font-weight: 500;
}

/* Responsive - Mobile */
@media (max-width: 768px) {
  .reply-item {
    padding: 12px;
  }

  .reply-content p {
    font-size: 14px;
  }

  .reply-meta {
    font-size: 11px;
    flex-wrap: wrap;
  }
}
</file>

<file path="FE/src/components/ReplyList.css">
.reply-list-container {
  margin-top: 16px;
}

.reply-list {
  padding-left: 24px;
  border-left: 3px solid var(--glassdoor-green-light);
}

.loading-replies {
  padding: 16px;
  color: var(--glassdoor-gray-light);
  font-size: 14px;
  font-weight: 500;
}

.empty-replies {
  padding: 16px;
  color: var(--glassdoor-gray-light);
  font-size: 14px;
  font-style: italic;
  text-align: center;
}

/* Responsive - Mobile */
@media (max-width: 768px) {
  .reply-list {
    padding-left: 10px;
  }

  .reply-list-container {
    margin-top: 10px;
  }
}
</file>

<file path="FE/src/components/ReplyList.jsx">
import { useState, useEffect } from 'react';
import { replyService } from '../services/replyService';
import ReplyItem from './ReplyItem';
import './ReplyList.css';

const ReplyList = ({ reviewId, refreshKey, onMounted }) => {
  const [replies, setReplies] = useState([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    loadReplies();
  }, [reviewId, refreshKey]);

  useEffect(() => {
    if (onMounted) {
      onMounted(loadReplies);
    }
  }, [onMounted]);

  const loadReplies = async () => {
    try {
      setLoading(true);
      const response = await replyService.getReplies(reviewId);
      
      if (response && (response.status === 'ok' || response.status === 'success')) {
        const repliesData = response.data || [];
        setReplies(repliesData);
      } else {
        setReplies([]);
      }
    } catch (error) {
      setReplies([]);
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="reply-list-container">
      {loading ? (
        <div className="loading-replies">ƒêang t·∫£i...</div>
      ) : !replies || replies.length === 0 ? (
        <div className="empty-replies">Ch∆∞a c√≥ tr·∫£ l·ªùi n√†o</div>
      ) : (
        <div className="reply-list">
          {replies.map((reply) => (
            <ReplyItem key={reply.id} reply={reply} onUpdate={loadReplies} />
          ))}
        </div>
      )}
    </div>
  );
};

export default ReplyList;
</file>

<file path="FE/src/config/api.js">
const getApiBaseUrl = () => {
  if (import.meta.env.VITE_API_BASE_URL) {
    return import.meta.env.VITE_API_BASE_URL;
  }
  
  const isNgrok = window.location.hostname.includes('ngrok-free.app') || 
                   window.location.hostname.includes('ngrok.io');
  
  if (isNgrok) {
    const backendNgrokUrl = import.meta.env.VITE_API_NGROK_URL;
    if (backendNgrokUrl) {
      return backendNgrokUrl;
    }
    const localIP = import.meta.env.VITE_API_LOCAL_IP;
    if (localIP) {
      return `http://${localIP}:3000/api/v1`;
    }
    return 'http://localhost:3000/api/v1';
  }
  
  return 'http://localhost:3000/api/v1';
};

export const API_BASE_URL = getApiBaseUrl();
export const API_VERSION = 'v1';

export const getHeaders = (token = null, tenant = null) => {
  const headers = {
    'Content-Type': 'application/json',
    'X-API-VERSION': API_VERSION,
  };

  if (token) {
    headers['Authorization'] = `Bearer ${token}`;
  }

  if (tenant) {
    headers['X-API-TENANT'] = tenant;
  }

  return headers;
};

export const DEFAULT_TENANT = 'asia';
</file>

<file path="FE/src/contexts/AuthContext.jsx">
import { createContext, useContext, useState, useEffect } from 'react';
import { authService } from '../services/authService';

const AuthContext = createContext(null);

export const useAuth = () => {
  const context = useContext(AuthContext);
  if (!context) {
    throw new Error('useAuth must be used within AuthProvider');
  }
  return context;
};

export const AuthProvider = ({ children }) => {
  const [user, setUser] = useState(null);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const currentUser = authService.getCurrentUser();
    if (currentUser && authService.isAuthenticated()) {
      setUser(currentUser);
    }
    setLoading(false);
  }, []);

  const login = async (email, password) => {
    try {
      const response = await authService.signIn(email, password);
      
      if ((response.status === 'ok' || response.status === 'success') && response.data) {
        const userData = response.data;
        localStorage.setItem('access_token', userData.access_token);
        localStorage.setItem('user', JSON.stringify(userData));
        setUser(userData);
        return { success: true };
      }
      return { success: false, error: response.message || 'Login failed' };
    } catch (error) {
      let errorMessage = 'Login failed';
      
      if (error.error === 'Network Error' || error.message?.includes('Network Error')) {
        errorMessage = error.message || 'Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn server. Vui l√≤ng ki·ªÉm tra l·∫°i URL API ho·∫∑c k·∫øt n·ªëi m·∫°ng.';
      } else if (error.message) {
        errorMessage = error.message;
      } else if (error.error) {
        errorMessage = error.error;
      } else if (typeof error === 'string') {
        errorMessage = error;
      }
      
      return { success: false, error: errorMessage };
    }
  };

  const register = async (userData) => {
    try {
      const response = await authService.signUp(userData);
      if (response.status === 'ok' || response.status === 'success') {
        return await login(userData.email, userData.password);
      }
      return { success: false, error: response.message || 'Registration failed' };
    } catch (error) {
      let errorMessage = 'Registration failed';
      
      if (error.error === 'Network Error' || error.message?.includes('Network Error')) {
        errorMessage = error.message || 'Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn server. Vui l√≤ng ki·ªÉm tra l·∫°i URL API ho·∫∑c k·∫øt n·ªëi m·∫°ng.';
      } else if (error.message) {
        errorMessage = error.message;
      } else if (error.error) {
        errorMessage = error.error;
      }
      
      return { success: false, error: errorMessage };
    }
  };

  const logout = () => {
    authService.signOut();
    setUser(null);
  };

  const value = {
    user,
    loading,
    login,
    register,
    logout,
    isAuthenticated: !!user,
  };

  return <AuthContext.Provider value={value}>{children}</AuthContext.Provider>;
};
</file>

<file path="FE/src/hooks/index.js">
// Export all hooks for easy importing
export { useCompanies, useTopRatedCompanies, useRemainingCompanies } from './useCompanies';
export { useCompany } from './useCompany';
export { useReviews } from './useReviews';
export { useFavorites, useFavoriteStatus } from './useFavorites';
export { useFavoriteMutations } from './useFavoriteMutations';
export { useCompanyMutations } from './useCompanyMutations';
export { useReviewMutations } from './useReviewMutations';
export { useReviewMutationsExtended } from './useReviewMutationsExtended';
export { useUserActivityStats, useUserRecentComments } from './useUserActivity';
export { useReplyMutations } from './useReplyMutations';
export { useRecentReviews } from './useRecentReviews';
</file>

<file path="FE/src/hooks/useReviewMutations.js">
import { useMutation, useQueryClient } from '@tanstack/react-query';
import { reviewService } from '../services/reviewService';
import { useAuth } from '../contexts/AuthContext';

export const useReviewMutations = (reviewId, companyId, onSuccessCallback) => {
  const queryClient = useQueryClient();
  const { user } = useAuth();

  const likeMutation = useMutation({
    mutationFn: () => reviewService.likeReview(reviewId),
    onSuccess: (response) => {
      let reviewData = null;
      if (response?.status === 'ok' || response?.status === 'success') {
        if (response.data) {
          if (response.data.review) {
            reviewData = response.data.review;
          } else if (response.data.id) {
            reviewData = response.data;
          }
          
          // Update callback first to ensure state is synced
          if (onSuccessCallback && reviewData) {
            onSuccessCallback(reviewId, reviewData);
          }
        }
      }
      
      // Delay invalidate to allow callback to update state first
      setTimeout(() => {
        if (companyId) {
          queryClient.invalidateQueries({ queryKey: ['reviews', companyId] });
        }
        if (user?.id) {
          queryClient.invalidateQueries({ queryKey: ['user-activity-stats'] });
        }
      }, 100);
    },
    onError: (err) => {
      // Error handling - could revert optimistic update here
    },
  });

  const dislikeMutation = useMutation({
    mutationFn: () => reviewService.dislikeReview(reviewId),
    onSuccess: (response) => {
      let reviewData = null;
      if (response?.status === 'ok' || response?.status === 'success') {
        if (response.data) {
          if (response.data.review) {
            reviewData = response.data.review;
          } else if (response.data.id) {
            reviewData = response.data;
          }
          
          // Update callback first to ensure state is synced
          if (onSuccessCallback && reviewData) {
            onSuccessCallback(reviewId, reviewData);
          }
        }
      }
      
      // Delay invalidate to allow callback to update state first
      setTimeout(() => {
        if (companyId) {
          queryClient.invalidateQueries({ queryKey: ['reviews', companyId] });
        }
        if (user?.id) {
          queryClient.invalidateQueries({ queryKey: ['user-activity-stats'] });
        }
      }, 100);
    },
    onError: (err) => {
      // Error handling - could revert optimistic update here
    },
  });

  return {
    likeMutation,
    dislikeMutation,
    likeReview: likeMutation.mutate,
    dislikeReview: dislikeMutation.mutate,
    isLiking: likeMutation.isPending,
    isDisliking: dislikeMutation.isPending,
  };
};
</file>

<file path="FE/src/hooks/useReviewMutationsExtended.js">
import { useMutation, useQueryClient } from '@tanstack/react-query';
import { reviewService } from '../services/reviewService';
import { useAuth } from '../contexts/AuthContext';

export const useReviewMutationsExtended = (companyId) => {
  const queryClient = useQueryClient();
  const { user } = useAuth();

  const createMutation = useMutation({
    mutationFn: ({ companyId, reviewData }) => 
      reviewService.createReview(companyId, reviewData),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['reviews', companyId] });
      queryClient.invalidateQueries({ queryKey: ['company', companyId] });
      if (user?.id) {
        queryClient.invalidateQueries({ queryKey: ['user-activity-stats'] });
      }
    },
  });

  const updateMutation = useMutation({
    mutationFn: ({ reviewId, reviewData }) => 
      reviewService.updateReview(reviewId, reviewData),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['reviews', companyId] });
    },
  });

  const deleteMutation = useMutation({
    mutationFn: (reviewId) => reviewService.deleteReview(reviewId),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ['reviews', companyId] });
      queryClient.invalidateQueries({ queryKey: ['company', companyId] });
    },
  });

  return {
    createReview: createMutation.mutate,
    updateReview: updateMutation.mutate,
    deleteReview: deleteMutation.mutate,
    isCreating: createMutation.isPending,
    isUpdating: updateMutation.isPending,
    isDeleting: deleteMutation.isPending,
    createReviewAsync: createMutation.mutateAsync,
    updateReviewAsync: updateMutation.mutateAsync,
    deleteReviewAsync: deleteMutation.mutateAsync,
  };
};
</file>

<file path="FE/src/hooks/useReviews.js">
import { useQuery } from '@tanstack/react-query';
import { reviewService } from '../services/reviewService';

export const useReviews = (companyId, page = 1, enabled = true) => {
  return useQuery({
    queryKey: ['reviews', companyId, page],
    queryFn: () => reviewService.getReviews(companyId, page),
    enabled: enabled && !!companyId,
    staleTime: 30000,
    gcTime: 5 * 60 * 1000,
  });
};
</file>

<file path="FE/src/pages/AllCompanies.css">
.all-companies-container {
  padding: 0;
  background: var(--glassdoor-gray-bg);
  min-height: calc(100vh - 64px - 200px);
}

.page-header {
  background: var(--glassdoor-white);
  padding: 32px 24px;
  border-bottom: 1px solid var(--glassdoor-border);
  margin-bottom: 0;
}

.back-link {
  display: inline-flex;
  align-items: center;
  margin-bottom: 16px;
  color: var(--glassdoor-green);
  text-decoration: none;
  font-size: 16px;
  font-weight: 500;
  transition: all 0.2s ease;
  padding: 8px 12px;
  border-radius: 6px;
}

.back-link:hover {
  background-color: var(--glassdoor-green-light);
  color: var(--glassdoor-green-dark);
}

.page-header h1 {
  font-size: 36px;
  font-weight: 700;
  color: var(--glassdoor-gray);
  margin: 0 0 8px 0;
  letter-spacing: -0.5px;
}

.page-subtitle {
  font-size: 16px;
  color: var(--glassdoor-gray-light);
  margin: 0;
}

.filters-section {
  background: var(--glassdoor-white);
  padding: 28px 32px;
  border-bottom: 1px solid var(--glassdoor-border);
  display: flex;
  gap: 24px;
  flex-wrap: wrap;
  align-items: flex-end;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
}

.filter-group {
  display: flex;
  flex-direction: column;
  gap: 10px;
  flex: 1;
  min-width: 200px;
  max-width: 300px;
}

.sort-controls {
  display: flex;
  gap: 10px;
  align-items: stretch;
}

.sort-controls .filter-select {
  flex: 1;
}

.filter-group label {
  font-size: 13px;
  font-weight: 600;
  color: var(--glassdoor-gray);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 2px;
}

.filter-select {
  padding: 12px 16px;
  border: 2px solid var(--glassdoor-border);
  border-radius: 8px;
  font-size: 15px;
  background: var(--glassdoor-white);
  color: var(--glassdoor-gray);
  cursor: pointer;
  transition: all 0.2s ease;
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%23666' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 14px center;
  background-size: 12px;
  padding-right: 40px;
}

.filter-select:hover {
  border-color: var(--glassdoor-green);
  background-color: var(--glassdoor-gray-bg);
}

.filter-select:focus {
  outline: none;
  border-color: var(--glassdoor-green);
  box-shadow: 0 0 0 3px rgba(0, 168, 107, 0.1);
}

.filter-input {
  padding: 12px 16px;
  border: 2px solid var(--glassdoor-border);
  border-radius: 8px;
  font-size: 15px;
  background: var(--glassdoor-white);
  color: var(--glassdoor-gray);
  transition: all 0.2s ease;
}

.filter-input:hover {
  border-color: var(--glassdoor-green);
  background-color: var(--glassdoor-gray-bg);
}

.filter-input:focus {
  outline: none;
  border-color: var(--glassdoor-green);
  box-shadow: 0 0 0 3px rgba(0, 168, 107, 0.1);
}

.filter-input::placeholder {
  color: var(--glassdoor-gray-light);
}

.sort-order-btn {
  padding: 12px 16px;
  background: var(--glassdoor-white);
  border: 2px solid var(--glassdoor-border);
  border-radius: 8px;
  font-size: 18px;
  font-weight: 600;
  color: var(--glassdoor-gray);
  cursor: pointer;
  transition: all 0.2s ease;
  min-width: 50px;
  display: flex;
  align-items: center;
  justify-content: center;
  height: 48px;
}

.sort-order-btn:hover {
  background: var(--glassdoor-green);
  border-color: var(--glassdoor-green);
  color: white;
  transform: translateY(-1px);
  box-shadow: 0 2px 8px rgba(0, 168, 107, 0.2);
}

.sort-order-btn:active {
  transform: translateY(0);
}

.companies-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
  gap: 24px;
  padding: 40px 24px;
  max-width: 1200px;
  margin: 0 auto;
}

.pagination {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 12px;
  padding: 40px 24px;
  background: var(--glassdoor-white);
  border-top: 1px solid var(--glassdoor-border);
}

.pagination-btn {
  padding: 10px 20px;
  background: var(--glassdoor-white);
  color: var(--glassdoor-gray);
  border: 1px solid var(--glassdoor-border);
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 500;
  transition: all 0.2s ease;
}

.pagination-btn:hover:not(:disabled) {
  background: var(--glassdoor-gray-bg);
  border-color: var(--glassdoor-green);
  color: var(--glassdoor-green);
}

.pagination-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.pagination-pages {
  display: flex;
  gap: 8px;
}

.pagination-page {
  min-width: 40px;
  height: 40px;
  padding: 0 12px;
  background: var(--glassdoor-white);
  color: var(--glassdoor-gray);
  border: 1px solid var(--glassdoor-border);
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 500;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  justify-content: center;
}

.pagination-page:hover {
  background: var(--glassdoor-gray-bg);
  border-color: var(--glassdoor-green);
  color: var(--glassdoor-green);
}

.pagination-page.active {
  background: var(--glassdoor-green);
  color: white;
  border-color: var(--glassdoor-green);
}

.pagination-page.active:hover {
  background: var(--glassdoor-green-dark);
  border-color: var(--glassdoor-green-dark);
}

/* Responsive - Mobile */
@media (max-width: 768px) {
  .page-header {
    padding: 24px 16px;
  }

  .page-header h1 {
    font-size: 28px;
  }

  .filters-section {
    flex-direction: column;
    gap: 20px;
    padding: 24px 20px;
  }

  .filter-group {
    width: 100%;
    min-width: unset;
    max-width: 100%;
  }

  .sort-controls {
    width: 100%;
  }

  .sort-controls .filter-select {
    flex: 1;
  }

  .sort-order-btn {
    min-width: 50px;
  }

  .companies-grid {
    grid-template-columns: 1fr;
    gap: 16px;
    padding: 24px 16px;
  }

  .pagination {
    flex-wrap: wrap;
    padding: 24px 16px;
  }

  .pagination-pages {
    flex-wrap: wrap;
    justify-content: center;
  }
}
</file>

<file path="FE/src/pages/Login.css">
.login-container {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: calc(100vh - 200px);
  padding: 40px 20px;
  background: var(--glassdoor-gray-bg);
}

.login-card {
  background: var(--glassdoor-white);
  padding: 48px;
  border-radius: 12px;
  box-shadow: 0 4px 16px var(--glassdoor-shadow);
  width: 100%;
  max-width: 420px;
  border: 1px solid var(--glassdoor-border);
}

.login-card h2 {
  text-align: center;
  margin-bottom: 32px;
  color: var(--glassdoor-gray);
  font-size: 32px;
  font-weight: 700;
  letter-spacing: -0.5px;
}

.register-link {
  text-align: center;
  margin-top: 24px;
  color: var(--glassdoor-gray-light);
  font-size: 14px;
}

.register-link a {
  color: var(--glassdoor-green);
  text-decoration: none;
  font-weight: 600;
  transition: color 0.2s;
}

.register-link a:hover {
  color: var(--glassdoor-green-dark);
  text-decoration: underline;
}

/* Responsive - Mobile */
@media (max-width: 768px) {
  .login-container {
    padding: 10px;
  }

  .login-card {
    padding: 30px 20px;
  }

  .login-card h2 {
    font-size: 24px;
  }
}
</file>

<file path="FE/src/pages/Register.css">
.register-container {
  display: flex;
  justify-content: center;
  align-items: center;
  min-height: calc(100vh - 200px);
  padding: 40px 20px;
  background: var(--glassdoor-gray-bg);
}

.register-card {
  background: var(--glassdoor-white);
  padding: 48px;
  border-radius: 12px;
  box-shadow: 0 4px 16px var(--glassdoor-shadow);
  width: 100%;
  max-width: 520px;
  border: 1px solid var(--glassdoor-border);
}

.register-card h2 {
  text-align: center;
  margin-bottom: 32px;
  color: var(--glassdoor-gray);
  font-size: 32px;
  font-weight: 700;
  letter-spacing: -0.5px;
}

.login-link {
  text-align: center;
  margin-top: 24px;
  color: var(--glassdoor-gray-light);
  font-size: 14px;
}

.login-link a {
  color: var(--glassdoor-green);
  text-decoration: none;
  font-weight: 600;
  transition: color 0.2s;
}

.login-link a:hover {
  color: var(--glassdoor-green-dark);
  text-decoration: underline;
}

/* Responsive - Mobile */
@media (max-width: 768px) {
  .register-container {
    padding: 10px;
  }

  .register-card {
    padding: 30px 20px;
  }

  .register-card h2 {
    font-size: 24px;
  }
}
</file>

<file path="FE/src/services/reviewService.js">
import apiClient from './api';

// Review Services
export const reviewService = {
  // Get reviews for a company with pagination
  getReviews: async (companyId, page = 1, perPage = 10) => {
    return await apiClient.get(`/review?company_id=${companyId}&page=${page}&per_page=${perPage}`);
  },

  // Create review
  createReview: async (companyId, reviewData) => {
    return await apiClient.post(`/review?company_id=${companyId}`, {
      review: reviewData
    });
  },

  // Update review
  updateReview: async (reviewId, reviewData) => {
    return await apiClient.put(`/review/${reviewId}`, {
      review: reviewData
    });
  },

  // Delete review (Soft delete)
  deleteReview: async (reviewId) => {
    return await apiClient.put(`/review/${reviewId}/delete_review`);
  },

  // Like review
  likeReview: async (reviewId) => {
    return await apiClient.put(`/review/${reviewId}/like`);
  },

  // Dislike review
  dislikeReview: async (reviewId) => {
    return await apiClient.put(`/review/${reviewId}/dislike`);
  },

  // Get recent reviews (all companies)
  getRecentReviews: async (limit = 10) => {
    return await apiClient.get(`/review/recent?limit=${limit}`);
  },
};
</file>

<file path="FE/src/services/userService.js">
import apiClient from './api';

// User Services
export const userService = {
  // Get user details
  getUser: async (userId) => {
    return await apiClient.get(`/user/${userId}`);
  },

  // Update user profile
  updateProfile: async (userId, profileData) => {
    return await apiClient.put(`/user/${userId}/update_profile`, profileData);
  },

  // Delete user (Soft delete)
  deleteUser: async (userId) => {
    return await apiClient.put(`/user/${userId}/delete_user`);
  },

  // Get user activity stats (current user)
  getActivityStats: async () => {
    return await apiClient.get(`/user/activity_stats`);
  },

  // Get recent comments/replies (current user)
  getRecentComments: async (limit = 10) => {
    return await apiClient.get(`/user/recent_comments?limit=${limit}`);
  },
};
</file>

<file path="FE/package.json">
{
  "name": "fe",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "@tanstack/react-query": "^5.90.12",
    "axios": "^1.13.2",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-router-dom": "^6.22.3"
  },
  "devDependencies": {
    "@eslint/js": "^9.39.1",
    "@types/react": "^18.2.66",
    "@types/react-dom": "^18.2.22",
    "@vitejs/plugin-react": "^4.2.1",
    "eslint": "^9.39.1",
    "eslint-plugin-react-hooks": "^7.0.1",
    "eslint-plugin-react-refresh": "^0.4.24",
    "globals": "^16.5.0",
    "vite": "^5.2.11"
  }
}
</file>

<file path=".gitignore">
# See https://help.github.com/articles/ignoring-files for more about ignoring files.
#
# If you find yourself ignoring temporary files generated by your text editor
# or operating system, you probably want to add a global ignore instead:
#   git config --global core.excludesfile '~/.gitignore_global'

# Ignore bundler config.
/.bundle

# Ignore all logfiles and tempfiles.
/log/*
/tmp/*
!/log/.keep
!/tmp/.keep

# Ignore uploaded files in development
/storage/*
!/storage/.keep

.byebug_history

# Ignore master key for decrypting credentials and more.
/config/master.key

.idea

.env.development
.env.development.local
.env

.rakeTasks
.generators

coverage
.claude
plans
docs
/CLAUDE.md
/vendor/
</file>

<file path="docker-compose.yml">
version: "3"
services:
  web:
    app:
    build:
      context: .
      dockerfile: Dockerfile
    environment:
      RAILS_ENV: production
      RAILS_DB_HOST: db
      RAILS_DB_USER_NAME: postgres
      RAILS_DB_PASSWORD: password
    command: bash -c "rm -f tmp/pids/server.pid && bundle exec rails s -p 3000 -b '0.0.0.0'"
    ports:
      - 3000:3000
    depends_on:
      - redis
      - db

  db:
    image: postgres:13
    user: postgres
    volumes:
      - postgres_data:/var/lib/postgresql/data
    environment:
      - POSTGRES_PASSWORD=password

  redis:
    image: redis:6
    ports:
      - "6379:6379"

  zookeeper:
    image: confluentinc/cp-zookeeper:latest
    environment:
      ZOOKEEPER_CLIENT_PORT: 2181
      ZOOKEEPER_TICK_TIME: 2000
    ports:
      - 22181:2181

  kafka:
    image: confluentinc/cp-kafka:latest
    depends_on:
      - zookeeper
    ports:
      - 29092:29092
    environment:
      KAFKA_BROKER_ID: 1
      KAFKA_ZOOKEEPER_CONNECT: zookeeper:2181
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://kafka:9092,PLAINTEXT_HOST://localhost:29092
      KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: PLAINTEXT:PLAINTEXT,PLAINTEXT_HOST:PLAINTEXT
      KAFKA_INTER_BROKER_LISTENER_NAME: PLAINTEXT
      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 1

  sidekiq:
    build: .
    command: bundle exec sidekiq
    env_file:
      - .env
    depends_on:
      - db
      - redis
    environment:
      - RAILS_ENV=development
      - REDIS_URL=redis://redis:6379

volumes:
  postgres_data:
</file>

<file path="karafka.rb">
# frozen_string_literal: true

class KarafkaApp < Karafka::App
  setup do |config|
    config.kafka = { 'bootstrap.servers': '127.0.0.1:9092' }
    config.client_id = 'YOUR_APP_NAME'

    # IMPORTANT: Customize this group_id with your application name.
    # The group_id should be unique per application to properly track message consumption.
    # Example: config.group_id = 'inventory_service_consumer'
    #
    # Note: Advanced features and custom routing configurations may define their own consumer
    # groups. These should also be uniquely named per application to avoid conflicts.
    # For the advanced features, subscription groups and consumer groups in your routing
    # configuration, follow the same uniqueness principle.
    #
    # For more details on consumer groups and routing configuration, please refer to the
    # Karafka documentation: https://karafka.io/docs
    config.group_id = 'YOUR_APP_NAME_consumer'
    # Recreate consumers with each batch. This will allow Rails code reload to work in the
    # development mode. Otherwise Karafka process would not be aware of code changes
    config.consumer_persistence = !Rails.env.development?
  end

  # Comment out this part if you are not using instrumentation and/or you are not
  # interested in logging events for certain environments. Since instrumentation
  # notifications add extra boilerplate, if you want to achieve max performance,
  # listen to only what you really need for given environment.
  Karafka.monitor.subscribe(
    Karafka::Instrumentation::LoggerListener.new(
      # Karafka, when the logger is set to info, produces logs each time it polls data from an
      # internal messages queue. This can be extensive, so you can turn it off by setting below
      # to false.
      log_polling: true
    )
  )
  # Karafka.monitor.subscribe(Karafka::Instrumentation::ProctitleListener.new)

  # This logger prints the producer development info using the Karafka logger.
  # It is similar to the consumer logger listener but producer oriented.
  Karafka.producer.monitor.subscribe(
    WaterDrop::Instrumentation::LoggerListener.new(
      # Log producer operations using the Karafka logger
      Karafka.logger,
      # If you set this to true, logs will contain each message details
      # Please note, that this can be extensive
      log_messages: false
    )
  )

  # You can subscribe to all consumer related errors and record/track them that way
  #
  # Karafka.monitor.subscribe 'error.occurred' do |event|
  #   type = event[:type]
  #   error = event[:error]
  #   details = (error.backtrace || []).join("\n")
  #   ErrorTracker.send_error(error, type, details)
  # end

  # You can subscribe to all producer related errors and record/track them that way
  # Please note, that producer and consumer have their own notifications pipeline so you need to
  # setup error tracking independently for each of them
  #
  # Karafka.producer.monitor.subscribe('error.occurred') do |event|
  #   type = event[:type]
  #   error = event[:error]
  #   details = (error.backtrace || []).join("\n")
  #   ErrorTracker.send_error(error, type, details)
  # end

  routes.draw do
    # Uncomment this if you use Karafka with ActiveJob
    # You need to define the topic per each queue name you use
    # active_job_topic :default
    
    # Like event topic
    topic :like_event do
      consumer LikeEventConsumer
    end
    
    # Example topic (can be removed if not needed)
    topic :example do
      # Uncomment this if you want Karafka to manage your topics configuration
      # Managing topics configuration via routing will allow you to ensure config consistency
      # across multiple environments
      #
      # config(partitions: 2, 'cleanup.policy': 'compact')
      consumer ExampleConsumer
    end
  end
end

# Karafka now features a Web UI!
# Visit the setup documentation to get started and enhance your experience.
#
# https://karafka.io/docs/Web-UI-Getting-Started
</file>

<file path="app/controllers/api/v1/reply_controller.rb">
class Api::V1::ReplyController < ApplicationController
  around_action :with_transaction, only: %i[create update destroy]
  before_action :authenticate_user!, except: %i[index]
  before_action :get_review, only: %i[create index]
  before_action :get_reply, only: %i[update destroy]

  def index
    replies = Reply.where(review_id: @review.id)
    render json: json_with_success(message: I18n.t("controller.base.ok"), data: replies, default_serializer: ReplySerializer)
  end

  def create
    reply = Reply.create!(reply_review_params.merge!(user_id: current_user.id, review_id: @review.id))
    render json: json_with_success(message: I18n.t("controller.base.sucess"), data: reply, default_serializer: ReplySerializer)
  end

  def update
    @reply.update!(reply_review_params)
    render json_with_success(message: I18n.t("controller.base.sucess"), data: @reply, default_serializer: ReplySerializer)
  end

  def destroy
    @reply.destroy!
    render json: json_with_success(message: I18n.t("controller.base.destroyed"))
  end

  private

  def get_reply
    @reply = Reply.find(params[:id])
  end

  def get_review
    @review = Review.find(params[:review_id])
  end

  def reply_review_params
    params.permit(:content)
  end
end
</file>

<file path="app/serializers/review_serializer.rb">
class ReviewSerializer < BaseSerializer
  attributes :id, :title, :reviews_content, :score, :vote_for_quit, :vote_for_work,
             :is_anonymous, :job_title, :user_id, :created_at, :updated_at, :company_id, :created_at_timestamp,
             :updated_at_timestamp, :total_like, :total_dislike, :total_reply, :user_like_status, :user_name
  belongs_to :company, serializer: CompanySerializer

  def user_like_status
    return nil unless scope
    
    user_id = scope.respond_to?(:id) ? scope.id : scope
    return nil unless user_id
    
    like_record = object.likes.find_by(user_id: user_id)
    return nil unless like_record
    
    status_value = like_record.status
    return nil if status_value == 'default' || status_value == :default
    status_value.to_s
  end

  def user_name
    return nil if object.is_anonymous || !object.user
    full_name = [object.user.first_name, object.user.last_name].compact.join(' ').strip
    full_name.present? ? full_name : object.user.email
  end
end
</file>

<file path="config/environments/development.rb">
require "active_support/core_ext/integer/time"

Rails.application.configure do
  # Settings specified here will take precedence over those in config/application.rb.

  # In the development environment your application's code is reloaded any time
  # it changes. This slows down response time but is perfect for development
  # since you don't have to restart the web server when you make code changes.
  config.cache_classes = false

  # Do not eager load code on boot.
  config.eager_load = false

  # Show full error reports.
  config.consider_all_requests_local = true

  # Enable server timing
  config.server_timing = true

  # Enable/disable caching. By default caching is disabled.
  # Run rails dev:cache to toggle caching.
  if Rails.root.join('tmp', 'caching-dev.txt').exist?
    config.action_controller.perform_caching = true
    config.cache_store = :redis_cache_store, { url: ENV['REDIS_URL'] }
    config.public_file_server.headers        = {
      'Cache-Control' => "public, max-age=#{2.days.to_i}"
    }
  else
    config.action_controller.perform_caching = false

    config.cache_store = :null_store
  end

  # Store uploaded files on the local file system (see config/storage.yml for options).
  config.active_storage.service = :local

  # Don't care if the mailer can't send.
  config.action_mailer.raise_delivery_errors = false

  config.action_mailer.perform_caching = false

  # Print deprecation notices to the Rails logger.
  config.active_support.deprecation = :log

  # Raise exceptions for disallowed deprecations.
  config.active_support.disallowed_deprecation = :raise

  # Tell Active Support which deprecation messages to disallow.
  config.active_support.disallowed_deprecation_warnings = []

  # Raise an error on page load if there are pending migrations.
  config.active_record.migration_error = :page_load

  # Highlight code that triggered database queries in logs.
  config.active_record.verbose_query_logs = true

  # Allow ngrok domains for development
  # This allows requests from ngrok tunnels to reach the Rails server
  config.hosts << "advanced-unified-midge.ngrok-free.app"
  config.hosts << /.*\.ngrok-free\.app/
  config.hosts << /.*\.ngrok\.io/

  # Raises error for missing translations.
  # config.i18n.raise_on_missing_translations = true

  # Annotate rendered view with file names.
  # config.action_view.annotate_rendered_view_with_filenames = true

  # Uncomment if you wish to allow Action Cable access from any origin.
  # config.action_cable.disable_request_forgery_protection = true
end
</file>

<file path="config/initializers/apartment.rb">
# You can have Apartment route to the appropriate Tenant by adding some Rack middleware.
# Apartment can support many different "Elevators" that can take care of this routing to your data.
# Require whichever Elevator you're using below or none if you have a custom one.
require_relative "../../app/middleware/change_tenant.rb"
require 'apartment/elevators/generic'
# require 'apartment/elevators/domain'
# require 'apartment/elevators/subdomain'
# require 'apartment/elevators/first_subdomain'
# require 'apartment/elevators/host'

#
# Apartment Configuration
#
Apartment.configure do |config|

  # Add any models that you do not want to be multi-tenanted, but remain in the global (public) namespace.
  # A typical example would be a Customer or Tenant model that stores each Tenant's information.
  #
  config.excluded_models = ["Area", "User", "Role"]

  # In order to migrate all of your Tenants you need to provide a list of Tenant names to Apartment.
  # You can make this dynamic by providing a Proc object to be called on migrations.
  # This object should yield either:
  # - an array of strings representing each Tenant name.
  # - a hash which keys are tenant names, and values custom db config (must contain all key/values required in database.yml)
  #
  # config.tenant_names = lambda{ Customer.pluck(:tenant_name) }
  # config.tenant_names = ['tenant1', 'tenant2']
  # config.tenant_names = {
  #   'tenant1' => {
  #     adapter: 'postgresql',
  #     host: 'some_server',
  #     port: 5555,
  #     database: 'postgres' # this is not the name of the tenant's db
  #                          # but the name of the database to connect to before creating the tenant's db
  #                          # mandatory in postgresql
  #   },
  #   'tenant2' => {
  #     adapter:  'postgresql',
  #     database: 'postgres' # this is not the name of the tenant's db
  #                          # but the name of the database to connect to before creating the tenant's db
  #                          # mandatory in postgresql
  #   }
  # }
  # config.tenant_names = lambda do
  #   Tenant.all.each_with_object({}) do |tenant, hash|
  #     hash[tenant.name] = tenant.db_configuration
  #   end
  # end
  #
  config.tenant_names = lambda { Area.where(status: :active).pluck(:tenant_name) }

  # PostgreSQL:
  #   Specifies whether to use PostgreSQL schemas or create a new database per Tenant.
  #
  # MySQL:
  #   Specifies whether to switch databases by using `use` statement or re-establish connection.
  #
  # The default behaviour is true.
  #
  # config.use_schemas = true

  #
  # ==> PostgreSQL only options

  # Apartment can be forced to use raw SQL dumps instead of schema.rb for creating new schemas.
  # Use this when you are using some extra features in PostgreSQL that can't be represented in
  # schema.rb, like materialized views etc. (only applies with use_schemas set to true).
  # (Note: this option doesn't use db/structure.sql, it creates SQL dump by executing pg_dump)
  #
  # config.use_sql = false

  # There are cases where you might want some schemas to always be in your search_path
  # e.g when using a PostgreSQL extension like hstore.
  # Any schemas added here will be available along with your selected Tenant.
  #
  # config.persistent_schemas = %w{ hstore }
  config.persistent_schemas = %w{ shared_extensions }

  # <== PostgreSQL only options
  #

  # By default, and only when not using PostgreSQL schemas, Apartment will prepend the environment
  # to the tenant name to ensure there is no conflict between your environments.
  # This is mainly for the benefit of your development and test environments.
  # Uncomment the line below if you want to disable this behaviour in production.
  #
  # config.prepend_environment = !Rails.env.production?

  # When using PostgreSQL schemas, the database dump will be namespaced, and
  # apartment will substitute the default namespace (usually public) with the
  # name of the new tenant when creating a new tenant. Some items must maintain
  # a reference to the default namespace (ie public) - for instance, a default
  # uuid generation. Uncomment the line below to create a list of namespaced
  # items in the schema dump that should *not* have their namespace replaced by
  # the new tenant
  #
  # config.pg_excluded_names = ["uuid_generate_v4"]
end

# Setup a custom Tenant switching middleware. The Proc should return the name of the Tenant that
# you want to switch to.

Rails.application.config.middleware.use ChangeTenant
# Rails.application.config.middleware.use Apartment::Elevators::Domain
# Rails.application.config.middleware.use Apartment::Elevators::Subdomain
# Rails.application.config.middleware.use Apartment::Elevators::FirstSubdomain
# Rails.application.config.middleware.use Apartment::Elevators::Host
</file>

<file path="config/initializers/cors.rb">
# Be sure to restart your server when you modify this file.

# Avoid CORS issues when API is called from the frontend app.
# Handle Cross-Origin Resource Sharing (CORS) in order to accept cross-origin AJAX requests.

# Read more: https://github.com/cyu/rack-cors
# config/initializers/cors.rb

Rails.application.config.middleware.insert_before 0, Rack::Cors do
  allow do
    origins '*'
    resource '*', headers: :any, methods: [:get, :post, :patch, :put, :delete, :options]
  end
end
</file>

<file path="config/routes.rb">
Rails.application.routes.draw do
  # Define your application routes per the DSL in https://guides.rubyonrails.org/routing.html
  root to: redirect('/health')
  get 'health', to: 'health#show'

  # Load API routes if ATTACHED_API is set to non-zero, or in development/test by default
  if ENV['ATTACHED_API'].to_i.positive? || Rails.env.development? || Rails.env.test?
    extend ApiRoutes
  end
end
</file>

<file path="db/migrate/20231224034540_create_company.rb">
class CreateCompany < ActiveRecord::Migration[7.0]
  def change
    create_table :companies, id: :uuid do |t|
      t.string :name, limit: 100, null: false
      t.integer :is_active, default: true, null: false
      t.string :owner, limit: 100, null: false
      t.string :main_office, limit: 100
      t.string :phone, limit: 30
      t.uuid   :country_id, foreign_key: true
      t.integer :company_type, default: 0, null: false
      t.integer :company_size, default: 1, null: false
      t.float :avg_score, default: 0.0
      t.integer :total_reviews, default: 0
      t.boolean :is_good_company, default: true
      t.string :logo, limit: 255
      t.string :website, limit: 255

      t.timestamps
    end
  end
end
</file>

<file path="db/migrate/20231231100955_create_reply_reviews.rb">
class CreateReplyReviews < ActiveRecord::Migration[7.0]
  def change
    create_table :replies, id: :uuid do |t|
      t.references :review, null: false, foreign_key: true, type: :uuid
      t.uuid :user_id, null: false
      t.text :content, null: false
      t.boolean :is_deleted, default: false
      t.boolean :is_edited, default: false

      t.timestamps
    end
    add_index :replies, [:review_id, :user_id]
  end
end
</file>

<file path="db/migrate/20231231101013_create_like_reviews.rb">
class CreateLikeReviews < ActiveRecord::Migration[7.0]
  def change
    create_table :likes, id: :uuid do |t|
      t.references :review, null: false, foreign_key: true, unique: true, type: :uuid
      t.uuid :user_id, null: false
      t.integer :status, null: false, default: 1

      t.timestamps
    end
    add_index :likes, [:review_id, :user_id], unique: true
  end
end
</file>

<file path="FE/src/components/CreateCompanyForm.css">
.create-company-form {
  background: var(--glassdoor-white);
  padding: 32px;
  border-radius: 12px;
  box-shadow: 0 4px 16px var(--glassdoor-shadow);
  margin: 24px 0;
  border: 1px solid var(--glassdoor-border);
  max-width: 800px;
  margin-left: auto;
  margin-right: auto;
}

.create-company-form h3 {
  margin-bottom: 24px;
  color: var(--glassdoor-gray);
  font-size: 24px;
  font-weight: 700;
}

.info-message {
  padding: 20px;
  background-color: var(--glassdoor-green-light);
  border-radius: 8px;
  text-align: center;
  border: 1px solid var(--glassdoor-green);
  margin-bottom: 24px;
}

.info-message a {
  color: var(--glassdoor-green);
  text-decoration: none;
  font-weight: 600;
  transition: color 0.2s;
}

.info-message a:hover {
  color: var(--glassdoor-green-dark);
  text-decoration: underline;
}

.create-company-form .form-select {
  width: 100%;
  padding: 12px;
  border: 1px solid var(--glassdoor-border);
  border-radius: 8px;
  font-size: 16px;
  background-color: var(--glassdoor-white);
  color: var(--glassdoor-gray);
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%236B6B6B'%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 12px center;
  background-size: 20px;
  cursor: pointer;
  transition: border-color 0.2s ease, box-shadow 0.2s ease;
}

.create-company-form .form-select:focus {
  outline: none;
  border-color: var(--glassdoor-green);
  box-shadow: 0 0 0 3px var(--glassdoor-green-light);
}

.create-company-form .checkbox-label {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 15px;
  color: var(--glassdoor-gray);
  cursor: pointer;
}

.create-company-form .checkbox-label input[type="checkbox"] {
  width: 18px;
  height: 18px;
  border: 1px solid var(--glassdoor-border);
  border-radius: 4px;
  appearance: none;
  -webkit-appearance: none;
  background-color: var(--glassdoor-white);
  display: grid;
  place-content: center;
  transition: all 0.2s ease;
}

.create-company-form .checkbox-label input[type="checkbox"]::before {
  content: "";
  width: 10px;
  height: 10px;
  transform: scale(0);
  transition: transform 0.2s ease;
  box-shadow: inset 1em 1em var(--glassdoor-green);
  clip-path: polygon(14% 44%, 0 65%, 50% 100%, 100% 16%, 80% 0%, 43% 60%);
}

.create-company-form .checkbox-label input[type="checkbox"]:checked {
  border-color: var(--glassdoor-green);
  background-color: var(--glassdoor-green);
}

.create-company-form .checkbox-label input[type="checkbox"]:checked::before {
  transform: scale(1);
}

.employee-count-group {
  display: flex;
  align-items: center;
  gap: 12px;
}

.employee-count-input {
  flex: 1;
  padding: 12px;
  border: 1px solid var(--glassdoor-border);
  border-radius: 8px;
  font-size: 16px;
  transition: all 0.2s ease;
}

.employee-count-input:focus {
  outline: none;
  border-color: var(--glassdoor-green);
  box-shadow: 0 0 0 3px var(--glassdoor-green-light);
}

.employee-count-separator {
  font-size: 18px;
  font-weight: 600;
  color: var(--glassdoor-gray-light);
}

/* Responsive - Mobile */
@media (max-width: 768px) {
  .create-company-form {
    padding: 20px;
  }

  .create-company-form h3 {
    font-size: 20px;
  }
}
</file>

<file path="FE/src/components/CreateCompanyForm.jsx">
import { useState } from 'react';
import { useNavigate } from 'react-router-dom';
import { useAuth } from '../contexts/AuthContext';
import { companyService } from '../services/companyService';
import './CreateCompanyForm.css';

const CreateCompanyForm = ({ searchQuery, onSuccess, onCancel }) => {
  const { isAuthenticated } = useAuth();
  const navigate = useNavigate();
  const [formData, setFormData] = useState({
    name: searchQuery || '',
    owner: '',
    phone: '',
    main_office: '',
    website: '',
    industry: '',
    employee_count_min: '',
    employee_count_max: '',
    is_hiring: false,
  });
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState('');

  const handleChange = (e) => {
    setFormData({
      ...formData,
      [e.target.name]: e.target.value,
    });
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setError('');

    if (!formData.name || formData.name.trim().length < 2) {
      setError('T√™n c√¥ng ty ph·∫£i c√≥ √≠t nh·∫•t 2 k√Ω t·ª±');
      return;
    }

    if (!isAuthenticated) {
      setError('Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ t·∫°o c√¥ng ty');
      return;
    }

    try {
      setLoading(true);
      const submitData = {
        ...formData,
        employee_count_min: formData.employee_count_min ? parseInt(formData.employee_count_min) : null,
        employee_count_max: formData.employee_count_max ? parseInt(formData.employee_count_max) : null,
      };
      const response = await companyService.createCompany(submitData);
      
      if (response.status === 'ok' || response.status === 'success') {
        const company = response.data;
        if (onSuccess) {
          onSuccess(company);
        } else {
          navigate(`/companies/${company.id}`);
        }
      } else {
        setError(response.message || 'Kh√¥ng th·ªÉ t·∫°o c√¥ng ty');
      }
    } catch (err) {
      setError(err.message || err.error || 'Kh√¥ng th·ªÉ t·∫°o c√¥ng ty');
    } finally {
      setLoading(false);
    }
  };

  if (!isAuthenticated) {
    return (
      <div className="create-company-form">
        <div className="info-message">
          <p>Vui l√≤ng <a href="/login">ƒëƒÉng nh·∫≠p</a> ƒë·ªÉ t·∫°o c√¥ng ty m·ªõi.</p>
        </div>
      </div>
    );
  }

  return (
    <div className="create-company-form">
      <h3>T·∫°o c√¥ng ty m·ªõi</h3>
      {error && <div className="error-message">{error}</div>}
      <form onSubmit={handleSubmit}>
        <div className="form-group">
          <label>T√™n c√¥ng ty *</label>
          <input
            type="text"
            name="name"
            value={formData.name}
            onChange={handleChange}
            required
            minLength={2}
            placeholder="T√™n c√¥ng ty..."
          />
        </div>
        <div className="form-group">
          <label>Ch·ªß s·ªü h·ªØu *</label>
          <input
            type="text"
            name="owner"
            value={formData.owner}
            onChange={handleChange}
            required
            placeholder="T√™n ch·ªß s·ªü h·ªØu..."
          />
        </div>
        <div className="form-group">
          <label>S·ªë ƒëi·ªán tho·∫°i</label>
          <input
            type="tel"
            name="phone"
            value={formData.phone}
            onChange={handleChange}
            placeholder="+84123456789"
          />
        </div>
        <div className="form-group">
          <label>VƒÉn ph√≤ng ch√≠nh</label>
          <input
            type="text"
            name="main_office"
            value={formData.main_office}
            onChange={handleChange}
            placeholder="ƒê·ªãa ch·ªâ vƒÉn ph√≤ng..."
          />
        </div>
        <div className="form-group">
          <label>Website</label>
          <input
            type="url"
            name="website"
            value={formData.website}
            onChange={handleChange}
            placeholder="https://example.com"
          />
        </div>
        <div className="form-group">
          <label>Ng√†nh ngh·ªÅ</label>
          <select
            name="industry"
            value={formData.industry}
            onChange={handleChange}
            className="form-select"
          >
            <option value="">-- Ch·ªçn ng√†nh ngh·ªÅ --</option>
            <option value="CNTT - Ph·∫ßn m·ªÅm">CNTT - Ph·∫ßn m·ªÅm</option>
            <option value="Gi√°o d·ª•c">Gi√°o d·ª•c</option>
            <option value="B√°n h√†ng/ Kinh doanh">B√°n h√†ng/ Kinh doanh</option>
            <option value="B·∫£o hi·ªÉm">B·∫£o hi·ªÉm</option>
            <option value="Ng√¢n h√†ng">Ng√¢n h√†ng</option>
            <option value="S·∫£n xu·∫•t / V·∫≠n h√†nh s·∫£n xu·∫•t">S·∫£n xu·∫•t / V·∫≠n h√†nh s·∫£n xu·∫•t</option>
            <option value="D·ªãch v·ª• kh√°ch h√†ng">D·ªãch v·ª• kh√°ch h√†ng</option>
            <option value="K·ªπ thu·∫≠t">K·ªπ thu·∫≠t</option>
            <option value="Y t·∫ø / ChƒÉm s√≥c s·ª©c kh·ªèe">Y t·∫ø / ChƒÉm s√≥c s·ª©c kh·ªèe</option>
            <option value="Gi·∫£i tr√≠">Gi·∫£i tr√≠</option>
            <option value="Qu·∫£n l√Ω ch·∫•t l∆∞·ª£ng (QA/QC)">Qu·∫£n l√Ω ch·∫•t l∆∞·ª£ng (QA/QC)</option>
            <option value="ƒêi·ªán / ƒêi·ªán t·ª≠ / ƒêi·ªán l·∫°nh">ƒêi·ªán / ƒêi·ªán t·ª≠ / ƒêi·ªán l·∫°nh</option>
          </select>
        </div>
        <div className="form-group">
          <label>Quy m√¥ nh√¢n vi√™n</label>
          <div className="employee-count-group">
            <input
              type="number"
              name="employee_count_min"
              value={formData.employee_count_min}
              onChange={handleChange}
              placeholder="T·ª´"
              min="0"
              className="employee-count-input"
            />
            <span className="employee-count-separator">-</span>
            <input
              type="number"
              name="employee_count_max"
              value={formData.employee_count_max}
              onChange={handleChange}
              placeholder="ƒê·∫øn"
              min="0"
              className="employee-count-input"
            />
          </div>
        </div>
        <div className="form-group">
          <label className="checkbox-label">
            <input
              type="checkbox"
              name="is_hiring"
              checked={formData.is_hiring}
              onChange={(e) => setFormData({ ...formData, is_hiring: e.target.checked })}
            />
            <span>ƒêang tuy·ªÉn d·ª•ng</span>
          </label>
        </div>
        <div className="form-actions">
          {onCancel && (
            <button type="button" onClick={onCancel} className="btn-secondary">
              H·ªßy
            </button>
          )}
          <button type="submit" disabled={loading} className="btn-primary">
            {loading ? 'ƒêang t·∫°o...' : 'T·∫°o c√¥ng ty'}
          </button>
        </div>
      </form>
    </div>
  );
};

export default CreateCompanyForm;
</file>

<file path="FE/src/components/CreateReplyForm.jsx">
import { useState } from 'react';
import { useReplyMutations } from '../hooks/useReplyMutations';
import './CreateReplyForm.css';

const CreateReplyForm = ({ reviewId, onSuccess, onCancel }) => {
  const [content, setContent] = useState('');
  const [error, setError] = useState('');
  const { createReply, isCreating } = useReplyMutations(reviewId);

  const handleSubmit = async (e) => {
    e.preventDefault();
    setError('');

    if (!content.trim()) {
      setError('Vui l√≤ng nh·∫≠p n·ªôi dung tr·∫£ l·ªùi');
      return;
    }

    try {
      await createReply(content);
      onSuccess?.();
      setContent('');
    } catch (err) {
      setError(err.message || err.error || 'Kh√¥ng th·ªÉ t·∫°o tr·∫£ l·ªùi');
    }
  };

  return (
    <div className="create-reply-form">
      {error && <div className="error-message">{error}</div>}
      <form onSubmit={handleSubmit}>
        <textarea
          value={content}
          onChange={(e) => setContent(e.target.value)}
          placeholder="Vi·∫øt tr·∫£ l·ªùi..."
          rows={3}
          required
        />
        <div className="form-actions">
          {onCancel && (
            <button type="button" onClick={onCancel} className="btn-secondary">
              H·ªßy
            </button>
          )}
          <button type="submit" disabled={isCreating} className="btn-primary">
            {isCreating ? 'ƒêang g·ª≠i...' : 'G·ª≠i tr·∫£ l·ªùi'}
          </button>
        </div>
      </form>
    </div>
  );
};

export default CreateReplyForm;
</file>

<file path="FE/src/components/CreateReviewForm.css">
.create-review-form {
  background: var(--glassdoor-white);
  padding: 24px;
  border-radius: 12px;
  margin-bottom: 24px;
  border: 1px solid var(--glassdoor-border);
  box-shadow: 0 2px 8px var(--glassdoor-shadow);
}

.create-review-form h3 {
  margin-bottom: 20px;
  color: var(--glassdoor-gray);
  font-size: 22px;
  font-weight: 700;
}

.create-review-form .form-select {
  width: 100%;
  padding: 10px 12px;
  border: 1px solid var(--glassdoor-border);
  border-radius: 6px;
  font-size: 14px;
  background: var(--glassdoor-white);
  color: var(--glassdoor-gray);
  transition: border-color 0.2s ease;
}

.create-review-form .form-select:focus {
  outline: none;
  border-color: var(--glassdoor-green);
}

.create-review-form .checkbox-label {
  display: flex;
  align-items: center;
  gap: 8px;
  cursor: pointer;
  font-weight: 500;
  color: var(--glassdoor-gray);
}

.create-review-form .checkbox-label input[type="checkbox"] {
  width: 18px;
  height: 18px;
  cursor: pointer;
  accent-color: var(--glassdoor-green);
}

.create-review-form .form-hint {
  margin: 8px 0 0 0;
  font-size: 12px;
  color: var(--glassdoor-gray-light);
  font-style: italic;
}

/* Responsive - Mobile */
@media (max-width: 768px) {
  .create-review-form {
    padding: 15px;
  }

  .create-review-form h3 {
    font-size: 18px;
  }
}
</file>

<file path="FE/src/components/CreateReviewForm.jsx">
import { useState } from 'react';
import { useReviewMutationsExtended } from '../hooks/useReviewMutationsExtended';
import StarRating from './StarRating';
import './CreateReviewForm.css';

const CreateReviewForm = ({ companyId, onSuccess, onCancel }) => {
  const [formData, setFormData] = useState({
    title: '',
    reviews_content: '',
    score: 5,
    job_title: '',
    custom_job_title: '',
    is_anonymous: false,
  });
  const [error, setError] = useState('');
  const { createReview, isCreating } = useReviewMutationsExtended(companyId);

  const commonJobTitles = [
    'Software Engineer',
    'Senior Software Engineer',
    'Frontend Developer',
    'Backend Developer',
    'Full Stack Developer',
    'DevOps Engineer',
    'QA Engineer',
    'Product Manager',
    'Project Manager',
    'Business Analyst',
    'Data Analyst',
    'Data Scientist',
    'UI/UX Designer',
    'Marketing Manager',
    'Sales Manager',
    'HR Manager',
    'Accountant',
    'Customer Support',
    'Intern',
    'Other'
  ];

  const handleChange = (e) => {
    const { name, value, type, checked } = e.target;
    setFormData({
      ...formData,
      [name]: type === 'checkbox' ? checked : value,
    });
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    setError('');

    if (!formData.title || formData.title.length < 5) {
      setError('Ti√™u ƒë·ªÅ ph·∫£i c√≥ √≠t nh·∫•t 5 k√Ω t·ª±');
      return;
    }

    try {
      const submitData = {
        ...formData,
        job_title: formData.job_title === 'Other' ? formData.custom_job_title : formData.job_title,
      };
      delete submitData.custom_job_title;
      
      await createReview({ companyId, reviewData: submitData });
      onSuccess?.();
      setFormData({ title: '', reviews_content: '', score: 5, job_title: '', custom_job_title: '', is_anonymous: false });
    } catch (err) {
      setError(err.message || err.error || 'Kh√¥ng th·ªÉ t·∫°o ƒë√°nh gi√°');
    }
  };

  return (
    <div className="create-review-form">
      <h3>Vi·∫øt ƒë√°nh gi√°</h3>
      {error && <div className="error-message">{error}</div>}
      <form onSubmit={handleSubmit}>
        <div className="form-group">
          <label>Ti√™u ƒë·ªÅ *</label>
          <input
            type="text"
            name="title"
            value={formData.title}
            onChange={handleChange}
            required
            minLength={5}
            maxLength={100}
            placeholder="Ti√™u ƒë·ªÅ ƒë√°nh gi√°..."
          />
        </div>
        <div className="form-group">
          <label>ƒêi·ªÉm ƒë√°nh gi√° (1-10)</label>
          <StarRating
            value={formData.score}
            onChange={(score) => setFormData({ ...formData, score })}
          />
        </div>
        <div className="form-group">
          <label>Ch·ª©c danh c√¥ng vi·ªác t·∫°i c√¥ng ty n√†y</label>
          <select
            name="job_title"
            value={formData.job_title}
            onChange={handleChange}
            className="form-select"
          >
            <option value="">-- Ch·ªçn ch·ª©c danh --</option>
            {commonJobTitles.map((title) => (
              <option key={title} value={title}>
                {title}
              </option>
            ))}
          </select>
          {formData.job_title === 'Other' && (
            <input
              type="text"
              name="custom_job_title"
              value={formData.custom_job_title}
              onChange={handleChange}
              placeholder="Nh·∫≠p ch·ª©c danh c·ªßa b·∫°n..."
              className="form-input"
              style={{ marginTop: '8px' }}
            />
          )}
        </div>
        <div className="form-group">
          <label>N·ªôi dung ƒë√°nh gi√°</label>
          <textarea
            name="reviews_content"
            value={formData.reviews_content}
            onChange={handleChange}
            rows={5}
            placeholder="Chia s·∫ª tr·∫£i nghi·ªám c·ªßa b·∫°n..."
          />
        </div>
        <div className="form-group">
          <label className="checkbox-label">
            <input
              type="checkbox"
              name="is_anonymous"
              checked={formData.is_anonymous}
              onChange={handleChange}
            />
            <span>ƒê√°nh gi√° ·∫©n danh</span>
          </label>
          <p className="form-hint">N·∫øu ch·ªçn, t√™n c·ªßa b·∫°n s·∫Ω kh√¥ng ƒë∆∞·ª£c hi·ªÉn th·ªã c√¥ng khai</p>
        </div>
        <div className="form-actions">
          <button type="button" onClick={onCancel} className="btn-secondary">
            H·ªßy
          </button>
          <button type="submit" disabled={isCreating} className="btn-primary">
            {isCreating ? 'ƒêang g·ª≠i...' : 'G·ª≠i ƒë√°nh gi√°'}
          </button>
        </div>
      </form>
    </div>
  );
};

export default CreateReviewForm;
</file>

<file path="FE/src/components/ReviewItem.jsx">
import { useState, useEffect } from 'react';
import { useReviewMutations } from '../hooks/useReviewMutations';
import ReplyList from './ReplyList';
import CreateReplyForm from './CreateReplyForm';
import './ReviewItem.css';

const ReviewItem = ({ review, isAuthenticated, onUpdate, companyId }) => {
  const [currentReview, setCurrentReview] = useState(review);
  const [showReplies, setShowReplies] = useState(false);
  const [showReplyForm, setShowReplyForm] = useState(false);
  const [replyRefreshKey, setReplyRefreshKey] = useState(0);
  const [reloadReplies, setReloadReplies] = useState(null);

  useEffect(() => {
    setCurrentReview(review);
  }, [review]);

  const handleMutationSuccess = (reviewId, reviewData) => {
    if (reviewData && reviewData.id === reviewId) {
      // Ensure we have all the necessary fields from server response
      setCurrentReview(prev => ({
        ...prev,
        ...reviewData,
        total_like: reviewData.total_like ?? prev.total_like,
        total_dislike: reviewData.total_dislike ?? prev.total_dislike,
        user_like_status: reviewData.user_like_status ?? prev.user_like_status,
      }));
    }
    onUpdate?.();
  };

  const { likeReview, dislikeReview, isLiking, isDisliking } = useReviewMutations(
    review.id,
    companyId,
    handleMutationSuccess
  );

  const liked = currentReview.user_like_status === 'like';
  const disliked = currentReview.user_like_status === 'dislike';
  const loading = isLiking || isDisliking;

  const handleLike = () => {
    if (loading) return;
    
    // Optimistic update
    const previousStatus = currentReview.user_like_status;
    const previousLike = currentReview.total_like || 0;
    const previousDislike = currentReview.total_dislike || 0;
    
    let newStatus = 'like';
    let newLike = previousLike;
    let newDislike = previousDislike;
    
    if (previousStatus === 'like') {
      // Toggle off
      newStatus = null;
      newLike = Math.max(0, previousLike - 1);
    } else {
      // Toggle on
      newStatus = 'like';
      if (previousStatus === 'dislike') {
        newDislike = Math.max(0, previousDislike - 1);
        newLike = previousLike + 1;
      } else {
        newLike = previousLike + 1;
      }
    }
    
    setCurrentReview({
      ...currentReview,
      user_like_status: newStatus,
      total_like: newLike,
      total_dislike: newDislike,
    });
    
    likeReview();
  };

  const handleDislike = () => {
    if (loading) return;
    
    // Optimistic update
    const previousStatus = currentReview.user_like_status;
    const previousLike = currentReview.total_like || 0;
    const previousDislike = currentReview.total_dislike || 0;
    
    let newStatus = 'dislike';
    let newLike = previousLike;
    let newDislike = previousDislike;
    
    if (previousStatus === 'dislike') {
      // Toggle off
      newStatus = null;
      newDislike = Math.max(0, previousDislike - 1);
    } else {
      // Toggle on
      newStatus = 'dislike';
      if (previousStatus === 'like') {
        newLike = Math.max(0, previousLike - 1);
        newDislike = previousDislike + 1;
      } else {
        newDislike = previousDislike + 1;
      }
    }
    
    setCurrentReview({
      ...currentReview,
      user_like_status: newStatus,
      total_like: newLike,
      total_dislike: newDislike,
    });
    
    dislikeReview();
  };

  const formatDate = (dateString) => {
    if (!dateString) return '';
    const date = new Date(dateString);
    return date.toLocaleDateString('vi-VN', { 
      year: 'numeric', 
      month: 'long', 
      day: 'numeric' 
    });
  };

  return (
    <div className="review-item">
      <div className="review-header">
        <div className="review-title-score">
          <h4>{currentReview.title}</h4>
          <div className="score-badge">‚≠ê {currentReview.score}/10</div>
        </div>
        <div className="review-meta">
          {currentReview.job_title && (
            <span className="job-title-badge">üíº {currentReview.job_title}</span>
          )}
          {currentReview.is_anonymous ? (
            <span className="anonymous-badge">üîí ·∫®n danh</span>
          ) : (
            <span className="review-author">üë§ {currentReview.user_name || 'Ng∆∞·ªùi d√πng'}</span>
          )}
          {currentReview.created_at && (
            <span className="review-date">{formatDate(currentReview.created_at)}</span>
          )}
        </div>
      </div>

      <div className="review-content">
        <p>{currentReview.reviews_content || 'Kh√¥ng c√≥ n·ªôi dung ƒë√°nh gi√°.'}</p>
      </div>

      <div className="review-actions">
        {isAuthenticated && (
          <>
            <button
              className={`action-btn ${liked ? 'active' : ''}`}
              onClick={handleLike}
              disabled={loading}
            >
              üëç {currentReview.total_like || 0}
            </button>
            <button
              className={`action-btn ${disliked ? 'active' : ''}`}
              onClick={handleDislike}
              disabled={loading}
            >
              üëé {currentReview.total_dislike || 0}
            </button>
          </>
        )}
        <button
          className="action-btn"
          onClick={() => setShowReplies(!showReplies)}
        >
          üí¨ {currentReview.total_reply || 0} tr·∫£ l·ªùi
        </button>
        {isAuthenticated && (
          <button
            className="action-btn"
            onClick={() => setShowReplyForm(!showReplyForm)}
          >
            {showReplyForm ? 'H·ªßy' : 'Tr·∫£ l·ªùi'}
          </button>
        )}
      </div>

      {showReplyForm && isAuthenticated && (
        <CreateReplyForm
          reviewId={currentReview.id}
          onSuccess={async () => {
            setShowReplyForm(false);
            setShowReplies(true);
            setTimeout(() => {
              if (reloadReplies) {
                reloadReplies();
              } else {
                setReplyRefreshKey(prev => prev + 1);
              }
            }, 300);
            onUpdate?.();
          }}
          onCancel={() => setShowReplyForm(false)}
        />
      )}

      {showReplies && (
        <div className="replies-section">
          <ReplyList 
            key={`replies-${currentReview.id}-${replyRefreshKey}`}
            reviewId={currentReview.id} 
            refreshKey={replyRefreshKey}
            onMounted={setReloadReplies}
          />
        </div>
      )}
    </div>
  );
};

export default ReviewItem;
</file>

<file path="FE/src/components/ReviewList.css">
.review-list {
  display: flex;
  flex-direction: column;
  gap: 0;
}

.load-more-container {
  display: flex;
  justify-content: center;
  padding: 24px 0;
  margin-top: 20px;
}

.btn-load-more {
  background: var(--glassdoor-white);
  border: 2px solid var(--glassdoor-green);
  color: var(--glassdoor-green);
  padding: 12px 32px;
  border-radius: 8px;
  font-size: 15px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s ease;
}

.btn-load-more:hover:not(:disabled) {
  background: var(--glassdoor-green);
  color: white;
  transform: translateY(-2px);
  box-shadow: 0 4px 12px rgba(0, 168, 107, 0.3);
}

.btn-load-more:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

.empty-reviews {
  text-align: center;
  padding: 60px 24px;
  color: var(--glassdoor-gray-light);
  font-size: 16px;
  background: var(--glassdoor-white);
  border-radius: 12px;
  border: 1px solid var(--glassdoor-border);
}
</file>

<file path="FE/src/components/ReviewList.jsx">
import { useState, useEffect } from 'react';
import { useAuth } from '../contexts/AuthContext';
import { reviewService } from '../services/reviewService';
import ReviewItem from './ReviewItem';
import './ReviewList.css';

const ReviewList = ({ reviews: initialReviews, pagination: initialPagination, onUpdate, companyId }) => {
  const { isAuthenticated } = useAuth();
  const [reviews, setReviews] = useState(initialReviews || []);
  const [page, setPage] = useState(1);
  const [loading, setLoading] = useState(false);
  const [hasMore, setHasMore] = useState(true);
  const [pagination, setPagination] = useState(initialPagination || null);

  useEffect(() => {
    if (initialReviews) {
      setReviews(initialReviews);
      setPage(1);
      if (initialPagination) {
        setPagination(initialPagination);
        setHasMore(1 < initialPagination.total_pages);
      } else {
        setHasMore(initialReviews.length >= 10);
      }
    } else {
      setReviews([]);
      setPage(1);
      setHasMore(false);
      setPagination(null);
    }
  }, [initialReviews, initialPagination]);

  const loadMoreReviews = async () => {
    if (loading || !hasMore) return;

    try {
      setLoading(true);
      const nextPage = page + 1;
      const response = await reviewService.getReviews(companyId, nextPage);
      
      if (response.status === 'ok' || response.status === 'success') {
        const newReviews = response.data || [];
        
        if (newReviews.length === 0) {
          setHasMore(false);
        } else {
          const existingIds = new Set(reviews.map(r => r.id));
          const uniqueNewReviews = newReviews.filter(r => !existingIds.has(r.id));
          
          if (uniqueNewReviews.length > 0) {
            setReviews(prev => [...prev, ...uniqueNewReviews]);
            setPage(nextPage);
          }
          
          if (response.pagination) {
            setPagination(response.pagination);
            if (nextPage >= response.pagination.total_pages) {
              setHasMore(false);
            } else {
              setHasMore(true);
            }
          } else {
            if (newReviews.length < 10) {
              setHasMore(false);
            } else {
              setHasMore(true);
            }
          }
        }
      } else {
        setHasMore(false);
      }
    } catch (err) {
      setHasMore(false);
    } finally {
      setLoading(false);
    }
  };

  if (!reviews || reviews.length === 0) {
    return (
      <div className="empty-reviews">
        <p>Ch∆∞a c√≥ ƒë√°nh gi√° n√†o. H√£y l√† ng∆∞·ªùi ƒë·∫ßu ti√™n ƒë√°nh gi√°!</p>
      </div>
    );
  }

  return (
    <div className="review-list">
      {reviews.map((review) => (
        <ReviewItem
          key={review.id}
          review={review}
          isAuthenticated={isAuthenticated}
          onUpdate={onUpdate}
          companyId={companyId}
        />
      ))}
      
      {hasMore && (
        <div className="load-more-container">
          <button
            className="btn-load-more"
            onClick={loadMoreReviews}
            disabled={loading}
          >
            {loading ? 'ƒêang t·∫£i...' : 'Xem th√™m ƒë√°nh gi√°'}
          </button>
        </div>
      )}
    </div>
  );
};

export default ReviewList;
</file>

<file path="FE/src/pages/AllCompanies.jsx">
import { useState, useEffect } from 'react';
import { Link } from 'react-router-dom';
import { companyService } from '../services/companyService';
import './AllCompanies.css';

const AllCompanies = () => {
  const [companies, setCompanies] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState('');
  const [page, setPage] = useState(1);
  const [totalPages, setTotalPages] = useState(1);
  const [totalCount, setTotalCount] = useState(0);
  const [filterBy, setFilterBy] = useState('');
  const [sortBy, setSortBy] = useState('created_at');
  const [sortOrder, setSortOrder] = useState('desc');
  const [location, setLocation] = useState('');
  const perPage = 20;

  useEffect(() => {
    loadCompanies();
  }, [filterBy, sortBy, sortOrder, location]);

  useEffect(() => {
    if (page === 1) {
      loadCompanies();
    } else {
      loadPageCompanies();
    }
  }, [page]);

  const loadCompanies = async () => {
    try {
      setLoading(true);
      setError('');
      
      const options = {
        page: 1,
        perPage,
        filterBy: filterBy || undefined,
        sortBy,
        sortOrder,
        location: location || undefined,
      };
      
      const response = await companyService.getCompanies(null, options);
      
      if (response.status === 'ok' || response.status === 'success') {
        setCompanies(response.data || []);
        if (response.pagination) {
          setTotalPages(response.pagination.total_pages || 1);
          setTotalCount(response.pagination.total_count || response.data?.length || 0);
        } else {
          setTotalCount(response.data?.length || 0);
        }
      } else {
        setError(response.message || 'Kh√¥ng th·ªÉ t·∫£i danh s√°ch c√¥ng ty');
      }
    } catch (err) {
      setError(err.message || err.error || 'Kh√¥ng th·ªÉ t·∫£i danh s√°ch c√¥ng ty');
    } finally {
      setLoading(false);
    }
  };

  const loadPageCompanies = async () => {
    try {
      setLoading(true);
      setError('');
      
      const options = {
        page,
        perPage,
        filterBy: filterBy || undefined,
        sortBy,
        sortOrder,
        location: location || undefined,
      };
      
      const response = await companyService.getCompanies(null, options);
      
      if (response.status === 'ok' || response.status === 'success') {
        setCompanies(response.data || []);
        if (response.pagination) {
          setTotalPages(response.pagination.total_pages || 1);
          setTotalCount(response.pagination.total_count || 0);
        }
        window.scrollTo({ top: 0, behavior: 'smooth' });
      } else {
        setError(response.message || 'Kh√¥ng th·ªÉ t·∫£i danh s√°ch c√¥ng ty');
      }
    } catch (err) {
      setError(err.message || err.error || 'Kh√¥ng th·ªÉ t·∫£i danh s√°ch c√¥ng ty');
    } finally {
      setLoading(false);
    }
  };

  const handleFilterChange = (newFilter) => {
    setFilterBy(newFilter);
    setPage(1);
  };

  const handleSortChange = (newSortBy) => {
    if (sortBy === newSortBy) {
      setSortOrder(sortOrder === 'desc' ? 'asc' : 'desc');
    } else {
      setSortBy(newSortBy);
      setSortOrder('desc');
    }
    setPage(1);
  };

  const handleLocationChange = (e) => {
    setLocation(e.target.value);
    setPage(1);
  };

  const handlePageChange = (newPage) => {
    setPage(newPage);
  };

  if (loading && companies.length === 0) {
    return <div className="loading">ƒêang t·∫£i...</div>;
  }

  if (error && companies.length === 0) {
    return (
      <div className="error">
        <p>{error}</p>
        <Link to="/" className="back-link">‚Üê Quay l·∫°i trang ch·ªß</Link>
      </div>
    );
  }

  return (
    <div className="all-companies-container">
      <div className="page-header">
        <Link to="/" className="back-link">‚Üê Quay l·∫°i trang ch·ªß</Link>
        <h1>T·∫•t c·∫£ c√¥ng ty</h1>
        <p className="page-subtitle">T·ªïng c·ªông {totalCount} c√¥ng ty</p>
      </div>

      <div className="filters-section">
        <div className="filter-group">
          <label>üîç L·ªçc theo</label>
          <select
            value={filterBy}
            onChange={(e) => handleFilterChange(e.target.value)}
            className="filter-select"
          >
            <option value="">T·∫•t c·∫£ c√¥ng ty</option>
            <option value="highest_rated">‚≠ê ƒêi·ªÉm ƒë√°nh gi√° cao nh·∫•t</option>
            <option value="most_reviews">üìù Nhi·ªÅu ƒë√°nh gi√° nh·∫•t</option>
            <option value="most_liked">‚ù§Ô∏è ƒê∆∞·ª£c y√™u th√≠ch nh·∫•t</option>
          </select>
        </div>

        <div className="filter-group">
          <label>üìä S·∫Øp x·∫øp theo</label>
          <div className="sort-controls">
            <select
              value={sortBy}
              onChange={(e) => handleSortChange(e.target.value)}
              className="filter-select"
            >
              <option value="created_at">üïê M·ªõi nh·∫•t</option>
              <option value="avg_score">‚≠ê ƒêi·ªÉm ƒë√°nh gi√°</option>
              <option value="total_reviews">üìù S·ªë l∆∞·ª£ng ƒë√°nh gi√°</option>
            </select>
            <button
              className="sort-order-btn"
              onClick={() => setSortOrder(sortOrder === 'desc' ? 'asc' : 'desc')}
              title={sortOrder === 'desc' ? 'Gi·∫£m d·∫ßn' : 'TƒÉng d·∫ßn'}
            >
              {sortOrder === 'desc' ? '‚Üì' : '‚Üë'}
            </button>
          </div>
        </div>

        <div className="filter-group">
          <label>üìç T√¨m theo ƒë·ªãa ƒëi·ªÉm</label>
          <input
            type="text"
            value={location}
            onChange={handleLocationChange}
            placeholder="Nh·∫≠p ƒë·ªãa ƒëi·ªÉm..."
            className="filter-input"
          />
        </div>
      </div>

      {error && (
        <div className="error-message">{error}</div>
      )}

      <div className="companies-grid">
        {companies.length === 0 ? (
          <div className="empty-state">
            <p>Ch∆∞a c√≥ c√¥ng ty n√†o</p>
          </div>
        ) : (
          companies.map((company) => (
            <Link
              key={company.id}
              to={`/companies/${company.id}`}
              className="company-card"
            >
              <div className="company-header">
                <h3>{company.name}</h3>
                <div className="company-score">
                  <span>‚≠ê</span>
                  <span>{company.avg_score?.toFixed(1) || '0.0'}</span>
                </div>
              </div>
              <div className="company-info">
                <p className="company-owner">
                  <span className="icon">üë§</span>
                  <span>{company.owner}</span>
                </p>
                <p className="company-reviews">
                  <span className="icon">üìù</span>
                  <span>{company.total_reviews || 0} ƒë√°nh gi√°</span>
                </p>
                {company.main_office && (
                  <p className="company-location">
                    <span className="icon">üìç</span>
                    <span>{company.main_office}</span>
                  </p>
                )}
              </div>
            </Link>
          ))
        )}
      </div>

      {/* Pagination */}
      {totalPages > 1 && (
        <div className="pagination">
          <button
            className="pagination-btn"
            onClick={() => handlePageChange(page - 1)}
            disabled={page === 1}
          >
            ‚Äπ Tr∆∞·ªõc
          </button>
          
          <div className="pagination-pages">
            {Array.from({ length: Math.min(totalPages, 5) }, (_, i) => {
              let pageNum;
              if (totalPages <= 5) {
                pageNum = i + 1;
              } else if (page <= 3) {
                pageNum = i + 1;
              } else if (page >= totalPages - 2) {
                pageNum = totalPages - 4 + i;
              } else {
                pageNum = page - 2 + i;
              }
              
              return (
                <button
                  key={pageNum}
                  className={`pagination-page ${page === pageNum ? 'active' : ''}`}
                  onClick={() => handlePageChange(pageNum)}
                >
                  {pageNum}
                </button>
              );
            })}
          </div>

          <button
            className="pagination-btn"
            onClick={() => handlePageChange(page + 1)}
            disabled={page === totalPages}
          >
            Sau ‚Ä∫
          </button>
        </div>
      )}
    </div>
  );
};

export default AllCompanies;
</file>

<file path="FE/src/pages/Home.css">
.home-container {
  padding: 0;
  background: var(--glassdoor-gray-bg);
}

.hero-section {
  background: linear-gradient(135deg, var(--glassdoor-white) 0%, var(--glassdoor-gray-bg) 100%);
  padding: 80px 24px 60px;
  text-align: center;
  border-bottom: 2px solid var(--glassdoor-border);
}

.hero-content {
  max-width: 800px;
  margin: 0 auto 40px;
}

.hero-title {
  font-size: 48px;
  font-weight: 700;
  color: var(--glassdoor-gray);
  margin: 0 0 16px 0;
  letter-spacing: -0.5px;
  line-height: 1.2;
}

.hero-subtitle {
  font-size: 20px;
  color: var(--glassdoor-gray-light);
  margin: 0;
  line-height: 1.6;
}

.hero-search {
  max-width: 600px;
  margin: 0 auto;
}

.hero-search-form {
  display: flex;
  gap: 12px;
  align-items: center;
}

.hero-search-input {
  flex: 1;
  padding: 18px 24px;
  border: 2px solid var(--glassdoor-border);
  border-radius: 12px;
  font-size: 16px;
  transition: all 0.2s ease;
  background-color: var(--glassdoor-white);
  color: var(--glassdoor-gray);
}

.hero-search-input:focus {
  outline: none;
  border-color: var(--glassdoor-green);
  box-shadow: 0 0 0 4px var(--glassdoor-green-light);
}

.hero-search-btn {
  padding: 18px 32px;
  background: linear-gradient(135deg, var(--glassdoor-green) 0%, var(--glassdoor-green-dark) 100%);
  color: white;
  border: none;
  border-radius: 12px;
  font-size: 16px;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  white-space: nowrap;
  box-shadow: 0 4px 16px rgba(0, 168, 107, 0.3);
}

.hero-search-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 24px rgba(0, 168, 107, 0.4);
}

.main-content-layout {
  max-width: 1400px;
  margin: 0 auto;
  padding: 40px 24px;
  display: grid;
  grid-template-columns: 1fr 350px;
  gap: 32px;
  align-items: start;
}

.companies-main-section {
  background: var(--glassdoor-white);
  border-radius: 12px;
  padding: 32px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
  border: 1px solid var(--glassdoor-border);
}

.companies-main-section .companies-header {
  margin-bottom: 24px;
  padding-bottom: 20px;
  border-bottom: 2px solid var(--glassdoor-border);
}

.companies-main-section .companies-header h2 {
  font-size: 24px;
  font-weight: 700;
  color: var(--glassdoor-gray);
  margin: 0;
}

.companies-main-section .empty-state {
  text-align: center;
  padding: 60px 24px;
  color: var(--glassdoor-gray-light);
  font-size: 16px;
  background: var(--glassdoor-gray-bg);
  border-radius: 12px;
  border: 1px solid var(--glassdoor-border);
}

.filter-buttons {
  display: flex;
  gap: 12px;
  margin-bottom: 24px;
  padding-bottom: 20px;
  border-bottom: 2px solid var(--glassdoor-border);
}

.filter-btn {
  padding: 12px 24px;
  background: var(--glassdoor-gray-bg);
  border: 2px solid var(--glassdoor-border);
  border-radius: 8px;
  font-size: 15px;
  font-weight: 600;
  color: var(--glassdoor-gray);
  cursor: pointer;
  transition: all 0.2s ease;
}

.filter-btn:hover {
  background: var(--glassdoor-white);
  border-color: var(--glassdoor-green);
  color: var(--glassdoor-green);
}

.filter-btn.active {
  background: linear-gradient(135deg, var(--glassdoor-green) 0%, var(--glassdoor-green-dark) 100%);
  color: white;
  border-color: var(--glassdoor-green);
  box-shadow: 0 4px 12px rgba(0, 168, 107, 0.3);
}

.companies-list {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.company-list-item {
  display: block;
  padding: 24px;
  background: var(--glassdoor-white);
  border: 1px solid var(--glassdoor-border);
  border-radius: 12px;
  text-decoration: none;
  color: inherit;
  transition: all 0.3s ease;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
}

.company-list-item:hover {
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
  border-color: var(--glassdoor-green);
  transform: translateY(-2px);
}

.company-list-header {
  display: flex;
  justify-content: space-between;
  align-items: start;
  margin-bottom: 12px;
  gap: 16px;
  flex-wrap: wrap;
}

.company-list-name {
  font-size: 20px;
  font-weight: 700;
  color: var(--glassdoor-gray);
  margin: 0;
  flex: 1;
  line-height: 1.3;
}

.company-list-rating {
  display: flex;
  align-items: center;
  gap: 6px;
  flex-wrap: wrap;
}

.rating-stars {
  font-size: 18px;
}

.rating-value {
  font-size: 18px;
  font-weight: 700;
  color: var(--glassdoor-gray);
}

.rating-separator {
  font-size: 14px;
  color: var(--glassdoor-gray-light);
}

.review-count {
  font-size: 14px;
  color: var(--glassdoor-gray);
  font-weight: 500;
}

.company-list-info {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  align-items: center;
}

.info-badge {
  display: inline-block;
  padding: 6px 12px;
  background: var(--glassdoor-gray-bg);
  border: 1px solid var(--glassdoor-border);
  border-radius: 6px;
  font-size: 13px;
  color: var(--glassdoor-gray);
  font-weight: 500;
}

.info-badge.industry {
  background: var(--glassdoor-blue-light);
  color: var(--glassdoor-blue);
  border-color: rgba(11, 95, 170, 0.2);
}

.hiring-badge {
  display: inline-block;
  padding: 6px 12px;
  background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
  color: white;
  border-radius: 6px;
  font-size: 12px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  box-shadow: 0 2px 8px rgba(255, 107, 107, 0.3);
}

.sidebar-section {
  position: sticky;
  top: 100px;
}

.pagination {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 8px;
  margin-top: 32px;
  padding-top: 24px;
  border-top: 1px solid var(--glassdoor-border);
}

.pagination-btn {
  padding: 10px 16px;
  background: var(--glassdoor-white);
  border: 1px solid var(--glassdoor-border);
  border-radius: 8px;
  font-size: 14px;
  font-weight: 600;
  color: var(--glassdoor-gray);
  cursor: pointer;
  transition: all 0.2s ease;
}

.pagination-btn:hover:not(:disabled) {
  background: var(--glassdoor-green);
  color: white;
  border-color: var(--glassdoor-green);
}

.pagination-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.pagination-pages {
  display: flex;
  gap: 4px;
}

.pagination-page {
  min-width: 40px;
  height: 40px;
  padding: 0 12px;
  background: var(--glassdoor-white);
  border: 1px solid var(--glassdoor-border);
  border-radius: 8px;
  font-size: 14px;
  font-weight: 600;
  color: var(--glassdoor-gray);
  cursor: pointer;
  transition: all 0.2s ease;
}

.pagination-page:hover {
  background: var(--glassdoor-gray-bg);
  border-color: var(--glassdoor-green);
}

.pagination-page.active {
  background: linear-gradient(135deg, var(--glassdoor-green) 0%, var(--glassdoor-green-dark) 100%);
  color: white;
  border-color: var(--glassdoor-green);
  box-shadow: 0 2px 8px rgba(0, 168, 107, 0.3);
}

.header {
  text-align: center;
  margin-bottom: 0;
  padding: 60px 24px 40px;
  background: var(--glassdoor-white);
  border-bottom: 1px solid var(--glassdoor-border);
}

.search-section {
  margin-bottom: 0;
  padding: 40px 24px;
  background: var(--glassdoor-white);
  border-bottom: 1px solid var(--glassdoor-border);
}

.view-all-section {
  margin-top: 16px;
  text-align: center;
}

.view-all-btn {
  background: transparent;
  color: var(--glassdoor-green);
  border: 1px solid var(--glassdoor-green);
  padding: 10px 20px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 600;
  transition: all 0.2s ease;
}

.view-all-btn:hover {
  background-color: var(--glassdoor-green);
  color: white;
}

.search-form {
  display: flex;
  gap: 12px;
  max-width: 900px;
  margin: 0 auto;
  align-items: center;
}

.search-input {
  flex: 1;
  padding: 16px 24px;
  border: 2px solid var(--glassdoor-border);
  border-radius: 8px;
  font-size: 16px;
  transition: all 0.2s ease;
  background-color: var(--glassdoor-white);
  color: var(--glassdoor-gray);
}

.search-input:focus {
  outline: none;
  border-color: var(--glassdoor-green);
  box-shadow: 0 0 0 4px var(--glassdoor-green-light);
}

.search-input::placeholder {
  color: var(--glassdoor-gray-light);
}

.search-btn {
  padding: 12px 24px;
  white-space: nowrap;
}

.no-results-section {
  margin: 0;
  padding: 60px 24px;
  text-align: center;
  background: var(--glassdoor-white);
}

.no-results-message {
  background: var(--glassdoor-white);
  padding: 48px;
  border-radius: 12px;
  box-shadow: 0 2px 8px var(--glassdoor-shadow);
  max-width: 600px;
  margin: 0 auto;
  border: 1px solid var(--glassdoor-border);
}

.no-results-message p {
  font-size: 18px;
  color: var(--glassdoor-gray-light);
  margin-bottom: 24px;
  line-height: 1.6;
}

.no-results-message strong {
  color: var(--glassdoor-gray);
  font-weight: 600;
}

.login-prompt {
  margin-top: 20px;
}

.login-prompt a {
  color: var(--glassdoor-green);
  text-decoration: none;
  font-weight: 600;
  transition: color 0.2s;
}

.login-prompt a:hover {
  color: var(--glassdoor-green-dark);
  text-decoration: underline;
}

.header h1 {
  font-size: 48px;
  font-weight: 700;
  color: var(--glassdoor-gray);
  margin-bottom: 12px;
  letter-spacing: -0.5px;
}

.header p {
  font-size: 20px;
  color: var(--glassdoor-gray-light);
  font-weight: 400;
}

/* Top Companies Slider Section */
.top-companies-section {
  max-width: 1200px;
  margin: 60px auto;
  padding: 60px 32px;
  background: linear-gradient(135deg, var(--glassdoor-white) 0%, var(--glassdoor-gray-bg) 100%);
  border-radius: 24px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
  border: 1px solid var(--glassdoor-border);
  position: relative;
  overflow: hidden;
}

.top-companies-section::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 6px;
  background: linear-gradient(90deg, var(--glassdoor-green), var(--glassdoor-green-dark), var(--glassdoor-green));
  background-size: 200% 100%;
  animation: shimmer 3s linear infinite;
}

@keyframes shimmer {
  0% { background-position: -200% 0; }
  100% { background-position: 200% 0; }
}

.top-companies-header {
  margin-bottom: 40px;
  text-align: center;
}

.top-companies-header h2 {
  font-size: 36px;
  font-weight: 700;
  background: linear-gradient(135deg, var(--glassdoor-green) 0%, var(--glassdoor-green-dark) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin: 0 0 12px 0;
  letter-spacing: -0.5px;
}

.slider-subtitle {
  font-size: 14px;
  color: var(--glassdoor-gray-light);
  margin: 0;
  font-weight: 500;
}

.companies-slider {
  position: relative;
  display: flex;
  align-items: center;
  gap: 20px;
  overflow: hidden;
  padding: 20px 0;
}

.slider-container {
  flex: 1;
  overflow: hidden;
  border-radius: 16px;
  position: relative;
}

.slider-track {
  display: flex;
  transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
  width: 100%;
  will-change: transform;
}

.slider-slide {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 24px;
  min-width: 100%;
  flex-shrink: 0;
  padding: 0 8px;
  animation: fadeIn 0.6s ease;
}

@keyframes fadeIn {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.slider-btn {
  background: linear-gradient(135deg, var(--glassdoor-green) 0%, var(--glassdoor-green-dark) 100%);
  color: white;
  border: none;
  width: 56px;
  height: 56px;
  border-radius: 50%;
  font-size: 28px;
  font-weight: 700;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
  flex-shrink: 0;
  z-index: 10;
  box-shadow: 0 4px 16px rgba(0, 168, 107, 0.3);
  position: relative;
  overflow: hidden;
}

.slider-btn::before {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  width: 0;
  height: 0;
  border-radius: 50%;
  background: rgba(255, 255, 255, 0.3);
  transform: translate(-50%, -50%);
  transition: width 0.6s, height 0.6s;
}

.slider-btn:hover::before {
  width: 300px;
  height: 300px;
}

.slider-btn:hover {
  transform: scale(1.15);
  box-shadow: 0 8px 24px rgba(0, 168, 107, 0.4);
}

.slider-btn:active {
  transform: scale(1.05);
}

.slider-btn:disabled {
  opacity: 0.4;
  cursor: not-allowed;
  transform: scale(1);
}

.slider-dots {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 12px;
  margin-top: 32px;
  padding: 16px;
}

.slider-dots .dot {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  border: 2px solid var(--glassdoor-border);
  background: var(--glassdoor-white);
  cursor: pointer;
  transition: all 0.3s ease;
  padding: 0;
  position: relative;
}

.slider-dots .dot::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  width: 0;
  height: 0;
  border-radius: 50%;
  background: var(--glassdoor-green);
  transition: all 0.3s ease;
}

.slider-dots .dot.active {
  border-color: var(--glassdoor-green);
  background: var(--glassdoor-green);
  width: 32px;
  border-radius: 16px;
  box-shadow: 0 4px 12px rgba(0, 168, 107, 0.3);
}

.slider-dots .dot:hover:not(.active) {
  border-color: var(--glassdoor-green);
  transform: scale(1.2);
}

.company-card.featured {
  position: relative;
  border: 2px solid var(--glassdoor-green-light);
  box-shadow: 0 8px 24px rgba(0, 168, 107, 0.15);
  background: linear-gradient(135deg, var(--glassdoor-white) 0%, #fafafa 100%);
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  overflow: hidden;
}

.company-card.featured::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: linear-gradient(90deg, transparent, rgba(0, 168, 107, 0.1), transparent);
  transition: left 0.6s ease;
}

.company-card.featured:hover::before {
  left: 100%;
}

.company-card.featured:hover {
  transform: translateY(-8px) scale(1.02);
  box-shadow: 0 16px 40px rgba(0, 168, 107, 0.25);
  border-color: var(--glassdoor-green);
}

.company-badge {
  position: absolute;
  top: 16px;
  right: 16px;
  background: linear-gradient(135deg, var(--glassdoor-green) 0%, var(--glassdoor-green-dark) 100%);
  color: white;
  padding: 6px 14px;
  border-radius: 16px;
  font-size: 12px;
  font-weight: 700;
  box-shadow: 0 4px 12px rgba(0, 168, 107, 0.4);
  z-index: 2;
  animation: pulse 2s ease-in-out infinite;
}

@keyframes pulse {
  0%, 100% {
    transform: scale(1);
    box-shadow: 0 4px 12px rgba(0, 168, 107, 0.4);
  }
  50% {
    transform: scale(1.05);
    box-shadow: 0 6px 16px rgba(0, 168, 107, 0.6);
  }
}
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  z-index: 5;
}

.companies-section {
  max-width: 1200px;
  margin: 0 auto;
}

.companies-header {
  padding: 32px 24px 16px;
  background: var(--glassdoor-white);
  border-bottom: 1px solid var(--glassdoor-border);
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.companies-header h2 {
  font-size: 24px;
  font-weight: 700;
  color: var(--glassdoor-gray);
  margin: 0;
}

.companies-subtitle {
  font-size: 14px;
  color: var(--glassdoor-gray-light);
  margin: 0;
}

.show-all-section {
  text-align: center;
  padding: 32px 24px;
  background: var(--glassdoor-white);
  border-top: 1px solid var(--glassdoor-border);
}

.show-all-btn {
  display: inline-block;
  padding: 14px 32px;
  background: var(--glassdoor-green);
  color: white;
  text-decoration: none;
  border-radius: 8px;
  font-size: 16px;
  font-weight: 600;
  transition: all 0.2s ease;
  box-shadow: 0 2px 8px var(--glassdoor-shadow);
}

.show-all-btn:hover {
  background: var(--glassdoor-green-dark);
  transform: translateY(-2px);
  box-shadow: 0 4px 12px var(--glassdoor-shadow-hover);
}

.companies-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
  gap: 24px;
  padding: 40px 24px;
}

.company-card {
  background: var(--glassdoor-white);
  border-radius: 12px;
  padding: 24px;
  box-shadow: 0 2px 8px var(--glassdoor-shadow);
  text-decoration: none;
  color: inherit;
  transition: all 0.3s ease;
  border: 1px solid var(--glassdoor-border);
  display: flex;
  flex-direction: column;
  height: 100%;
}

.company-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 24px var(--glassdoor-shadow-hover);
  border-color: var(--glassdoor-green-light);
}

.company-header {
  display: flex;
  justify-content: space-between;
  align-items: start;
  margin-bottom: 15px;
}

.company-header h3 {
  font-size: 20px;
  font-weight: 600;
  color: var(--glassdoor-gray);
  margin: 0;
  flex: 1;
  line-height: 1.4;
}

.company-header h3:hover {
  color: var(--glassdoor-green);
}

.company-score {
  background: linear-gradient(135deg, var(--glassdoor-green) 0%, var(--glassdoor-green-dark) 100%);
  color: white;
  padding: 6px 14px;
  border-radius: 20px;
  font-weight: 700;
  font-size: 15px;
  display: flex;
  align-items: center;
  gap: 4px;
  white-space: nowrap;
}

.company-info {
  color: var(--glassdoor-gray-light);
  margin-top: auto;
  padding-top: 16px;
}

.company-info p {
  margin: 10px 0;
  font-size: 14px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.company-info .icon {
  font-size: 16px;
  opacity: 0.7;
}

.empty-state {
  text-align: center;
  padding: 80px 24px;
  color: var(--glassdoor-gray-light);
  font-size: 18px;
  grid-column: 1 / -1;
  background: var(--glassdoor-white);
  border-radius: 12px;
  border: 1px solid var(--glassdoor-border);
}

/* Responsive - Mobile */
@media (max-width: 1024px) {
  .main-content-layout {
    grid-template-columns: 1fr;
    gap: 24px;
  }

  .sidebar-section {
    position: static;
  }
}

@media (max-width: 768px) {
  .hero-title {
    font-size: 32px;
  }

  .hero-subtitle {
    font-size: 16px;
  }

  .hero-search-form {
    flex-direction: column;
  }

  .hero-search-input,
  .hero-search-btn {
    width: 100%;
  }

  .main-content-layout {
    padding: 24px 16px;
  }

  .companies-main-section {
    padding: 24px 16px;
  }

  .filter-buttons {
    flex-direction: column;
  }

  .filter-btn {
    width: 100%;
  }

  .company-list-header {
    flex-direction: column;
    align-items: flex-start;
  }

  .company-list-name {
    font-size: 18px;
  }
  .header {
    padding: 40px 16px 24px;
  }

  .header h1 {
    font-size: 28px;
  }

  .header p {
    font-size: 16px;
  }

  .search-section {
    padding: 24px 16px;
  }

  .search-form {
    flex-direction: column;
    gap: 12px;
  }

  .search-input {
    width: 100%;
  }

  .search-btn,
  .btn-secondary {
    width: 100%;
  }

  .top-companies-section {
    padding: 24px 16px;
  }

  .top-companies-header h2 {
    font-size: 20px;
  }

  .top-companies-section {
    padding: 40px 20px;
    margin: 40px auto;
  }

  .top-companies-header h2 {
    font-size: 28px;
  }

  .slider-subtitle {
    font-size: 12px;
  }

  .slider-slide {
    grid-template-columns: 1fr;
    gap: 16px;
  }

  .slider-btn {
    width: 48px;
    height: 48px;
    font-size: 24px;
  }

  .companies-slider {
    gap: 12px;
  }

  .companies-section {
    padding: 0;
  }

  .companies-header {
    padding: 24px 16px 12px;
  }

  .companies-header h2 {
    font-size: 20px;
  }

  .companies-grid {
    grid-template-columns: 1fr;
    gap: 16px;
    padding: 24px 16px;
  }

  .view-all-section {
    margin-top: 12px;
  }

  .view-all-btn {
    width: 100%;
    padding: 12px;
  }

  .company-card {
    padding: 20px;
  }

  .company-header h3 {
    font-size: 18px;
  }

  .no-results-section {
    padding: 40px 16px;
  }

  .no-results-message {
    padding: 32px 24px;
  }

  .no-results-message p {
    font-size: 16px;
  }
}
</file>

<file path="FE/src/pages/Profile.css">
.profile-container {
  padding: 0;
  background: linear-gradient(135deg, var(--glassdoor-gray-bg) 0%, #f0f0f0 100%);
  min-height: calc(100vh - 64px - 200px);
}

.profile-header {
  background: linear-gradient(135deg, var(--glassdoor-white) 0%, var(--glassdoor-gray-bg) 100%);
  padding: 48px 32px;
  border-bottom: 2px solid var(--glassdoor-border);
  box-shadow: 0 2px 12px rgba(0, 0, 0, 0.05);
}

.back-link {
  display: inline-flex;
  align-items: center;
  margin-bottom: 16px;
  color: var(--glassdoor-green);
  text-decoration: none;
  font-size: 16px;
  font-weight: 500;
  transition: all 0.2s ease;
  padding: 8px 12px;
  border-radius: 6px;
}

.back-link:hover {
  background-color: var(--glassdoor-green-light);
  color: var(--glassdoor-green-dark);
}

.profile-header h1 {
  font-size: 42px;
  font-weight: 700;
  color: var(--glassdoor-gray);
  margin: 0;
  letter-spacing: -0.8px;
  background: linear-gradient(135deg, var(--glassdoor-green) 0%, var(--glassdoor-green-dark) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.profile-content {
  max-width: 1000px;
  margin: 0 auto;
  padding: 40px 24px;
  display: grid;
  grid-template-columns: 1fr;
  gap: 24px;
}

.profile-card {
  background: var(--glassdoor-white);
  padding: 48px;
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
  border: 1px solid var(--glassdoor-border);
  transition: all 0.3s ease;
}

.profile-card:hover {
  box-shadow: 0 12px 48px rgba(0, 0, 0, 0.12);
  transform: translateY(-2px);
}

.profile-avatar {
  text-align: center;
  margin-bottom: 32px;
  padding-bottom: 32px;
  border-bottom: 1px solid var(--glassdoor-border);
}

.avatar-circle {
  width: 120px;
  height: 120px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--glassdoor-green) 0%, var(--glassdoor-green-dark) 100%);
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 48px;
  font-weight: 700;
  margin: 0 auto 20px;
  box-shadow: 0 8px 24px rgba(0, 168, 107, 0.3);
  border: 4px solid var(--glassdoor-white);
  transition: all 0.3s ease;
  position: relative;
}

.avatar-circle::before {
  content: '';
  position: absolute;
  inset: -4px;
  border-radius: 50%;
  padding: 4px;
  background: linear-gradient(135deg, var(--glassdoor-green), var(--glassdoor-green-dark));
  -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
  -webkit-mask-composite: xor;
  mask-composite: exclude;
  opacity: 0;
  transition: opacity 0.3s ease;
}

.profile-avatar:hover .avatar-circle {
  transform: scale(1.05);
  box-shadow: 0 12px 32px rgba(0, 168, 107, 0.4);
}

.profile-avatar h2 {
  font-size: 32px;
  font-weight: 700;
  color: var(--glassdoor-gray);
  margin: 0 0 8px 0;
  letter-spacing: -0.5px;
}

.profile-email {
  font-size: 16px;
  color: var(--glassdoor-gray-light);
  margin: 0;
}

.profile-info {
  display: flex;
  flex-direction: column;
  gap: 24px;
}

.info-item {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.info-item label {
  font-size: 14px;
  font-weight: 600;
  color: var(--glassdoor-gray-light);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.info-item p {
  font-size: 16px;
  color: var(--glassdoor-gray);
  margin: 0;
}

.role-badge {
  display: inline-block;
  padding: 6px 16px;
  background: linear-gradient(135deg, var(--glassdoor-green-light) 0%, #d4f4e6 100%);
  color: var(--glassdoor-green-dark);
  border-radius: 16px;
  font-size: 14px;
  font-weight: 700;
  width: fit-content;
  border: 1px solid rgba(0, 168, 107, 0.2);
  box-shadow: 0 2px 8px rgba(0, 168, 107, 0.1);
}

.profile-actions {
  display: flex;
  gap: 16px;
  margin-top: 32px;
  padding-top: 32px;
  border-top: 2px solid var(--glassdoor-border);
}

.profile-actions .btn-primary,
.profile-actions .btn-secondary {
  flex: 1;
  padding: 14px 24px;
  font-size: 16px;
  font-weight: 600;
  border-radius: 12px;
  transition: all 0.3s ease;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
}

.profile-actions .btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(0, 168, 107, 0.3);
}

.profile-actions .btn-secondary:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
}

.profile-form {
  display: flex;
  flex-direction: column;
  gap: 20px;
}

.profile-form .form-group {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.profile-form label {
  font-size: 14px;
  font-weight: 600;
  color: var(--glassdoor-gray);
}

.profile-form input {
  padding: 12px;
  border: 1px solid var(--glassdoor-border);
  border-radius: 8px;
  font-size: 16px;
  transition: all 0.2s ease;
}

.profile-form input:focus {
  outline: none;
  border-color: var(--glassdoor-green);
  box-shadow: 0 0 0 3px var(--glassdoor-green-light);
}

.profile-form input:disabled {
  background: var(--glassdoor-gray-bg);
  cursor: not-allowed;
}

.profile-form small {
  font-size: 12px;
  color: var(--glassdoor-gray-light);
}

.profile-stats {
  background: var(--glassdoor-white);
  padding: 40px;
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
  border: 1px solid var(--glassdoor-border);
}

.profile-stats h3 {
  font-size: 28px;
  font-weight: 700;
  color: var(--glassdoor-gray);
  margin: 0 0 32px 0;
  display: flex;
  align-items: center;
  gap: 12px;
}

.profile-stats h3::before {
  content: 'üìä';
  font-size: 24px;
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 20px;
}

.stat-card {
  background: var(--glassdoor-white);
  padding: 32px 24px;
  border-radius: 12px;
  text-align: center;
  border: 1px solid var(--glassdoor-border);
  transition: all 0.3s ease;
  position: relative;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  min-height: 140px;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
}

.stat-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
  border-color: var(--glassdoor-green);
}

.stat-value {
  font-size: 48px;
  font-weight: 700;
  color: var(--glassdoor-green);
  margin-bottom: 12px;
  line-height: 1;
}

.stat-label {
  font-size: 13px;
  color: var(--glassdoor-gray);
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.8px;
  line-height: 1.4;
}

/* Responsive - Mobile */
@media (max-width: 768px) {
  .profile-header {
    padding: 32px 20px;
  }

  .profile-header h1 {
    font-size: 32px;
  }

  .profile-content {
    padding: 24px 16px;
    gap: 20px;
  }

  .profile-card {
    padding: 32px 24px;
  }

  .avatar-circle {
    width: 100px;
    height: 100px;
    font-size: 40px;
  }

  .profile-avatar h2 {
    font-size: 24px;
  }

  .profile-actions {
    flex-direction: column;
    gap: 12px;
  }

  .profile-actions button {
    width: 100%;
  }

  .profile-stats {
    padding: 32px 24px;
  }

  .profile-stats h3 {
    font-size: 24px;
  }

  .stats-grid {
    grid-template-columns: repeat(2, 1fr);
    gap: 16px;
  }

  .stat-card {
    padding: 24px 16px;
    min-height: 120px;
  }

  .stat-value {
    font-size: 36px;
  }

  .stat-label {
    font-size: 12px;
  }

  .profile-tabs {
    flex-direction: column;
  }

  .profile-tab {
    padding: 16px;
    border-bottom: 2px solid var(--glassdoor-border);
    border-right: none;
  }

  .profile-tab.active {
    border-bottom-color: var(--glassdoor-green);
  }

  .favorite-companies-section,
  .recent-comments-section {
    padding: 24px 16px;
  }

  .favorite-companies-grid {
    grid-template-columns: 1fr;
  }
}

.profile-tabs-section {
  background: var(--glassdoor-white);
  padding: 0;
  border-radius: 20px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
  border: 1px solid var(--glassdoor-border);
  margin-top: 32px;
  overflow: hidden;
}

.profile-tabs {
  display: flex;
  border-bottom: 2px solid var(--glassdoor-border);
  background: linear-gradient(135deg, var(--glassdoor-gray-bg) 0%, #f5f5f5 100%);
  position: relative;
}

.profile-tab {
  flex: 1;
  padding: 20px 24px;
  background: transparent;
  border: none;
  border-bottom: 4px solid transparent;
  font-size: 16px;
  font-weight: 600;
  color: var(--glassdoor-gray-light);
  cursor: pointer;
  transition: all 0.3s ease;
  text-align: center;
  position: relative;
}

.profile-tab::after {
  content: '';
  position: absolute;
  bottom: -2px;
  left: 0;
  right: 0;
  height: 4px;
  background: linear-gradient(90deg, var(--glassdoor-green), var(--glassdoor-green-dark));
  transform: scaleX(0);
  transition: transform 0.3s ease;
}

.profile-tab:hover {
  color: var(--glassdoor-gray);
  background: var(--glassdoor-white);
}

.profile-tab.active {
  color: var(--glassdoor-green);
  background: var(--glassdoor-white);
  font-weight: 700;
}

.profile-tab.active::after {
  transform: scaleX(1);
}

.favorite-companies-section {
  padding: 40px;
  background: linear-gradient(135deg, var(--glassdoor-white) 0%, var(--glassdoor-gray-bg) 100%);
}

.recent-comments-section {
  padding: 40px;
  background: linear-gradient(135deg, var(--glassdoor-white) 0%, var(--glassdoor-gray-bg) 100%);
}


.comments-list {
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.comment-item {
  background: var(--glassdoor-white);
  padding: 24px;
  border-radius: 16px;
  border: 2px solid var(--glassdoor-border);
  transition: all 0.3s ease;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
}

.comment-item:hover {
  box-shadow: 0 12px 32px rgba(0, 0, 0, 0.12);
  border-color: var(--glassdoor-green);
  transform: translateY(-2px);
}

.comment-header {
  margin-bottom: 12px;
}

.comment-meta {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.comment-date {
  font-size: 13px;
  color: var(--glassdoor-gray-light);
  font-weight: 500;
}

.comment-company-link {
  font-size: 15px;
  font-weight: 600;
  color: var(--glassdoor-green);
  text-decoration: none;
  transition: color 0.2s;
}

.comment-company-link:hover {
  color: var(--glassdoor-green-dark);
  text-decoration: underline;
}

.comment-content {
  margin: 20px 0;
  padding: 20px;
  background: linear-gradient(135deg, var(--glassdoor-gray-bg) 0%, var(--glassdoor-white) 100%);
  border-radius: 12px;
  border-left: 5px solid var(--glassdoor-green);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
}

.comment-content p {
  margin: 0;
  color: var(--glassdoor-gray);
  line-height: 1.6;
  font-size: 15px;
}

.comment-view-link {
  display: inline-block;
  margin-top: 12px;
  font-size: 14px;
  font-weight: 600;
  color: var(--glassdoor-green);
  text-decoration: none;
  transition: all 0.2s;
}

.comment-view-link:hover {
  color: var(--glassdoor-green-dark);
  text-decoration: underline;
}

.empty-favorites,
.empty-comments {
  text-align: center;
  padding: 60px 40px;
  color: var(--glassdoor-gray-light);
  background: linear-gradient(135deg, var(--glassdoor-gray-bg) 0%, var(--glassdoor-white) 100%);
  border-radius: 16px;
  border: 2px dashed var(--glassdoor-border);
}

.empty-favorites p,
.empty-comments p {
  font-size: 18px;
  margin-bottom: 24px;
  font-weight: 500;
  color: var(--glassdoor-gray);
}

.browse-link {
  display: inline-block;
  padding: 14px 32px;
  background: linear-gradient(135deg, var(--glassdoor-green) 0%, var(--glassdoor-green-dark) 100%);
  color: white;
  text-decoration: none;
  border-radius: 12px;
  font-weight: 700;
  font-size: 16px;
  transition: all 0.3s ease;
  box-shadow: 0 4px 16px rgba(0, 168, 107, 0.3);
}

.browse-link:hover {
  transform: translateY(-3px);
  box-shadow: 0 8px 24px rgba(0, 168, 107, 0.4);
}

.favorite-companies-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 16px;
}

.favorite-company-card {
  position: relative;
  background: var(--glassdoor-white);
  border: 2px solid var(--glassdoor-border);
  border-radius: 16px;
  padding: 24px;
  transition: all 0.3s ease;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
}

.favorite-company-card:hover {
  box-shadow: 0 12px 32px rgba(0, 0, 0, 0.12);
  border-color: var(--glassdoor-green);
  transform: translateY(-4px);
}

.favorite-company-link {
  text-decoration: none;
  color: inherit;
  display: block;
}

.favorite-company-header {
  display: flex;
  justify-content: space-between;
  align-items: start;
  margin-bottom: 12px;
  gap: 12px;
}

.favorite-company-header h4 {
  font-size: 18px;
  font-weight: 600;
  color: var(--glassdoor-gray);
  margin: 0;
  flex: 1;
}

.favorite-company-header h4:hover {
  color: var(--glassdoor-green);
}

.favorite-company-score {
  background: linear-gradient(135deg, var(--glassdoor-green) 0%, var(--glassdoor-green-dark) 100%);
  color: white;
  padding: 6px 14px;
  border-radius: 16px;
  font-size: 14px;
  font-weight: 700;
  white-space: nowrap;
  box-shadow: 0 4px 12px rgba(0, 168, 107, 0.3);
}

.favorite-company-info {
  color: var(--glassdoor-gray-light);
  font-size: 14px;
}

.favorite-company-info p {
  margin: 6px 0;
}

.favorite-company-info .location {
  font-size: 13px;
}

.remove-favorite-btn {
  position: absolute;
  top: 12px;
  right: 12px;
  width: 28px;
  height: 28px;
  border-radius: 50%;
  border: none;
  background: rgba(255, 255, 255, 0.9);
  color: var(--glassdoor-gray-light);
  cursor: pointer;
  font-size: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.2s ease;
  opacity: 0;
}

.favorite-company-card:hover .remove-favorite-btn {
  opacity: 1;
}

.remove-favorite-btn:hover {
  background: #ff4444;
  color: white;
  transform: scale(1.1);
}

/* Responsive - Mobile */
@media (max-width: 768px) {
  .favorite-companies-grid {
    grid-template-columns: 1fr;
  }

  .remove-favorite-btn {
    opacity: 1;
  }
}
</file>

<file path="FE/src/services/api.js">
import axios from 'axios';
import { API_BASE_URL, getHeaders, DEFAULT_TENANT } from '../config/api';

const apiClient = axios.create({
  baseURL: API_BASE_URL,
  timeout: 10000,
});

apiClient.interceptors.request.use(
  (config) => {
    const token = localStorage.getItem('access_token');
    let tenant = localStorage.getItem('tenant');
    if (!tenant) {
      tenant = DEFAULT_TENANT;
      localStorage.setItem('tenant', tenant);
    }
    
    config.headers = {
      ...config.headers,
      ...getHeaders(token, tenant),
    };
    
    return config;
  },
  (error) => {
    return Promise.reject(error);
  }
);

apiClient.interceptors.response.use(
  (response) => {
    return response.data;
  },
  (error) => {
    if (error.code === 'ERR_NETWORK' || error.message === 'Network Error' || error.code === 'ERR_CONNECTION_REFUSED') {
      const currentURL = error.config?.baseURL || API_BASE_URL;
      const errorMessage = {
        message: `Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn server.\nURL hi·ªán t·∫°i: ${currentURL}\n\nVui l√≤ng ki·ªÉm tra:\n- URL API trong file .env (VITE_API_BASE_URL)\n- Ngrok tunnel ƒëang ch·∫°y v√† URL ƒë√∫ng\n- K·∫øt n·ªëi m·∫°ng c·ªßa b·∫°n`,
        error: 'Network Error',
        details: `URL: ${currentURL}`,
      };
      return Promise.reject(errorMessage);
    }
    
    if (error.code === 'ECONNABORTED' || error.message.includes('timeout')) {
      const errorMessage = {
        message: 'Request timeout. Server kh√¥ng ph·∫£n h·ªìi. Vui l√≤ng th·ª≠ l·∫°i.',
        error: 'Timeout Error',
      };
      return Promise.reject(errorMessage);
    }
    
    if (error.response?.status === 404) {
      const fullURL = error.config ? `${error.config.baseURL}${error.config.url}` : 'Unknown';
      const errorMessage = {
        message: `Endpoint kh√¥ng t√¨m th·∫•y (404).\nURL: ${fullURL}\n\nVui l√≤ng ki·ªÉm tra:\n- Ngrok tunnel ƒëang ch·∫°y v√† URL ƒë√∫ng\n- Rails server ƒëang ch·∫°y\n- Route c√≥ t·ªìn t·∫°i: /api/v1/auth/sign_in`,
        error: 'Not Found',
        status: 404,
        url: fullURL,
      };
      return Promise.reject(errorMessage);
    }
    
    if (error.response?.status === 401) {
      localStorage.removeItem('access_token');
      localStorage.removeItem('user');
      window.location.href = '/login';
    }
    
    return Promise.reject(error.response?.data || {
      message: error.message || 'ƒê√£ x·∫£y ra l·ªói kh√¥ng x√°c ƒë·ªãnh',
      error: error.code || 'Unknown Error',
      status: error.response?.status,
    });
  }
);

export default apiClient;
</file>

<file path="FE/src/services/companyService.js">
import apiClient from './api';

// Company Services
export const companyService = {
  // Get list of companies
  getCompanies: async (searchQuery = null, options = {}) => {
    let url = '/company';
    const params = new URLSearchParams();
    
    if (searchQuery) {
      params.append('q', searchQuery);
    }
    
    if (options.topRated) {
      params.append('top_rated', 'true');
    }
    
    if (options.excludeIds && options.excludeIds.length > 0) {
      params.append('exclude_ids', options.excludeIds.join(','));
    }
    
    if (options.limit) {
      params.append('limit', options.limit);
    }
    
    if (options.page) {
      params.append('page', options.page);
    }
    
    if (options.perPage) {
      params.append('per_page', options.perPage);
    }
    
    if (options.filterBy) {
      params.append('filter_by', options.filterBy);
    }
    
    if (options.sortBy) {
      params.append('sort_by', options.sortBy);
    }
    
    if (options.sortOrder) {
      params.append('sort_order', options.sortOrder);
    }
    
    if (options.location) {
      params.append('location', options.location);
    }
    
    if (params.toString()) {
      url += `?${params.toString()}`;
    }
    
    return await apiClient.get(url);
  },
  
  // Get top rated companies
  getTopRatedCompanies: async (limit = 10) => {
    return await apiClient.get(`/company?top_rated=true`);
  },
  
  // Get remaining companies (excluding top rated)
  getRemainingCompanies: async (excludeIds, options = {}) => {
    const params = new URLSearchParams();
    params.append('exclude_ids', excludeIds.join(','));
    
    if (options.limit) {
      params.append('limit', options.limit);
    }
    
    return await apiClient.get(`/company?${params.toString()}`);
  },

  // Search companies by name
  searchCompanies: async (query) => {
    return await apiClient.get(`/company?q=${encodeURIComponent(query)}`);
  },

  // Get company details
  getCompanyOverview: async (companyId) => {
    return await apiClient.get(`/company/${companyId}/company_overview`);
  },

  // Create company (Admin/Owner only)
  createCompany: async (companyData) => {
    return await apiClient.post('/company', { company: companyData });
  },

  // Update company (Admin/Owner only)
  updateCompany: async (companyId, companyData) => {
    return await apiClient.put(`/company/${companyId}`, { company: companyData });
  },

  // Delete company (Soft delete - Admin/Owner only)
  deleteCompany: async (companyId) => {
    return await apiClient.put(`/company/${companyId}/delete_company`);
  },
};
</file>

<file path="FE/src/App.css">
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
    sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
  background-color: var(--glassdoor-gray-bg);
}

.app {
  min-height: 100vh;
  height: 100%;
  width: 100%;
  display: flex;
  flex-direction: column;
  flex: 1;
}

/* Common Button Styles */
.btn-primary {
  background-color: var(--glassdoor-green);
  color: white;
  border: none;
  padding: 12px 24px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 16px;
  font-weight: 600;
  transition: all 0.2s ease;
  box-shadow: 0 2px 4px var(--glassdoor-shadow);
}

.btn-primary:hover:not(:disabled) {
  background-color: var(--glassdoor-green-dark);
  box-shadow: 0 4px 8px var(--glassdoor-shadow-hover);
  transform: translateY(-1px);
}

.btn-primary:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  transform: none;
}

.btn-secondary {
  background-color: var(--glassdoor-white);
  color: var(--glassdoor-gray);
  border: 1px solid var(--glassdoor-border);
  padding: 12px 24px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 16px;
  font-weight: 500;
  transition: all 0.2s ease;
}

.btn-secondary:hover {
  background-color: var(--glassdoor-gray-bg);
  border-color: var(--glassdoor-green);
  color: var(--glassdoor-green);
}

/* Common Form Styles */
.form-group {
  margin-bottom: 15px;
}

.form-group label {
  display: block;
  margin-bottom: 5px;
  font-weight: 500;
  color: #333;
}

.form-group input,
.form-group textarea {
  width: 100%;
  padding: 12px;
  border: 1px solid var(--glassdoor-border);
  border-radius: 8px;
  font-size: 16px;
  font-family: inherit;
  background-color: var(--glassdoor-white);
  color: var(--glassdoor-gray);
  transition: all 0.2s ease;
}

.form-group input:focus,
.form-group textarea:focus {
  outline: none;
  border-color: var(--glassdoor-green);
  box-shadow: 0 0 0 3px var(--glassdoor-green-light);
}

.form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 15px;
}

.form-actions {
  display: flex;
  gap: 10px;
  justify-content: flex-end;
  margin-top: 20px;
}

/* Error Message */
.error-message {
  background-color: #fef2f2;
  color: #991b1b;
  padding: 12px 16px;
  border-radius: 8px;
  margin-bottom: 16px;
  border: 1px solid #fecaca;
  font-size: 14px;
}

/* Loading */
.loading {
  text-align: center;
  padding: 60px 24px;
  font-size: 18px;
  color: var(--glassdoor-gray-light);
  font-weight: 500;
}

/* Error */
.error {
  text-align: center;
  padding: 40px 24px;
  font-size: 18px;
  color: #991b1b;
  background-color: #fef2f2;
  border-radius: 12px;
  margin: 24px;
  border: 1px solid #fecaca;
  max-width: 800px;
  margin-left: auto;
  margin-right: auto;
}

/* Responsive - Mobile */
@media (max-width: 768px) {
  .main-content {
    padding: 10px;
  }

  .form-row {
    grid-template-columns: 1fr;
  }

  .form-actions {
    flex-direction: column;
  }

  .form-actions button {
    width: 100%;
  }
}
</file>

<file path="app/controllers/application_controller.rb">
class ApplicationController < ActionController::API
  include ResponseHelper
  include AuthTokenConcern
  respond_to :json

  def render_200
    render json: json_with_success(message: "OK"), status: :ok
  end

  def render_404
    render json: json_with_error(message: I18n.t('errors.messages.not_found')), status: :not_found
  end

  def authenticate_user!
    authenticate_user_from_token!
    return render json: json_with_error(message: I18n.t('devise.failure.unauthenticated')), status: :unauthorized unless @current_user
  end

  def authenticate_if_token_present
    auth_token && authenticate_user!
  end

  def with_transaction
    ActiveRecord::Base.transaction do
      yield
    end
  end
end
</file>

<file path="app/models/user.rb">
class User < ApplicationRecord
  devise :database_authenticatable, :registerable,
         :recoverable, :rememberable, :validatable,
         :jwt_authenticatable, jwt_revocation_strategy: Devise::JWT::RevocationStrategies::Null

  belongs_to :role, optional: true
  has_many :favorites, dependent: :destroy
  has_many :favorite_companies, through: :favorites, source: :company
  include WhoDoesIt::CurrentUserMethods

  after_create :set_default_role, if: -> { role_id.nil?}

  private

  def set_default_role
    self.role_id = Role.find_by(role: 'user').id
    self.save!
  end
end
</file>

<file path="FE/src/components/Navbar.css">
.navbar {
  background-color: var(--glassdoor-white);
  box-shadow: 0 2px 8px var(--glassdoor-shadow);
  padding: 0;
  position: sticky;
  top: 0;
  z-index: 1000;
  border-bottom: 1px solid var(--glassdoor-border);
  flex-shrink: 0;
  will-change: transform;
}

.navbar-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 24px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  height: 64px;
}

.navbar-brand {
  font-size: 24px;
  font-weight: 700;
  color: var(--glassdoor-green);
  text-decoration: none;
  display: flex;
  align-items: center;
  gap: 8px;
  transition: opacity 0.2s;
}

.navbar-brand:hover {
  opacity: 0.8;
}

.navbar-brand::before {
  content: 'üè¢';
  font-size: 28px;
}

.navbar-menu {
  display: flex;
  align-items: center;
  gap: 16px;
}

.desktop-menu {
  display: flex;
}

.mobile-menu-btn {
  display: none;
  background: none;
  border: none;
  font-size: 24px;
  color: var(--glassdoor-gray);
  cursor: pointer;
  padding: 8px;
  border-radius: 4px;
  transition: all 0.2s ease;
}

.mobile-menu-btn:hover {
  background: var(--glassdoor-gray-bg);
  color: var(--glassdoor-green);
}

.user-menu-wrapper {
  position: relative;
}

.user-menu-trigger {
  display: flex;
  align-items: center;
  gap: 8px;
  background: var(--glassdoor-gray-bg);
  border: 1px solid var(--glassdoor-border);
  padding: 8px 12px;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.2s ease;
  font-size: 14px;
  color: var(--glassdoor-gray);
}

.user-menu-trigger:hover {
  background: var(--glassdoor-white);
  border-color: var(--glassdoor-green);
}

.user-avatar {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--glassdoor-green) 0%, var(--glassdoor-green-dark) 100%);
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  font-size: 14px;
}

.user-name {
  font-weight: 500;
}

.dropdown-icon {
  font-size: 10px;
  color: var(--glassdoor-gray-light);
  transition: transform 0.2s ease;
}

.user-menu-wrapper:hover .dropdown-icon {
  transform: rotate(180deg);
}

.user-menu-dropdown {
  position: absolute;
  top: calc(100% + 8px);
  right: 0;
  background: var(--glassdoor-white);
  border: 1px solid var(--glassdoor-border);
  border-radius: 8px;
  box-shadow: 0 4px 12px var(--glassdoor-shadow);
  min-width: 200px;
  z-index: 1000;
  overflow: hidden;
}

.user-menu-item {
  display: block;
  width: 100%;
  padding: 12px 16px;
  text-align: left;
  background: none;
  border: none;
  color: var(--glassdoor-gray);
  font-size: 14px;
  cursor: pointer;
  transition: all 0.2s ease;
  text-decoration: none;
}

.user-menu-item:hover {
  background: var(--glassdoor-gray-bg);
  color: var(--glassdoor-green);
}

.mobile-menu {
  display: none;
  flex-direction: column;
  background: var(--glassdoor-white);
  border-top: 1px solid var(--glassdoor-border);
  padding: 16px 24px;
  gap: 8px;
}

.mobile-menu-item {
  display: block;
  padding: 12px 16px;
  color: var(--glassdoor-gray);
  text-decoration: none;
  border-radius: 6px;
  font-size: 14px;
  font-weight: 500;
  transition: all 0.2s ease;
  background: none;
  border: none;
  width: 100%;
  text-align: left;
  cursor: pointer;
}

.mobile-menu-item:hover {
  background: var(--glassdoor-gray-bg);
  color: var(--glassdoor-green);
}

.mobile-menu-item.btn-primary {
  background: var(--glassdoor-green);
  color: white;
  text-align: center;
}

.mobile-menu-item.btn-primary:hover {
  background: var(--glassdoor-green-dark);
}

.navbar-user {
  color: var(--glassdoor-gray);
  font-size: 14px;
  font-weight: 500;
  padding: 8px 12px;
  border-radius: 4px;
  background-color: var(--glassdoor-gray-bg);
}

.navbar-link {
  color: var(--glassdoor-gray);
  text-decoration: none;
  padding: 10px 16px;
  border-radius: 6px;
  font-weight: 500;
  font-size: 14px;
  transition: all 0.2s ease;
}

.navbar-link:hover {
  background-color: var(--glassdoor-gray-bg);
  color: var(--glassdoor-green);
}

.navbar-link.btn-primary {
  background-color: var(--glassdoor-green);
  color: white;
  padding: 10px 20px;
  font-weight: 600;
}

.navbar-link.btn-primary:hover {
  background-color: var(--glassdoor-green-dark);
}

.btn-logout {
  background-color: transparent;
  color: var(--glassdoor-gray);
  border: 1px solid var(--glassdoor-border);
  padding: 10px 16px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 500;
  transition: all 0.2s ease;
}

.btn-logout:hover {
  background-color: var(--glassdoor-gray-bg);
  border-color: var(--glassdoor-gray-light);
  color: var(--glassdoor-gray);
}

/* Responsive - Mobile */
@media (max-width: 768px) {
  .navbar-container {
    padding: 0 16px;
    height: 56px;
  }

  .navbar-brand {
    font-size: 18px;
  }

  .navbar-brand::before {
    font-size: 24px;
  }

  .desktop-menu {
    display: none;
  }

  .mobile-menu-btn {
    display: block;
  }

  .mobile-menu {
    display: flex;
  }
}
</file>

<file path="FE/src/components/ReviewItem.css">
.review-item {
  background: var(--glassdoor-white);
  padding: 28px;
  border-radius: 16px;
  border: 1px solid var(--glassdoor-border);
  margin-bottom: 24px;
  transition: all 0.3s ease;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.04);
}

.review-item:hover {
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
  transform: translateY(-2px);
  border-color: var(--glassdoor-green);
}

.review-header {
  display: flex;
  justify-content: space-between;
  align-items: start;
  margin-bottom: 16px;
  gap: 16px;
  flex-wrap: wrap;
}

.review-meta {
  display: flex;
  align-items: center;
  gap: 12px;
  flex-wrap: wrap;
}

.review-title-score {
  display: flex;
  align-items: center;
  gap: 16px;
  flex: 1;
  flex-wrap: wrap;
}

.review-title-score h4 {
  margin: 0;
  font-size: 22px;
  font-weight: 700;
  color: var(--glassdoor-gray);
  line-height: 1.4;
}

.review-title-score .score-badge {
  background: linear-gradient(135deg, var(--glassdoor-green) 0%, var(--glassdoor-green-dark) 100%);
  color: white;
  padding: 8px 16px;
  border-radius: 24px;
  font-weight: 700;
  font-size: 16px;
  white-space: nowrap;
  box-shadow: 0 2px 8px rgba(0, 168, 107, 0.3);
}

.job-title-badge {
  background: var(--glassdoor-blue-light);
  color: var(--glassdoor-blue);
  padding: 6px 14px;
  border-radius: 18px;
  font-size: 13px;
  font-weight: 600;
  white-space: nowrap;
  border: 1px solid rgba(11, 95, 170, 0.2);
}

.anonymous-badge,
.review-author {
  font-size: 14px;
  color: var(--glassdoor-gray);
  font-weight: 600;
  padding: 6px 14px;
  background-color: var(--glassdoor-gray-bg);
  border-radius: 8px;
  white-space: nowrap;
  border: 1px solid var(--glassdoor-border);
}

.review-date {
  font-size: 13px;
  color: var(--glassdoor-gray-light);
  font-weight: 500;
  padding: 6px 12px;
  background-color: var(--glassdoor-white);
  border-radius: 8px;
  white-space: nowrap;
  border: 1px solid var(--glassdoor-border);
}

.review-content {
  margin: 20px 0;
  padding: 20px;
  background: var(--glassdoor-gray-bg);
  border-radius: 12px;
  border-left: 4px solid var(--glassdoor-green);
}

.review-content p {
  color: var(--glassdoor-gray);
  line-height: 1.8;
  margin: 0;
  font-size: 16px;
}

.review-actions {
  display: flex;
  gap: 12px;
  flex-wrap: wrap;
  align-items: center;
  padding-top: 16px;
  border-top: 1px solid var(--glassdoor-border);
}

.action-btn {
  background: var(--glassdoor-white);
  border: 1px solid var(--glassdoor-border);
  padding: 10px 18px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 500;
  color: var(--glassdoor-gray);
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  gap: 6px;
  transform: translateY(0);
}

.action-btn:hover {
  background-color: var(--glassdoor-gray-bg);
  border-color: var(--glassdoor-green);
  color: var(--glassdoor-green);
}

.action-btn.active {
  background-color: var(--glassdoor-green) !important;
  color: white !important;
  border-color: var(--glassdoor-green) !important;
  font-weight: 600;
  box-shadow: 0 2px 4px rgba(0, 168, 107, 0.2);
}

.action-btn.active:hover {
  background-color: var(--glassdoor-green-dark) !important;
  border-color: var(--glassdoor-green-dark) !important;
  color: white !important;
  box-shadow: 0 2px 6px rgba(0, 168, 107, 0.3);
  transform: translateY(-1px);
}

.action-btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

.replies-section {
  margin-top: 20px;
  padding-top: 20px;
  border-top: 2px solid var(--glassdoor-border);
  background-color: var(--glassdoor-gray-bg);
  padding: 20px;
  border-radius: 8px;
}

/* Responsive - Mobile */
@media (max-width: 768px) {
  .review-item {
    padding: 20px;
  }

  .review-header {
    flex-direction: column;
    gap: 12px;
  }

  .review-title-score {
    flex-direction: column;
    align-items: flex-start;
    gap: 12px;
    width: 100%;
  }

  .review-title-score h4 {
    font-size: 18px;
  }

  .review-actions {
    flex-direction: column;
    width: 100%;
  }

  .action-btn {
    width: 100%;
    justify-content: center;
  }

  .replies-section {
    padding: 16px;
  }
}
</file>

<file path="FE/src/pages/CompanyDetail.css">
.company-detail-container {
  padding: 0;
  background: var(--glassdoor-gray-bg);
}

.back-link {
  display: inline-flex;
  align-items: center;
  margin: 24px 24px 0;
  color: var(--glassdoor-green);
  text-decoration: none;
  font-size: 16px;
  font-weight: 500;
  transition: all 0.2s ease;
  padding: 8px 12px;
  border-radius: 6px;
}

.back-link:hover {
  background-color: var(--glassdoor-green-light);
  color: var(--glassdoor-green-dark);
}

.company-header {
  background: linear-gradient(135deg, var(--glassdoor-white) 0%, var(--glassdoor-gray-bg) 100%);
  padding: 48px 32px;
  border-bottom: 2px solid var(--glassdoor-border);
  margin-bottom: 0;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.04);
}

.company-title-section {
  display: flex;
  justify-content: space-between;
  align-items: flex-start;
  gap: 16px;
  margin-bottom: 20px;
  flex-wrap: wrap;
}

.company-header h1 {
  font-size: 42px;
  font-weight: 700;
  color: var(--glassdoor-gray);
  margin: 0;
  letter-spacing: -0.8px;
  flex: 1;
  line-height: 1.2;
}

.favorite-btn {
  padding: 10px 20px;
  background: var(--glassdoor-white);
  border: 2px solid var(--glassdoor-border);
  border-radius: 8px;
  cursor: pointer;
  font-size: 14px;
  font-weight: 600;
  color: var(--glassdoor-gray);
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  gap: 8px;
  white-space: nowrap;
}

.favorite-btn:hover:not(:disabled) {
  border-color: var(--glassdoor-green);
  color: var(--glassdoor-green);
  background: var(--glassdoor-green-light);
}

.favorite-btn.favorited {
  background: var(--glassdoor-green-light);
  border-color: var(--glassdoor-green);
  color: var(--glassdoor-green-dark);
}

.favorite-btn.favorited:hover:not(:disabled) {
  background: var(--glassdoor-white);
  border-color: var(--glassdoor-gray-light);
  color: var(--glassdoor-gray);
}

.favorite-btn:disabled {
  opacity: 0.6;
  cursor: not-allowed;
}

.company-meta {
  display: flex;
  align-items: center;
  gap: 24px;
  flex-wrap: wrap;
  margin-top: 8px;
}

.score-badge {
  background: linear-gradient(135deg, var(--glassdoor-green) 0%, var(--glassdoor-green-dark) 100%);
  color: white;
  padding: 12px 24px;
  border-radius: 28px;
  font-weight: 700;
  font-size: 22px;
  display: flex;
  align-items: center;
  gap: 8px;
  box-shadow: 0 4px 12px rgba(0, 168, 107, 0.3);
}

.company-meta span {
  font-size: 16px;
  color: var(--glassdoor-gray-light);
  font-weight: 500;
}

.company-stats {
  background: var(--glassdoor-white);
  padding: 32px 24px;
  border-bottom: 1px solid var(--glassdoor-border);
  display: flex;
  gap: 24px;
  flex-wrap: wrap;
}

.stat-card {
  display: flex;
  align-items: center;
  gap: 16px;
  padding: 20px 24px;
  background: var(--glassdoor-gray-bg);
  border-radius: 12px;
  border: 1px solid var(--glassdoor-border);
  flex: 1;
  min-width: 200px;
  transition: all 0.2s ease;
}

.stat-card:hover {
  box-shadow: 0 4px 12px var(--glassdoor-shadow);
  transform: translateY(-2px);
}

.stat-icon {
  font-size: 32px;
  line-height: 1;
}

.stat-content {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.stat-value {
  font-size: 28px;
  font-weight: 700;
  color: var(--glassdoor-gray);
  line-height: 1;
}

.stat-label {
  font-size: 14px;
  color: var(--glassdoor-gray-light);
  font-weight: 500;
}

.company-info {
  background: var(--glassdoor-white);
  padding: 40px 24px;
  border-bottom: 1px solid var(--glassdoor-border);
  margin-bottom: 0;
}

.info-section-title {
  font-size: 22px;
  font-weight: 700;
  color: var(--glassdoor-gray);
  margin: 0 0 24px 0;
  padding-bottom: 16px;
  border-bottom: 2px solid var(--glassdoor-border);
}

.info-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
  gap: 20px;
}

.info-item {
  display: flex;
  align-items: flex-start;
  gap: 16px;
  padding: 20px;
  background: var(--glassdoor-gray-bg);
  border-radius: 10px;
  border: 1px solid var(--glassdoor-border);
  transition: all 0.2s ease;
}

.info-item:hover {
  box-shadow: 0 2px 8px var(--glassdoor-shadow);
  border-color: var(--glassdoor-green);
}

.info-icon {
  font-size: 24px;
  line-height: 1;
  flex-shrink: 0;
}

.info-content {
  display: flex;
  flex-direction: column;
  gap: 6px;
  flex: 1;
}

.info-label {
  font-size: 12px;
  font-weight: 600;
  color: var(--glassdoor-gray-light);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.info-value {
  font-size: 16px;
  font-weight: 500;
  color: var(--glassdoor-gray);
  line-height: 1.4;
}

.info-value.link {
  color: var(--glassdoor-green);
  text-decoration: none;
  transition: color 0.2s;
}

.info-value.link:hover {
  color: var(--glassdoor-green-dark);
  text-decoration: underline;
}

.reviews-section {
  background: var(--glassdoor-white);
  padding: 48px 32px;
  max-width: 1200px;
  margin: 0 auto;
}

.reviews-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 40px;
  padding-bottom: 24px;
  border-bottom: 3px solid var(--glassdoor-border);
}

.reviews-header h2 {
  font-size: 32px;
  font-weight: 700;
  color: var(--glassdoor-gray);
  margin: 0;
  display: flex;
  align-items: center;
  gap: 12px;
}

.reviews-header h2::before {
  content: 'üí¨';
  font-size: 28px;
}

/* Responsive - Mobile */
@media (max-width: 768px) {
  .back-link {
    margin: 16px 16px 0;
    font-size: 14px;
  }

  .company-header {
    padding: 24px 16px;
  }

  .company-header h1 {
    font-size: 24px;
  }

  .company-meta {
    flex-direction: column;
    align-items: flex-start;
    gap: 16px;
  }

  .company-stats {
    padding: 24px 16px;
    flex-direction: column;
  }

  .stat-card {
    width: 100%;
  }

  .company-info {
    padding: 24px 16px;
  }

  .info-grid {
    grid-template-columns: 1fr;
  }

  .info-item {
    padding: 16px;
  }

  .reviews-section {
    padding: 24px 16px;
  }

  .reviews-header {
    flex-direction: column;
    align-items: flex-start;
    gap: 16px;
    padding-bottom: 16px;
  }

  .reviews-header h2 {
    font-size: 22px;
  }

  .reviews-header .btn-primary {
    width: 100%;
  }

  .company-title-section {
    flex-direction: column;
    align-items: flex-start;
  }

  .favorite-btn {
    width: 100%;
    justify-content: center;
  }
}
</file>

<file path="FE/src/pages/CompanyDetail.jsx">
import { useState } from 'react';
import { useParams, Link } from 'react-router-dom';
import { useAuth } from '../contexts/AuthContext';
import { useCompany, useReviews, useFavoriteStatus, useFavoriteMutations } from '../hooks';
import ReviewList from '../components/ReviewList';
import CreateReviewForm from '../components/CreateReviewForm';
import './CompanyDetail.css';

const CompanyDetail = () => {
  const { id } = useParams();
  const { isAuthenticated } = useAuth();
  const [showReviewForm, setShowReviewForm] = useState(false);

  const { 
    data: companyResponse, 
    isLoading: companyLoading, 
    error: companyError,
    refetch: refetchCompany 
  } = useCompany(id);

  const { 
    data: reviewsResponse, 
    isLoading: reviewsLoading,
    refetch: refetchReviews 
  } = useReviews(id, 1);

  const { 
    data: favoriteStatusResponse,
    refetch: refetchFavoriteStatus 
  } = useFavoriteStatus(id, isAuthenticated);

  const { addFavoriteAsync, removeFavoriteAsync, isAdding, isRemoving } = useFavoriteMutations();

  let company = null;
  if (companyResponse) {
    if (companyResponse.data && typeof companyResponse.data === 'object' && companyResponse.data.id) {
      company = companyResponse.data;
    } else if (companyResponse.id) {
      company = companyResponse;
    }
  }
  
  let reviews = [];
  let reviewsPagination = null;
  if (reviewsResponse) {
    if (Array.isArray(reviewsResponse.data)) {
      reviews = reviewsResponse.data;
    } else if (Array.isArray(reviewsResponse)) {
      reviews = reviewsResponse;
    }
    if (reviewsResponse.pagination) {
      reviewsPagination = reviewsResponse.pagination;
    }
  }
  
  const isFavorited = favoriteStatusResponse?.data?.is_favorited || false;
  const loading = companyLoading || reviewsLoading;
  const hasError = companyError || (companyResponse?.status && companyResponse?.status !== 'ok' && companyResponse?.status !== 'success');
  const error = hasError ? (companyError?.message || companyResponse?.message || 'C√≥ l·ªói x·∫£y ra') : '';
  const favoriteLoading = isAdding || isRemoving;

  const handleReviewCreated = () => {
    setShowReviewForm(false);
    refetchReviews();
    refetchCompany();
  };

  const handleToggleFavorite = async () => {
    if (!isAuthenticated) {
      alert('Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ y√™u th√≠ch c√¥ng ty');
      return;
    }

    try {
      if (isFavorited) {
        await removeFavoriteAsync(id);
      } else {
        await addFavoriteAsync(id);
      }
      refetchFavoriteStatus();
    } catch (err) {
      alert(err.message || 'Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t y√™u th√≠ch');
    }
  };

  if (loading) {
    return <div className="loading">ƒêang t·∫£i...</div>;
  }

  if (hasError && error) {
    return (
      <div className="company-detail-container">
        <Link to="/" className="back-link">‚Üê Quay l·∫°i</Link>
        <div className="error">{error}</div>
      </div>
    );
  }

  if (!company && !loading && !companyLoading) {
    return (
      <div className="company-detail-container">
        <Link to="/" className="back-link">‚Üê Quay l·∫°i</Link>
        <div className="error">Kh√¥ng t√¨m th·∫•y c√¥ng ty</div>
      </div>
    );
  }

  if (!company || companyLoading) {
    return <div className="loading">ƒêang t·∫£i...</div>;
  }

  return (
    <div className="company-detail-container">
      <Link to="/" className="back-link">‚Üê Quay l·∫°i</Link>
      
      <div className="company-header">
        <div className="company-title-section">
          <h1>{company?.name || 'N/A'}</h1>
          {isAuthenticated && (
            <button
              className={`favorite-btn ${isFavorited ? 'favorited' : ''}`}
              onClick={handleToggleFavorite}
              disabled={favoriteLoading}
              title={isFavorited ? 'B·ªè y√™u th√≠ch' : 'Y√™u th√≠ch'}
            >
              {isFavorited ? '‚ù§Ô∏è' : 'ü§ç'} {isFavorited ? 'ƒê√£ y√™u th√≠ch' : 'Y√™u th√≠ch'}
            </button>
          )}
        </div>
        <div className="company-meta">
          <div className="score-badge">
            ‚≠ê {company.avg_score?.toFixed(1) || '0.0'}
          </div>
          <span>{company.total_reviews || 0} ƒë√°nh gi√°</span>
        </div>
      </div>

      <div className="company-stats">
        <div className="stat-card">
          <div className="stat-icon">‚≠ê</div>
          <div className="stat-content">
            <div className="stat-value">{company.avg_score?.toFixed(1) || '0.0'}</div>
            <div className="stat-label">ƒêi·ªÉm ƒë√°nh gi√°</div>
          </div>
        </div>
        <div className="stat-card">
          <div className="stat-icon">üìù</div>
          <div className="stat-content">
            <div className="stat-value">{company.total_reviews || 0}</div>
            <div className="stat-label">T·ªïng ƒë√°nh gi√°</div>
          </div>
        </div>
      </div>

      <div className="company-info">
        <h3 className="info-section-title">Th√¥ng tin c√¥ng ty</h3>
        <div className="info-grid">
          <div className="info-item">
            <div className="info-icon">üë§</div>
            <div className="info-content">
              <div className="info-label">Ch·ªß s·ªü h·ªØu</div>
              <div className="info-value">{company.owner}</div>
            </div>
          </div>
          {company.main_office && (
            <div className="info-item">
              <div className="info-icon">üìç</div>
              <div className="info-content">
                <div className="info-label">VƒÉn ph√≤ng</div>
                <div className="info-value">{company.main_office}</div>
              </div>
            </div>
          )}
          {company.phone && (
            <div className="info-item">
              <div className="info-icon">üìû</div>
              <div className="info-content">
                <div className="info-label">ƒêi·ªán tho·∫°i</div>
                <div className="info-value">{company.phone}</div>
              </div>
            </div>
          )}
          {company.website && (
            <div className="info-item">
              <div className="info-icon">üåê</div>
              <div className="info-content">
                <div className="info-label">Website</div>
                <a href={company.website} target="_blank" rel="noopener noreferrer" className="info-value link">
                  {company.website}
                </a>
              </div>
            </div>
          )}
        </div>
      </div>

      <div className="reviews-section">
        <div className="reviews-header">
          <h2>ƒê√°nh gi√°</h2>
          {isAuthenticated && (
            <button
              className="btn-primary"
              onClick={() => setShowReviewForm(!showReviewForm)}
            >
              {showReviewForm ? 'H·ªßy' : '+ Vi·∫øt ƒë√°nh gi√°'}
            </button>
          )}
        </div>

        {showReviewForm && isAuthenticated && (
          <CreateReviewForm
            companyId={id}
            onSuccess={handleReviewCreated}
            onCancel={() => setShowReviewForm(false)}
          />
        )}

        <ReviewList 
          reviews={reviews} 
          pagination={reviewsPagination}
          onUpdate={() => {
            refetchReviews();
            refetchCompany();
          }} 
          companyId={id} 
        />
      </div>
    </div>
  );
};

export default CompanyDetail;
</file>

<file path="FE/src/pages/Home.jsx">
import { useState, useEffect } from 'react';
import { Link, useNavigate } from 'react-router-dom';
import { useAuth } from '../contexts/AuthContext';
import { companyService } from '../services/companyService';
import { API_BASE_URL } from '../config/api';
import CreateCompanyForm from '../components/CreateCompanyForm';
import RecentReviews from '../components/RecentReviews';
import './Home.css';

const Home = () => {
  const { isAuthenticated } = useAuth();
  const navigate = useNavigate();
  const [topCompanies, setTopCompanies] = useState([]);
  const [remainingCompanies, setRemainingCompanies] = useState([]);
  const [companies, setCompanies] = useState([]);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState('');
  const [searchQuery, setSearchQuery] = useState('');
  const [isSearching, setIsSearching] = useState(false);
  const [showCreateForm, setShowCreateForm] = useState(false);
  const [currentSlide, setCurrentSlide] = useState(0);
  const [isPaused, setIsPaused] = useState(false);
  const [filterType, setFilterType] = useState('recent'); // 'recent' or 'top'
  const [page, setPage] = useState(1);
  const [totalPages, setTotalPages] = useState(1);

  useEffect(() => {
    if (!isSearching) {
      loadAllCompanies();
    }
  }, []);

  useEffect(() => {
    if (!isSearching && filterType) {
      setPage(1);
      setLoading(true);
      loadRemainingCompanies().finally(() => setLoading(false));
    }
  }, [filterType]);

  useEffect(() => {
    if (!isSearching && page > 1) {
      setLoading(true);
      loadRemainingCompanies().finally(() => setLoading(false));
    }
  }, [page]);

  // Auto-play slider
  useEffect(() => {
    if (isSearching || topCompanies.length === 0 || isPaused) return;
    
    const totalSlides = Math.ceil(topCompanies.length / 3);
    if (totalSlides <= 1) return;

    const interval = setInterval(() => {
      setCurrentSlide((prev) => (prev + 1) % totalSlides);
    }, 4000); // Auto-advance every 4 seconds

    return () => clearInterval(interval);
  }, [topCompanies.length, isSearching, isPaused]);

  const loadAllCompanies = async () => {
    setLoading(true);
    try {
      await Promise.all([loadTopCompanies(), loadRemainingCompanies()]);
    } catch (err) {
      console.error('Error loading companies:', err);
    } finally {
      setLoading(false);
    }
  };

  const loadTopCompanies = async () => {
    try {
      const response = await companyService.getTopRatedCompanies();
      if (response.status === 'ok' || response.status === 'success') {
        setTopCompanies(response.data || []);
      }
    } catch (err) {
      // Silent fail for top companies
    }
  };

  const loadRemainingCompanies = async () => {
    try {
      const options = {
        page: page,
        perPage: 20,
        sortBy: filterType === 'top' ? 'avg_score' : 'created_at',
        sortOrder: 'desc',
      };
      
      if (filterType === 'top') {
        options.filterBy = 'highest_rated';
      }
      
      const response = await companyService.getCompanies(null, options);
      if (response.status === 'ok' || response.status === 'success') {
        setRemainingCompanies(response.data || []);
        if (response.pagination) {
          setTotalPages(response.pagination.total_pages || 1);
        }
      }
    } catch (err) {
      // Silent fail for remaining companies
    }
  };

  const loadCompanies = async (query = null) => {
    try {
      setLoading(true);
      setError('');
      const response = await companyService.getCompanies(query);
      
      if (response.status === 'ok' || response.status === 'success') {
        setCompanies(response.data || []);
      } else {
        setError(response.message || 'Kh√¥ng th·ªÉ t·∫£i danh s√°ch c√¥ng ty');
      }
    } catch (err) {
      let errorMessage = 'Kh√¥ng th·ªÉ t·∫£i danh s√°ch c√¥ng ty';
      
      if (err.error === 'Network Error' || err.message?.includes('Network Error')) {
        errorMessage = err.message || 'Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn server. Vui l√≤ng ki·ªÉm tra l·∫°i URL API ho·∫∑c k·∫øt n·ªëi m·∫°ng.';
      } else if (err.message) {
        errorMessage = err.message;
      } else if (err.error) {
        errorMessage = err.error;
      }
      
      setError(errorMessage);
    } finally {
      setLoading(false);
    }
  };

  const handleSearch = async (e) => {
    e.preventDefault();
    if (!searchQuery.trim()) {
      setIsSearching(false);
      setShowCreateForm(false);
      loadAllCompanies();
      return;
    }

    setIsSearching(true);
    setShowCreateForm(false);
    await loadCompanies(searchQuery);
  };

  const handleCompanyCreated = async (company) => {
    setShowCreateForm(false);
    setSearchQuery('');
    setIsSearching(false);
    // Reload companies list to show the new company
    await loadTopCompanies();
    await loadRemainingCompanies();
    // Scroll to top to see the new company in the list
    window.scrollTo({ top: 0, behavior: 'smooth' });
  };

  const handleViewAll = () => {
    setSearchQuery('');
    setIsSearching(false);
    setShowCreateForm(false);
    loadAllCompanies();
  };

  const nextSlide = () => {
    setCurrentSlide((prev) => (prev + 1) % Math.ceil(topCompanies.length / 3));
  };

  const prevSlide = () => {
    setCurrentSlide((prev) => (prev - 1 + Math.ceil(topCompanies.length / 3)) % Math.ceil(topCompanies.length / 3));
  };

  if (loading) {
    return <div className="loading">ƒêang t·∫£i...</div>;
  }

  if (error) {
    return (
      <div className="error">
        <p style={{ whiteSpace: 'pre-line' }}>{error}</p>
        {error.includes('Network Error') || error.includes('k·∫øt n·ªëi ƒë·∫øn server') ? (
          <div style={{ marginTop: '15px', fontSize: '14px', color: '#666', background: '#f8f9fa', padding: '15px', borderRadius: '5px' }}>
            <p style={{ fontWeight: 'bold', marginBottom: '10px' }}>üí° Th√¥ng tin debug:</p>
            <p style={{ marginBottom: '5px' }}><strong>URL hi·ªán t·∫°i:</strong> <code style={{ background: '#e9ecef', padding: '2px 6px', borderRadius: '3px' }}>{API_BASE_URL}</code></p>
            <p style={{ marginTop: '10px', marginBottom: '5px' }}>Ki·ªÉm tra l·∫°i:</p>
            <ul style={{ textAlign: 'left', display: 'inline-block', marginTop: '5px', marginLeft: '20px' }}>
              <li>File <code>.env</code> trong th∆∞ m·ª•c <code>FE/</code> c√≥ bi·∫øn <code>VITE_API_BASE_URL</code></li>
              <li>N·∫øu d√πng ngrok: URL ph·∫£i l√† <code>https://your-url.ngrok-free.app/api/v1</code></li>
              <li>Ngrok tunnel ƒëang ch·∫°y v√† URL ƒë√∫ng</li>
              <li>Rails server ƒëang ch·∫°y tr√™n port 3000 (n·∫øu d√πng localhost)</li>
              <li>Restart Vite dev server sau khi thay ƒë·ªïi <code>.env</code></li>
            </ul>
          </div>
        ) : null}
      </div>
    );
  }

  const formatEmployeeCount = (company) => {
    if (company.employee_count_range) {
      return company.employee_count_range;
    }
    if (company.employee_count_min && company.employee_count_max) {
      return `${company.employee_count_min} - ${company.employee_count_max} nh√¢n vi√™n`;
    }
    return null;
  };

  return (
    <div className="home-container">
      <div className="hero-section">
        <div className="hero-content">
          <h1 className="hero-title">30k+ review t·ª´ 15.000 c√¥ng ty kh√°c nhau</h1>
          <p className="hero-subtitle">ƒê√°nh gi√° c√¥ng ty v√† t√¨m ki·∫øm n∆°i l√†m vi·ªác t·ªët nh·∫•t cho s·ª± nghi·ªáp c·ªßa b·∫°n</p>
        </div>
        <div className="hero-search">
          <form onSubmit={handleSearch} className="hero-search-form">
            <input
              type="text"
              value={searchQuery}
              onChange={(e) => setSearchQuery(e.target.value)}
              placeholder="T√¨m c√¥ng ty"
              className="hero-search-input"
            />
            <button type="submit" className="hero-search-btn">
              T√¨m ki·∫øm
            </button>
          </form>
        </div>
      </div>

      {/* Show create form if no results and user is searching */}
      {isSearching && companies.length === 0 && !loading && (
        <div className="no-results-section">
          <div className="no-results-message">
            <p>Kh√¥ng t√¨m th·∫•y c√¥ng ty n√†o v·ªõi t·ª´ kh√≥a "<strong>{searchQuery}</strong>"</p>
            {isAuthenticated ? (
              <button
                className="btn-primary"
                onClick={() => setShowCreateForm(true)}
              >
                + T·∫°o c√¥ng ty m·ªõi
              </button>
            ) : (
              <p className="login-prompt">
                <a href="/login">ƒêƒÉng nh·∫≠p</a> ƒë·ªÉ t·∫°o c√¥ng ty m·ªõi
              </p>
            )}
          </div>
        </div>
      )}

      {/* Create Company Form */}
      {showCreateForm && (
        <CreateCompanyForm
          searchQuery={searchQuery}
          onSuccess={handleCompanyCreated}
          onCancel={() => setShowCreateForm(false)}
        />
      )}

      {/* Top Rated Companies Slider - Only show when not searching */}
      {!isSearching && topCompanies.length > 0 && (
        <div className="top-companies-section">
          <div className="top-companies-header">
            <h2>üèÜ Top 10 C√¥ng Ty ƒê√°nh Gi√° Cao Nh·∫•t</h2>
          </div>
          <div 
            className="companies-slider"
            onMouseEnter={() => setIsPaused(true)}
            onMouseLeave={() => setIsPaused(false)}
          >
            <button 
              className="slider-btn prev-btn" 
              onClick={prevSlide}
              aria-label="Previous"
            >
              ‚Äπ
            </button>
            <div className="slider-container">
              <div 
                className="slider-track" 
                style={{ transform: `translateX(-${currentSlide * 100}%)` }}
              >
                {Array.from({ length: Math.ceil(topCompanies.length / 3) }).map((_, slideIndex) => (
                  <div key={slideIndex} className="slider-slide">
                    {topCompanies.slice(slideIndex * 3, slideIndex * 3 + 3).map((company) => (
                      <Link
                        key={company.id}
                        to={`/companies/${company.id}`}
                        className="company-card featured"
                      >
                        <div className="company-badge">Top Rated</div>
                        <div className="company-header">
                          <h3>{company.name}</h3>
                          <div className="company-score">
                            <span>‚≠ê</span>
                            <span>{company.avg_score?.toFixed(1) || '0.0'}</span>
                          </div>
                        </div>
                        <div className="company-info">
                          <p className="company-owner">
                            <span className="icon">üë§</span>
                            <span>{company.owner}</span>
                          </p>
                          <p className="company-reviews">
                            <span className="icon">üìù</span>
                            <span>{company.total_reviews || 0} ƒë√°nh gi√°</span>
                          </p>
                          {company.main_office && (
                            <p className="company-location">
                              <span className="icon">üìç</span>
                              <span>{company.main_office}</span>
                            </p>
                          )}
                        </div>
                      </Link>
                    ))}
                  </div>
                ))}
              </div>
            </div>
            <button 
              className="slider-btn next-btn" 
              onClick={nextSlide}
              aria-label="Next"
            >
              ‚Ä∫
            </button>
          </div>
          <div className="slider-dots">
            {Array.from({ length: Math.ceil(topCompanies.length / 3) }).map((_, index) => (
              <button
                key={index}
                className={`dot ${index === currentSlide ? 'active' : ''}`}
                onClick={() => setCurrentSlide(index)}
                aria-label={`Go to slide ${index + 1}`}
              />
            ))}
          </div>
        </div>
      )}

      {/* Main Content with Sidebar */}
      {!isSearching && (
        <div className="main-content-layout">
          <div className="companies-main-section">
            {/* Filter Buttons */}
            <div className="filter-buttons">
              <button
                className={`filter-btn ${filterType === 'recent' ? 'active' : ''}`}
                onClick={() => setFilterType('recent')}
              >
                M·ªõi c·∫≠p nh·∫≠t
              </button>
              <button
                className={`filter-btn ${filterType === 'top' ? 'active' : ''}`}
                onClick={() => setFilterType('top')}
              >
                Top c√¥ng ty x·ªãn
              </button>
            </div>

            {/* Companies List */}
            <div className="companies-list">
              {(isSearching ? companies : remainingCompanies).length === 0 && !loading ? (
                <div className="empty-state">
                  {isSearching ? (
                    <p>Kh√¥ng t√¨m th·∫•y c√¥ng ty n√†o</p>
                  ) : (
                    <p>Ch∆∞a c√≥ c√¥ng ty n√†o</p>
                  )}
                </div>
              ) : (
                (isSearching ? companies : remainingCompanies).map((company) => (
                  <Link
                    key={company.id}
                    to={`/companies/${company.id}`}
                    className="company-list-item"
                  >
                    <div className="company-list-header">
                      <h3 className="company-list-name">{company.name}</h3>
                      <div className="company-list-rating">
                        <span className="rating-stars">‚≠ê</span>
                        <span className="rating-value">{company.avg_score?.toFixed(1) || '0.0'}</span>
                        <span className="rating-separator">sao</span>
                        <span className="rating-separator">|</span>
                        <span className="review-count">{company.total_reviews || 0} review</span>
                      </div>
                    </div>
                    <div className="company-list-info">
                      {company.industry && (
                        <span className="info-badge industry">{company.industry}</span>
                      )}
                      {formatEmployeeCount(company) && (
                        <span className="info-badge">{formatEmployeeCount(company)}</span>
                      )}
                      {company.main_office && (
                        <span className="info-badge location">üìç {company.main_office}</span>
                      )}
                      {company.is_hiring && (
                        <span className="hiring-badge">Tuy·ªÉn g·∫•p</span>
                      )}
                    </div>
                  </Link>
                ))
              )}
            </div>

            {/* Pagination */}
            {!isSearching && totalPages > 1 && (
              <div className="pagination">
                <button
                  className="pagination-btn"
                  onClick={() => setPage(p => Math.max(1, p - 1))}
                  disabled={page === 1}
                >
                  ‚Äπ Tr∆∞·ªõc
                </button>
                <div className="pagination-pages">
                  {Array.from({ length: Math.min(totalPages, 5) }, (_, i) => {
                    let pageNum;
                    if (totalPages <= 5) {
                      pageNum = i + 1;
                    } else if (page <= 3) {
                      pageNum = i + 1;
                    } else if (page >= totalPages - 2) {
                      pageNum = totalPages - 4 + i;
                    } else {
                      pageNum = page - 2 + i;
                    }
                    return (
                      <button
                        key={pageNum}
                        className={`pagination-page ${page === pageNum ? 'active' : ''}`}
                        onClick={() => setPage(pageNum)}
                      >
                        {pageNum}
                      </button>
                    );
                  })}
                </div>
                <button
                  className="pagination-btn"
                  onClick={() => setPage(p => Math.min(totalPages, p + 1))}
                  disabled={page === totalPages}
                >
                  Sau ‚Ä∫
                </button>
              </div>
            )}
          </div>

          {/* Sidebar - Recent Reviews */}
          <div className="sidebar-section">
            <RecentReviews limit={10} />
          </div>
        </div>
      )}

      {/* Search Results */}
      {isSearching && (
        <div className="main-content-layout">
          <div className="companies-main-section">
            <div className="companies-header">
              <h2>K·∫øt qu·∫£ t√¨m ki·∫øm ({companies.length})</h2>
            </div>
            <div className="companies-list">
              {companies.length === 0 && !loading ? (
                <div className="empty-state">
                  <p>Kh√¥ng t√¨m th·∫•y c√¥ng ty n√†o</p>
                </div>
              ) : (
                companies.map((company) => (
                  <Link
                    key={company.id}
                    to={`/companies/${company.id}`}
                    className="company-list-item"
                  >
                    <div className="company-list-header">
                      <h3 className="company-list-name">{company.name}</h3>
                      <div className="company-list-rating">
                        <span className="rating-stars">‚≠ê</span>
                        <span className="rating-value">{company.avg_score?.toFixed(1) || '0.0'}</span>
                        <span className="rating-separator">sao</span>
                        <span className="rating-separator">|</span>
                        <span className="review-count">{company.total_reviews || 0} review</span>
                      </div>
                    </div>
                    <div className="company-list-info">
                      {company.industry && (
                        <span className="info-badge industry">{company.industry}</span>
                      )}
                      {formatEmployeeCount(company) && (
                        <span className="info-badge">{formatEmployeeCount(company)}</span>
                      )}
                      {company.main_office && (
                        <span className="info-badge location">üìç {company.main_office}</span>
                      )}
                      {company.is_hiring && (
                        <span className="hiring-badge">Tuy·ªÉn g·∫•p</span>
                      )}
                    </div>
                  </Link>
                ))
              )}
            </div>
          </div>
          <div className="sidebar-section">
            <RecentReviews limit={10} />
          </div>
        </div>
      )}
    </div>
  );
};

export default Home;
</file>

<file path="FE/src/pages/Profile.jsx">
import { useState, useEffect } from 'react';
import { Link, useNavigate } from 'react-router-dom';
import { useAuth } from '../contexts/AuthContext';
import { userService } from '../services/userService';
import { useFavorites, useFavoriteMutations, useUserActivityStats, useUserRecentComments } from '../hooks';
import ProtectedRoute from '../components/ProtectedRoute';
import ConfirmModal from '../components/ConfirmModal';
import './Profile.css';

const Profile = () => {
  const { user, logout } = useAuth();
  const navigate = useNavigate();
  const [profile, setProfile] = useState(null);
  const [loading, setLoading] = useState(true);
  const [error, setError] = useState('');
  const [isEditing, setIsEditing] = useState(false);
  const [showConfirmModal, setShowConfirmModal] = useState(false);
  const [companyIdToRemove, setCompanyIdToRemove] = useState(null);
  const [activeTab, setActiveTab] = useState('favorites');

  const { data: favoritesResponse, isLoading: favoritesLoading, refetch: refetchFavorites } = useFavorites();
  const favoriteCompanies = favoritesResponse?.data || [];
  const { removeFavoriteAsync, isRemoving } = useFavoriteMutations();
  
  const { data: activityStatsResponse, refetch: refetchActivityStats } = useUserActivityStats();
  const activityStats = activityStatsResponse?.data || { reviews_count: 0, replies_count: 0, likes_count: 0 };
  
  const { data: recentCommentsResponse, refetch: refetchRecentComments } = useUserRecentComments(10);
  const recentComments = recentCommentsResponse?.data || [];
  const [formData, setFormData] = useState({
    first_name: '',
    last_name: '',
    email: ''
  });

  useEffect(() => {
    if (user) {
      loadProfile();
      refetchActivityStats();
      refetchRecentComments();
    }
  }, [user]);

  const loadProfile = async () => {
    try {
      setLoading(true);
      setError('');
      // Assuming we have a getProfile endpoint
      // For now, use the user from context
      setProfile(user);
      setFormData({
        first_name: user?.first_name || '',
        last_name: user?.last_name || '',
        email: user?.email || ''
      });
    } catch (err) {
      setError(err.message || 'Kh√¥ng th·ªÉ t·∫£i th√¥ng tin profile');
    } finally {
      setLoading(false);
    }
  };

  const handleChange = (e) => {
    setFormData({
      ...formData,
      [e.target.name]: e.target.value
    });
  };

  const handleSubmit = async (e) => {
    e.preventDefault();
    try {
      setError('');
      setProfile({ ...profile, ...formData });
      setIsEditing(false);
      alert('C·∫≠p nh·∫≠t profile th√†nh c√¥ng!');
    } catch (err) {
      setError(err.message || 'Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t profile');
    }
  };

  const handleRemoveFavoriteClick = (companyId) => {
    setCompanyIdToRemove(companyId);
    setShowConfirmModal(true);
  };

  const handleRemoveFavorite = async () => {
    if (!companyIdToRemove) return;
    
    try {
      await removeFavoriteAsync(companyIdToRemove);
    } catch (err) {
      const errorMessage = err.response?.data?.message || err.message || err.error || 'Kh√¥ng th·ªÉ x√≥a kh·ªèi danh s√°ch y√™u th√≠ch';
      alert(errorMessage);
    } finally {
      setCompanyIdToRemove(null);
    }
  };

  const handleLogout = () => {
    logout();
    navigate('/');
  };

  if (loading) {
    return <div className="loading">ƒêang t·∫£i...</div>;
  }

  return (
    <ProtectedRoute>
      <div className="profile-container">
        <div className="profile-header">
          <Link to="/" className="back-link">‚Üê Quay l·∫°i trang ch·ªß</Link>
          <h1>H·ªì s∆° c·ªßa t√¥i</h1>
        </div>

        {error && (
          <div className="error-message">{error}</div>
        )}

        <div className="profile-content">
          <div className="profile-card">
            <div className="profile-avatar">
              <div className="avatar-circle">
                {profile?.first_name?.[0]?.toUpperCase() || 'U'}
              </div>
              <h2>{profile?.first_name} {profile?.last_name}</h2>
              <p className="profile-email">{profile?.email}</p>
            </div>

            {!isEditing ? (
              <div className="profile-info">
                <div className="info-item">
                  <label>H·ªç v√† t√™n ƒë·ªám</label>
                  <p>{profile?.first_name || 'Ch∆∞a c·∫≠p nh·∫≠t'}</p>
                </div>
                <div className="info-item">
                  <label>T√™n</label>
                  <p>{profile?.last_name || 'Ch∆∞a c·∫≠p nh·∫≠t'}</p>
                </div>
                <div className="info-item">
                  <label>Email</label>
                  <p>{profile?.email || 'Ch∆∞a c·∫≠p nh·∫≠t'}</p>
                </div>
                <div className="info-item">
                  <label>Vai tr√≤</label>
                  <p className="role-badge">{profile?.role?.name || 'Ng∆∞·ªùi d√πng'}</p>
                </div>
                <div className="profile-actions">
                  <button
                    className="btn-primary"
                    onClick={() => setIsEditing(true)}
                  >
                    Ch·ªânh s·ª≠a h·ªì s∆°
                  </button>
                  <button
                    className="btn-secondary"
                    onClick={handleLogout}
                  >
                    ƒêƒÉng xu·∫•t
                  </button>
                </div>
              </div>
            ) : (
              <form className="profile-form" onSubmit={handleSubmit}>
                <div className="form-group">
                  <label>H·ªç v√† t√™n ƒë·ªám *</label>
                  <input
                    type="text"
                    name="first_name"
                    value={formData.first_name}
                    onChange={handleChange}
                    required
                    placeholder="Nh·∫≠p h·ªç v√† t√™n ƒë·ªám"
                  />
                </div>
                <div className="form-group">
                  <label>T√™n *</label>
                  <input
                    type="text"
                    name="last_name"
                    value={formData.last_name}
                    onChange={handleChange}
                    required
                    placeholder="Nh·∫≠p t√™n"
                  />
                </div>
                <div className="form-group">
                  <label>Email *</label>
                  <input
                    type="email"
                    name="email"
                    value={formData.email}
                    onChange={handleChange}
                    required
                    placeholder="Nh·∫≠p email"
                    disabled
                  />
                  <small>Email kh√¥ng th·ªÉ thay ƒë·ªïi</small>
                </div>
                <div className="form-actions">
                  <button
                    type="button"
                    className="btn-secondary"
                    onClick={() => {
                      setIsEditing(false);
                      setFormData({
                        first_name: profile?.first_name || '',
                        last_name: profile?.last_name || '',
                        email: profile?.email || ''
                      });
                    }}
                  >
                    H·ªßy
                  </button>
                  <button type="submit" className="btn-primary">
                    L∆∞u thay ƒë·ªïi
                  </button>
                </div>
              </form>
            )}
          </div>

          <div className="profile-stats">
            <h3>Ho·∫°t ƒë·ªông c·ªßa t√¥i</h3>
            <div className="stats-grid">
              <div className="stat-card">
                <div className="stat-value">{activityStats.reviews_count || 0}</div>
                <div className="stat-label">ƒê√ÅNH GI√Å ƒê√É VI·∫æT</div>
              </div>
              <div className="stat-card">
                <div className="stat-value">{activityStats.replies_count || 0}</div>
                <div className="stat-label">B√åNH LU·∫¨N ƒê√É VI·∫æT</div>
              </div>
              <div className="stat-card">
                <div className="stat-value">{activityStats.likes_count || 0}</div>
                <div className="stat-label">L∆Ø·ª¢T TH√çCH</div>
              </div>
              <div className="stat-card">
                <div className="stat-value">{favoriteCompanies.length}</div>
                <div className="stat-label">C√îNG TY Y√äU TH√çCH</div>
              </div>
            </div>
          </div>

          <div className="profile-tabs-section">
            <div className="profile-tabs">
              <button
                className={`profile-tab ${activeTab === 'favorites' ? 'active' : ''}`}
                onClick={() => setActiveTab('favorites')}
              >
                ‚ù§Ô∏è C√¥ng ty y√™u th√≠ch ({favoriteCompanies.length})
              </button>
              <button
                className={`profile-tab ${activeTab === 'comments' ? 'active' : ''}`}
                onClick={() => setActiveTab('comments')}
              >
                üí¨ B√¨nh lu·∫≠n g·∫ßn ƒë√¢y ({recentComments.length})
              </button>
            </div>

            {activeTab === 'favorites' && (
              <div className="favorite-companies-section">
                {favoritesLoading ? (
                  <div className="loading">ƒêang t·∫£i...</div>
                ) : favoriteCompanies.length === 0 ? (
                  <div className="empty-favorites">
                    <p>B·∫°n ch∆∞a y√™u th√≠ch c√¥ng ty n√†o</p>
                    <Link to="/companies" className="browse-link">
                      Kh√°m ph√° c√¥ng ty ‚Üí
                    </Link>
                  </div>
                ) : (
                  <div className="favorite-companies-grid">
                    {favoriteCompanies.map((company) => (
                      <div key={company.id} className="favorite-company-card">
                        <Link
                          to={`/companies/${company.id}`}
                          className="favorite-company-link"
                        >
                          <div className="favorite-company-header">
                            <h4>{company.name}</h4>
                            <div className="favorite-company-score">
                              ‚≠ê {company.avg_score?.toFixed(1) || '0.0'}
                            </div>
                          </div>
                          <div className="favorite-company-info">
                            <p>{company.total_reviews || 0} ƒë√°nh gi√°</p>
                            {company.main_office && (
                              <p className="location">üìç {company.main_office}</p>
                            )}
                          </div>
                        </Link>
                        <button
                          className="remove-favorite-btn"
                          onClick={() => handleRemoveFavoriteClick(company.id)}
                          title="X√≥a kh·ªèi y√™u th√≠ch"
                          disabled={isRemoving}
                        >
                          {isRemoving ? '...' : '‚úï'}
                        </button>
                      </div>
                    ))}
                  </div>
                )}
              </div>
            )}

            {activeTab === 'comments' && (
              <div className="recent-comments-section">
                {recentComments.length === 0 ? (
                  <div className="empty-comments">
                    <p>B·∫°n ch∆∞a c√≥ b√¨nh lu·∫≠n n√†o</p>
                    <Link to="/companies" className="browse-link">
                      Kh√°m ph√° c√¥ng ty v√† b√¨nh lu·∫≠n ‚Üí
                    </Link>
                  </div>
                ) : (
                  <div className="comments-list">
                    {recentComments.map((reply) => (
                      <div key={reply.id} className="comment-item">
                        <div className="comment-header">
                          <div className="comment-meta">
                            <span className="comment-date">
                              {new Date(reply.created_at).toLocaleDateString('vi-VN', {
                                year: 'numeric',
                                month: 'long',
                                day: 'numeric',
                                hour: '2-digit',
                                minute: '2-digit'
                              })}
                            </span>
                            {reply.review && (
                              <Link
                                to={`/companies/${reply.review.company_id}`}
                                className="comment-company-link"
                              >
                                üìù {reply.review.title || 'ƒê√°nh gi√°'}
                              </Link>
                            )}
                          </div>
                        </div>
                        <div className="comment-content">
                          <p>{reply.content}</p>
                        </div>
                        {reply.review && (
                          <Link
                            to={`/companies/${reply.review.company_id}`}
                            className="comment-view-link"
                          >
                            Xem ƒë√°nh gi√° ‚Üí
                          </Link>
                        )}
                      </div>
                    ))}
                  </div>
                )}
              </div>
            )}
          </div>
        </div>

        <ConfirmModal
          isOpen={showConfirmModal}
          onClose={() => {
            setShowConfirmModal(false);
            setCompanyIdToRemove(null);
          }}
          onConfirm={handleRemoveFavorite}
          title="X√≥a kh·ªèi danh s√°ch y√™u th√≠ch"
          message="B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a c√¥ng ty n√†y kh·ªèi danh s√°ch y√™u th√≠ch?"
          confirmText="X√≥a"
          cancelText="H·ªßy"
          type="danger"
        />
      </div>
    </ProtectedRoute>
  );
};

export default Profile;
</file>

<file path="FE/src/App.jsx">
import { BrowserRouter as Router, Routes, Route, Navigate } from 'react-router-dom';
import { QueryClient, QueryClientProvider } from '@tanstack/react-query';
import { AuthProvider } from './contexts/AuthContext';
import ProtectedRoute from './components/ProtectedRoute';
import MainLayout from './components/MainLayout';
import Home from './pages/Home';
import Login from './pages/Login';
import Register from './pages/Register';
import CompanyDetail from './pages/CompanyDetail';
import AllCompanies from './pages/AllCompanies';
import About from './pages/About';
import FAQ from './pages/FAQ';
import Profile from './pages/Profile';
import { API_BASE_URL } from './config/api';
import './App.css';

// Create a client
const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      refetchOnWindowFocus: false,
      retry: 1,
    },
  },
});

function App() {
  const isDevelopment = import.meta.env.DEV;

  return (
    <QueryClientProvider client={queryClient}>
      <AuthProvider>
        <Router>
        <div className="app">
          <MainLayout>
            <Routes>
              <Route path="/login" element={<Login />} />
              <Route path="/register" element={<Register />} />
              <Route path="/" element={<Home />} />
              <Route path="/companies" element={<AllCompanies />} />
              <Route path="/companies/:id" element={<CompanyDetail />} />
              <Route path="/about" element={<About />} />
              <Route path="/faq" element={<FAQ />} />
              <Route path="/profile" element={<Profile />} />
              <Route path="*" element={<Navigate to="/" replace />} />
            </Routes>
          </MainLayout>
          {isDevelopment && (
            <div style={{
              position: 'fixed',
              bottom: '10px',
              right: '10px',
              background: '#f8f9fa',
              border: '1px solid #dee2e6',
              borderRadius: '5px',
              padding: '8px 12px',
              fontSize: '11px',
              color: '#666',
              zIndex: 1000,
              maxWidth: '300px',
              boxShadow: '0 2px 4px rgba(0,0,0,0.1)'
            }}>
              <strong>API URL:</strong><br />
              <code style={{ fontSize: '10px', wordBreak: 'break-all' }}>{API_BASE_URL}</code>
            </div>
          )}
        </div>
      </Router>
    </AuthProvider>
    </QueryClientProvider>
  );
}

export default App;
</file>

<file path="FE/src/index.css">
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

:root {
  /* Glassdoor Color Palette */
  --glassdoor-green: #00A86B;
  --glassdoor-green-dark: #0CAA41;
  --glassdoor-green-light: #E6F5F0;
  --glassdoor-blue: #0B5FAA;
  --glassdoor-blue-light: #E6F0F7;
  --glassdoor-gray: #2C2C2C;
  --glassdoor-gray-light: #6B6B6B;
  --glassdoor-gray-bg: #F5F5F5;
  --glassdoor-white: #FFFFFF;
  --glassdoor-border: #E0E0E0;
  --glassdoor-shadow: rgba(0, 0, 0, 0.08);
  --glassdoor-shadow-hover: rgba(0, 0, 0, 0.12);
  
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
    sans-serif;
  line-height: 1.6;
  font-weight: 400;
  color: var(--glassdoor-gray);
  background-color: var(--glassdoor-gray-bg);
  font-synthesis: none;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

body {
  margin: 0;
  min-width: 320px;
  min-height: 100vh;
  height: 100%;
  display: flex;
  flex-direction: column;
}

#root {
  width: 100%;
  min-height: 100vh;
  height: 100%;
  margin: 0;
  padding: 0;
  display: flex;
  flex-direction: column;
}
</file>

<file path="app/models/review.rb">
class Review < ApplicationRecord
  include BaseConcern

  validates :title, presence: true, length: { minimum: 5, maximum: 100 }
  validates :total_dislike, :total_like, :total_reply, numericality: { only_integer: true, greater_than_or_equal_to: 0 }

  belongs_to :user, optional: true
  belongs_to :company
  has_many :replies, dependent: :destroy
  has_many :likes, dependent: :destroy

  before_create :set_default_values
  after_commit :update_company_total_review, on: :create
  after_commit :update_company_avg_score, on: [:create, :update, :destroy]

  private

  def update_company_total_review
    Company.transaction do
      company.increment!(:total_reviews, 1)
    end
  end

  def update_company_avg_score
    Company.transaction do
      reviews_count = company.reviews.count
      return if reviews_count.zero?

      total_score = company.reviews.sum(:score)
      new_avg_score = total_score.to_f / reviews_count
      company.update_column(:avg_score, new_avg_score)
    end
  end

  def set_default_values
    self.is_anonymous = true if self.is_anonymous.nil?
    self.vote_for_quit = false if self.vote_for_quit.nil?
    self.vote_for_work = false if self.vote_for_work.nil?
  end
end
</file>

<file path="config/initializers/constants.rb">
class SidekiqQueue
  CLOCK_MISSION            = 'clock_mission'.freeze
  FIND_AND_DESTROY_COMPANY = 'find_and_destroy_company'.freeze
  FIND_AND_DESTROY_REVIEWS = 'find_and_destroy_reviews'.freeze
  HANDLE_LIKE_EVENT        =  'handle_like_event'.freeze
  DELETE_USER              =  'delete_user'.freeze
end

class Tenant
  DEFAULT_SCHEMA = 'public'.freeze
  ASIA_SCHEMA    =  'asia'.freeze
  EUROPE_SCHEMA  =  'europe'.freeze
  AMERICA_SCHEMA = 'america'.freeze
end

class LikeEventAction
  CREATE =  'create'.freeze
  UPDATE =  'update'.freeze
end
</file>

<file path="config/locales/en.yml">
# Files in the config/locales directory are used for internationalization
# and are automatically loaded by Rails. If you want to use locales other
# than English, add the necessary files in this directory.
#
# To use the locales, use `I18n.t`:
#
#     I18n.t "hello"
#
# In views, this is aliased to just `t`:
#
#     <%= t("hello") %>
#
# To use a different locale, set it with `I18n.locale`:
#
#     I18n.locale = :es
#
# This would use the information in config/locales/es.yml.
#
# The following keys must be escaped otherwise they will not be retrieved by
# the default I18n backend:
#
# true, false, on, off, yes, no
#
# Instead, surround them with single quotes.
#
# en:
#   "true": "foo"
#
# To learn more, please read the Rails Internationalization guide
# available at https://guides.rubyonrails.org/i18n.html.

en:
  hello: "Hello world"
  errors:
    invalid_tenant: "invalid Tenant"

  controller:
    base:
      not_permission: "You are not permiit to perform this action"
      not_found: "Not Found"
      success: "success"
      fail: "fails"
      destroyed: "destroy done"
      ok: "Oke"
</file>

<file path="config/application.rb">
require_relative "boot"

require "rails/all"

# Require the gems listed in Gemfile, including any gems
# you've limited to :test, :development, or :production.
Bundler.require(*Rails.groups)

module ReviewCompany
  class Application < Rails::Application
    # Initialize configuration defaults for originally generated Rails version.
    config.load_defaults 7.0

    # Configuration for the application, engines, and railties goes here.
    #
    # These settings can be overridden in specific environments using the files
    # in config/environments, which are processed later.
    #
    # config.time_zone = "Central Time (US & Canada)"
    # config.eager_load_paths << Rails.root.join("extras")

    # Only loads a smaller set of middleware suitable for API only apps.
    # Middleware like session, flash, cookies can be added back manually.
    # Skip views, helpers and assets when generating a new resource.
    config.session_store :disabled
    config.api_only = true
    config.autoload_paths += Dir["#{config.root}/config/routes"]
    config.active_job.queue_adapter = :sidekiq
  end
end
</file>

<file path="Gemfile">
source "https://rubygems.org"
git_source(:github) { |repo| "https://github.com/#{repo}.git" }

ruby "3.1.2"

# Bundle edge Rails instead: gem "rails", github: "rails/rails", branch: "main"
gem "rails", "~> 7.0.8"

gem 'karafka', '~> 2.4', '>= 2.4.13'

# Use postgresql as the database for Active Record
gem "pg", "~> 1.1"
gem 'versionist'
gem 'active_model_serializers'
gem 'kaminari'
gem 'rails-i18n'
gem 'sidekiq', '~> 6.5', '>= 6.5.1'
gem 'clockwork'
gem 'devise'
gem 'countries'
gem 'devise-jwt'
gem 'ros-apartment', require: 'apartment'

gem "thin"
gem "sinatra"
gem "em-websocket"

# streaming kafka
gem 'connection_pool'
gem 'ruby-kafka'
gem 'rqrcode'
# Use the Puma web server [https://github.com/puma/puma]
gem "puma", "~> 5.0"

# Use Redis adapter to run Action Cable in production
gem "redis", "~> 4.0"

# Use Active Model has_secure_password [https://guides.rubyonrails.org/active_model_basics.html#securepassword]
gem "bcrypt", "~> 3.1.7"

# Windows does not include zoneinfo files, so bundle the tzinfo-data gem
gem "tzinfo-data", platforms: %i[ mingw mswin x64_mingw jruby ]

# Reduces boot times through caching; required in config/boot.rb
gem "bootsnap", require: false

# Use Rack CORS for handling Cross-Origin Resource Sharing (CORS), making cross-origin AJAX possible
gem "rack-cors"

group :development, :test do
  # Call 'byebug' anywhere in the code to stop execution and get a debugger console
  gem 'byebug', platforms: [:mri, :mingw, :x64_mingw]
  gem 'rspec-rails'
  gem 'dotenv-rails'
  gem 'faker'
  gem 'rubocop'
  gem 'database_cleaner'
  gem 'factory_bot'
end

group :development do
  # Speed up commands on slow machines / big apps [https://github.com/rails/spring]
  # gem "spring"
end
</file>

<file path="app/controllers/api/v1/company_controller.rb">
class Api::V1::CompanyController < ApplicationController
  before_action :authenticate_user!, only: [:create, :update, :delete_company]
  # Allow any authenticated user to create company (not just admin/owner)
  before_action :check_role_permission, only: [:update, :delete_company]
  before_action :get_company, only: [:company_overview, :update, :delete_company]

  def index
    query = params[:q] || params[:search]
    top_rated = params[:top_rated] == 'true'
    exclude_ids = params[:exclude_ids]&.split(',')&.map(&:strip)
    limit = params[:limit]&.to_i
    page = params[:page]&.to_i || 1
    per_page = params[:per_page]&.to_i || 20
    
    filter_by = params[:filter_by]
    sort_by = params[:sort_by] || 'created_at'
    sort_order = params[:sort_order] || 'desc'
    location = params[:location]
    
    base_query = Company.where(is_deleted: false)
    
    if query.present?
      base_query = base_query.where("name ILIKE ?", "%#{query}%")
    end
    
    if location.present?
      base_query = base_query.where("main_office ILIKE ?", "%#{location}%")
    end
    
    if filter_by.present?
      case filter_by
      when 'most_reviews'
        base_query = base_query.where("total_reviews > 0")
      when 'highest_rated'
        base_query = base_query.where.not(avg_score: nil).where("total_reviews > 0")
      when 'most_liked'
        base_query = base_query.where("total_reviews > 0")
      end
    end
    
    if top_rated
      data = base_query
        .where.not(avg_score: nil)
        .where("total_reviews > 0")
        .order(avg_score: :desc, total_reviews: :desc)
        .limit(10)
    elsif exclude_ids.present?
      data = base_query.where.not(id: exclude_ids)
      case sort_by
      when 'avg_score'
        data = data.order(avg_score: sort_order.to_sym, total_reviews: :desc, created_at: :desc)
      when 'total_reviews'
        data = data.order(total_reviews: sort_order.to_sym, avg_score: :desc, created_at: :desc)
      when 'created_at'
        data = data.order(created_at: sort_order.to_sym)
      else
        data = data.order(created_at: :desc)
      end
      data = data.limit(limit) if limit.present? && limit > 0
    else
      case sort_by
      when 'avg_score'
        data = base_query.order(avg_score: sort_order.to_sym, total_reviews: :desc, created_at: :desc)
      when 'total_reviews'
        data = base_query.order(total_reviews: sort_order.to_sym, avg_score: :desc, created_at: :desc)
      when 'created_at'
        data = base_query.order(created_at: sort_order.to_sym)
      else
        data = base_query.order(created_at: :desc)
      end
      
      if page.present? && per_page.present?
        total_count = data.count
        total_pages = (total_count.to_f / per_page).ceil
        offset = (page - 1) * per_page
        data = data.limit(per_page).offset(offset)
        
        return render json: {
          status: 'ok',
          data: data.map { |c| CompanySerializer.new(c).as_json },
          pagination: {
            current_page: page,
            per_page: per_page,
            total_count: total_count,
            total_pages: total_pages
          }
        }
      elsif limit.present? && limit > 0
        data = data.limit(limit)
      end
    end
    
    render json: json_with_success(data: data, default_serializer: CompanySerializer)
  end

  def create
    data = Company.create!(create_params)
    render json: json_with_success(data: data, default_serializer: CompanySerializer)
  end

  def company_overview
    render json: json_with_success(data: @company, default_serializer: CompanySerializer)
  end

  def update
    @company.update!(update_params)
    render json: json_with_success(data: @company, default_serializer: CompanySerializer)
  end

  def delete_company
    @company.update_attribute(:is_deleted, true)
    render json: json_with_empty_success
  end


  private

  def get_company
    @company = Company.find(params[:id])
    return render json: json_with_error(message: "company not found") unless @company
  end

  def create_params
    params.require(:company).permit(:name, :owner, :phone, :main_office, :website, 
                                     :industry, :employee_count_min, :employee_count_max, :is_hiring)
  end

  def update_params
    params.require(:company).permit(:owner, :phone, :main_office, :website,
                                     :industry, :employee_count_min, :employee_count_max, :is_hiring)
  end

  def check_role_permission
    allow_action = current_user.role&.admin? || current_user.role&.owner?
    return render json: json_with_error(message: I18n.t("controller.base.not_permission")) unless allow_action
  end
end
</file>

<file path="app/models/company.rb">
class Company < ApplicationRecord
  include BaseConcern

  enum company_type: {
    unknown:  0,
    personal: 1,
    government: 2
  }

  validates :name, :owner, presence: true
  validates :name, uniqueness: true
  has_many :reviews, dependent: :destroy
  has_many :favorites, dependent: :destroy
  has_many :favorited_by_users, through: :favorites, source: :user

  # Recalculate avg_score when total_reviews changes
  after_commit :recalculate_avg_score, on: :update, if: -> { saved_change_to_total_reviews? }

  # Method to recalculate avg_score manually
  def recalculate_avg_score!
    reviews_count = reviews.count
    return if reviews_count.zero?

    total_score = reviews.sum(:score)
    new_avg_score = total_score.to_f / reviews_count
    update_column(:avg_score, new_avg_score)
  end

  private

  def recalculate_avg_score
    recalculate_avg_score!
  end
end
</file>

<file path="app/controllers/api/v1/review_controller.rb">
class Api::V1::ReviewController < ApplicationController
  around_action :with_transaction, except: %i[index recent]
  before_action :authenticate_user!, except: %i[index recent]
  before_action :get_company, only: [:create, :index]
  before_action :get_review, only: [:update, :delete_review, :like, :dislike]
  before_action :validate_update, only: :update
  before_action :get_like_record, only: [:like, :dislike]

  def index
    page = params[:page]&.to_i || 1
    per_page = params[:per_page]&.to_i || 10
    
    reviews_query = @company.reviews.where(is_deleted: false)
    total_count = reviews_query.count
    
    if page == 1
      top_reviews = reviews_query.order(total_like: :desc, created_at: :desc).limit(10).to_a
      recent_reviews = reviews_query.order(created_at: :desc).limit(10).to_a
      combined = (top_reviews + recent_reviews).uniq
      data = combined.sort_by { |r| -r.created_at.to_i }.first(10)
    else
      offset = (page - 1) * per_page
      data = reviews_query.order(created_at: :desc).offset(offset).limit(per_page)
    end
    
    response_data = json_with_success(
      data: data, 
      default_serializer: ReviewSerializer,
      options: { scope: current_user }
    )
    
    response_data[:pagination] = {
      page: page,
      per_page: per_page,
      total: total_count,
      total_pages: (total_count.to_f / per_page).ceil
    }
    
    render json: response_data
  end

  def create
    create_payload = create_update_params.merge!(company_id: @company.id)
    create_payload.merge!(user_id: current_user.id)
    data = Review.create!(create_payload)
    render json: json_with_success(data: data, default_serializer: ReviewSerializer)
  end

  def update
    @review.update!(create_update_params)
    render json: json_with_success(data: @review, default_serializer: ReviewSerializer)
  end

  def delete_review
    @review.update_attribute(:is_deleted, true)
    render json: json_with_empty_success
  end

  def like
    handle_like_dislike(:like)
  end

  def dislike
    handle_like_dislike(:dislike)
  end

  def recent
    limit = params[:limit]&.to_i || 10
    reviews = Review.where(is_deleted: false)
                    .order(created_at: :desc)
                    .limit(limit)
                    .includes(:company)
    
    render json: json_with_success(
      data: reviews, 
      default_serializer: ReviewSerializer,
      options: { scope: current_user }
    )
  end

  private

  def handle_like_dislike(status)
    # Logic:
    # - If clicking like/dislike when already in that state -> toggle to default
    # - If clicking like/dislike when in opposite state -> switch to new state
    # - If clicking like/dislike when in default state -> set to new state
    if @like_record.present?
      current_status = @like_record.status.to_sym
      if current_status == status
        # Already in this state, toggle to default
        new_status = :default
      else
        # Switch to the requested status
        new_status = status
      end
      @like_record.update!(status: new_status)
    else
      # Create new like record with the requested status
      @like_record = Like.create!(
        user_id: current_user.id,
        review_id: @review.id,
        status: status
      )
    end
    
    # Reload review to get updated total_like and total_dislike
    # The after_commit callback should have already updated these values
    # Reload review and reset association cache to ensure serializer can find the like record
    @review.reload
    # Reset association cache so serializer will query fresh from database
    @review.association(:likes).reset
    
    render json: json_with_success(
      data: @review, 
      default_serializer: ReviewSerializer,
      options: { scope: current_user },
      message: I18n.t('controller.base.success')
    )
  rescue => e
    render json: json_with_error(message: e.message)
  end

  def validate_update
    return render json: json_with_error(message: "cant update deleted reivew") if @review.is_deleted
  end

  def get_review
    @review = Review.find_by(id: params[:id])
    return render json: json_with_error(message: "review not found") unless @review
  end

  def get_company
    @company = Company.find_by(id: params[:company_id])
    return render json: json_with_error(message: "company not found") unless @company
  end

  def create_update_params
    params.require(:review).permit(:title, :reviews_content, :score, :job_title, :is_anonymous)
  end

  def get_like_record
    @like_record = Like.get_like_review_by_user_id(params[:id], current_user.id).first
  end

end
</file>

<file path="db/schema.rb">
# This file is auto-generated from the current state of the database. Instead
# of editing this file, please use the migrations feature of Active Record to
# incrementally modify your database, and then regenerate this schema definition.
#
# This file is the source Rails uses to define your schema when running `bin/rails
# db:schema:load`. When creating a new database, `bin/rails db:schema:load` tends to
# be faster and is potentially less error prone than running all of your
# migrations from scratch. Old migrations may fail to apply correctly if those
# migrations use external dependencies or application code.
#
# It's strongly recommended that you check this file into your version control system.

ActiveRecord::Schema[7.0].define(version: 2025_12_20_041854) do
  # These are extensions that must be enabled in order to support this database
  enable_extension "pgcrypto"
  enable_extension "plpgsql"

  create_table "areas", id: :uuid, default: -> { "gen_random_uuid()" }, force: :cascade do |t|
    t.string "name", limit: 255, null: false
    t.string "tenant_name", limit: 255, null: false
    t.integer "status", default: 1, null: false
    t.datetime "created_at", null: false
    t.datetime "updated_at", null: false
  end

  create_table "companies", id: :uuid, default: -> { "gen_random_uuid()" }, force: :cascade do |t|
    t.string "name", limit: 100, null: false
    t.integer "is_active", default: 1, null: false
    t.string "owner", limit: 100, null: false
    t.string "main_office", limit: 100
    t.string "phone", limit: 30
    t.uuid "country_id"
    t.integer "company_type", default: 0, null: false
    t.integer "company_size", default: 1, null: false
    t.float "avg_score", default: 0.0
    t.integer "total_reviews", default: 0
    t.boolean "is_good_company", default: true
    t.string "logo", limit: 255
    t.string "website", limit: 255
    t.datetime "created_at", null: false
    t.datetime "updated_at", null: false
    t.boolean "is_deleted", default: false
    t.string "industry"
    t.integer "employee_count_min", default: 0
    t.integer "employee_count_max", default: 0
    t.boolean "is_hiring", default: false
  end

  create_table "favorites", id: :uuid, default: -> { "gen_random_uuid()" }, force: :cascade do |t|
    t.uuid "user_id", null: false
    t.uuid "company_id", null: false
    t.datetime "created_at", null: false
    t.datetime "updated_at", null: false
    t.index ["company_id"], name: "index_favorites_on_company_id"
    t.index ["user_id", "company_id"], name: "index_favorites_on_user_id_and_company_id", unique: true
    t.index ["user_id"], name: "index_favorites_on_user_id"
  end

  create_table "likes", id: :uuid, default: -> { "gen_random_uuid()" }, force: :cascade do |t|
    t.uuid "review_id", null: false
    t.uuid "user_id", null: false
    t.integer "status", default: 1, null: false
    t.datetime "created_at", null: false
    t.datetime "updated_at", null: false
    t.index ["review_id", "user_id"], name: "index_likes_on_review_id_and_user_id", unique: true
    t.index ["review_id"], name: "index_likes_on_review_id"
  end

  create_table "replies", id: :uuid, default: -> { "gen_random_uuid()" }, force: :cascade do |t|
    t.uuid "review_id", null: false
    t.uuid "user_id", null: false
    t.text "content", null: false
    t.boolean "is_deleted", default: false
    t.boolean "is_edited", default: false
    t.datetime "created_at", null: false
    t.datetime "updated_at", null: false
    t.index ["review_id", "user_id"], name: "index_replies_on_review_id_and_user_id"
    t.index ["review_id"], name: "index_replies_on_review_id"
  end

  create_table "reviews", id: :uuid, default: -> { "gen_random_uuid()" }, force: :cascade do |t|
    t.uuid "user_id"
    t.uuid "company_id"
    t.integer "score", default: 1, null: false
    t.string "title", limit: 100
    t.text "reviews_content"
    t.boolean "vote_for_quit", default: false, null: false
    t.boolean "vote_for_work", default: true, null: false
    t.boolean "is_anonymous", null: false
    t.datetime "created_at", null: false
    t.datetime "updated_at", null: false
    t.boolean "is_deleted", default: false
    t.integer "total_like", default: 0
    t.integer "total_dislike", default: 0
    t.integer "total_reply", default: 0
    t.string "job_title"
  end

  create_table "roles", id: :uuid, default: -> { "gen_random_uuid()" }, force: :cascade do |t|
    t.integer "role", default: 0, null: false
    t.integer "status", default: 1
    t.boolean "allow_all_action", default: false
    t.boolean "allow_create", default: false
    t.boolean "allow_read", default: true
    t.boolean "allow_update", default: false
    t.datetime "created_at", null: false
    t.datetime "updated_at", null: false
  end

  create_table "sessions", force: :cascade do |t|
    t.string "session_id", null: false
    t.text "data"
    t.datetime "created_at", null: false
    t.datetime "updated_at", null: false
    t.index ["session_id"], name: "index_sessions_on_session_id", unique: true
    t.index ["updated_at"], name: "index_sessions_on_updated_at"
  end

  create_table "users", id: :uuid, default: -> { "gen_random_uuid()" }, force: :cascade do |t|
    t.string "email", default: "", null: false
    t.string "encrypted_password", default: "", null: false
    t.integer "gender", default: 0, null: false
    t.string "first_name", limit: 30, null: false
    t.string "last_name", limit: 30, null: false
    t.integer "total_reviews", default: 0, null: false
    t.string "phone_number", limit: 30
    t.string "reset_password_token"
    t.datetime "reset_password_sent_at"
    t.datetime "remember_created_at"
    t.datetime "created_at", null: false
    t.datetime "updated_at", null: false
    t.uuid "role_id"
    t.boolean "is_deleted", default: false
    t.index ["email"], name: "index_users_on_email", unique: true
    t.index ["reset_password_token"], name: "index_users_on_reset_password_token", unique: true
  end

  add_foreign_key "favorites", "companies"
  add_foreign_key "likes", "reviews"
  add_foreign_key "replies", "reviews"
end
</file>

<file path="config/routes/api_routes.rb">
module ApiRoutes
  def self.extended(router)
    router.instance_exec do
      devise_for :users, controllers: {
        sessions: 'api/v1/sessions'
      }
      namespace :api do
        namespace :v1 do
          devise_scope :user do
            post 'auth/sign_up', to: 'registrations#create'
            post 'auth/sign_in', to: 'sessions#create'
          end

          resources :company, only: %i[index create update] do
            member do
              get :company_overview
              put :delete_company
            end
          end

          resources :review, only: %i[index create update] do
            member do
              put :delete_review
              put :like
              put :dislike
            end
            collection do
              get :recent
            end
          end

          resources :reply, only: %i[index create update destroy] do
          end

          resources :user, only: %i[index] do
            member do
              put :delete_user
              put :update_profile
            end
            collection do
              get :activity_stats
              get :recent_comments
            end
          end

          resources :favorite, only: %i[index create destroy] do
            collection do
              get 'check/:company_id', to: 'favorite#check', as: 'check'
            end
          end
        end
     end
   end
 end
end
</file>

</files>
